<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>INTRADEL - Trading Journal & AI Mentor</title>

<!-- Optimized Google Fonts for better performance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Performance optimizations -->
<meta name="description" content="Transform your trading with INTRADEL - AI-powered trading journal, analytics, and emotional mastery tools for consistent profitability.">
<meta name="keywords" content="trading journal, AI trading, trading analytics, emotional trading, trading psychology">
<meta property="og:title" content="INTRADEL - AI-Powered Trading Journal">
<meta property="og:description" content="Master trading with AI-powered precision. Join 10,000+ traders who've transformed their performance.">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">


<!-- Charts (used for BOTH real stats and homepage mockups) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- REAL AI - Transformers.js for client-side AI model (optional) -->
<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1"></script>

<style>
  /* =========================
     UI Variant — "Carbon Glow Matrix" - V3 (REVAMPED)
     ========================= */
  :root{
    /* Professional dark grey fading white monochrome background */
    --bg-0: #0f1419;
    --bg-1: #1a1f26;
    --bg-2: #252b33;

    --text: #ffffff;
    --muted: #a8b2c0;

    /* Professional blue, black, white with chrome accents */
    --accent: #3b82f6;
    --accent-strong: #1e40af;
    --accent-soft: #60a5fa;
    --accent-rgb: 59, 130, 246;
    --btn-glow: 0 8px 24px rgba(59,130,246,.25);

    --success: #10b981;
    --danger: #3b82f6;

    /* Professional chrome accents */
    --chrome: #64748b;
    --chrome-light: #94a3b8;
    --chrome-dark: #475569;
    --chrome-rgb: 100, 116, 139;

    --stroke-weak: rgba(255,255,255,0.08);
    --stroke-strong: rgba(255,255,255,0.15);
    --shadow-1: 0 12px 32px rgba(0,0,0,0.4);
    --shadow-2: 0 20px 48px rgba(0,0,0,0.5);
    
    --card-radius: 16px;
    --btn-radius: 12px;

    --header-height: 70px;
    --footer-height: 64px;
    --glass-blur: 16px;

    --dashboard-bg: none;
    --dashboard-bg-blend: rgba(26,29,35,0.8);

    /* Enhanced homepage variables */
    --mock-accent-color: var(--accent);
    --mock-success-color: var(--success);
    --mock-danger-color: var(--danger);

    /* Professional typography - Quicksand */
    --font-body: 'Quicksand', ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    --font-heading: 'Quicksand', ui-sans-serif, sans-serif;
    
    /* Professional animation variables */
    --animation-duration: 0.3s;
    --animation-easing: cubic-bezier(0.4, 0, 0.2, 1);
    --animation-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  /* Professional Light Theme */
  body.theme-light {
    --bg-0: #ffffff;
    --bg-1: #f8f9fa;
    --bg-2: #f1f3f4;
    --text: #1a1a1a;
    --muted: #6c757d;
    --stroke-weak: rgba(0,0,0,0.08);
    --stroke-strong: rgba(0,0,0,0.16);
    --shadow-1: 0 4px 12px rgba(0,0,0,.08);
    --shadow-2: 0 8px 20px rgba(0,0,0,.1);
    --btn-glow: 0 6px 16px rgba(var(--accent-rgb),.2);
  }
  body.theme-light .btn-primary { color: #fff; }
  body.theme-light .btn-secondary { color: var(--text); }
  body.theme-light .ai-chat-bubble.user { color: #fff; }
  body.theme-light .logo {
    background: linear-gradient(90deg, var(--accent), #1f2937);
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
  }
  body.theme-light body:before, body.theme-light body:after { display: none; }
  body.theme-light .fx-stripes { display: none; }
  body.theme-light #bgCanvas { opacity: 0.2; }
  body.theme-light header, body.theme-light footer {
    background: linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.7));
  }
  body.theme-light .modal .modal-content {
      background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(248,250,252,.98));
  }
  body.theme-light select option{background:var(--bg-1);color:var(--text)}


  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;}
  body{
    display: flex;
    flex-direction: column;
    font-family: var(--font-body);
    color: var(--text); 
    line-height: 1.6; 
    position: relative;
    overflow-x: hidden;
    min-height: 100vh;

    /* Professional dark grey fading white monochrome background with modern gradient */
    background: linear-gradient(135deg, var(--bg-0) 0%, var(--bg-1) 50%, var(--bg-2) 100%);
    background-attachment: fixed;
  }
  
  /* Scrolling behavior */
  #homePage { overflow-y: auto; scroll-behavior: smooth; padding-bottom: 4rem; }
  body:not(.page-home) { overflow: hidden; }
  
  /* Scrollbar Hiding Fix */
  #homePage, #dashboardPage .tab, body {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  #homePage::-webkit-scrollbar, #dashboardPage .tab::-webkit-scrollbar, body::-webkit-scrollbar {
    display: none; /* Chrome, Safari, and Opera */
  }


  /* Matrix lines + scan overlay - REMOVED: Background overlays causing issues */
  body:before{
    display: none;
  }
  body:after{
    display: none;
  }

  /* Subtle animated diagonals - REMOVED: Background overlays causing issues */
  .fx-stripes{
    display: none;
  }
  @keyframes sweep{
    0%{ transform: translate3d(-2%,0,0) }
    100%{ transform: translate3d(2%,0,0) }
  }

  /* Starfield canvas (kept) */
  #bgCanvas{position:fixed;inset:0;width:100%;height:100%;z-index:-7;pointer-events:none}

  /* Professional header with modern glassmorphism */
  header{
    position:sticky;top:0;z-index:1000;
    display:grid;grid-template-columns: 1fr auto 1fr; align-items:center;
    gap:1rem; padding:1rem 2rem;
    background: linear-gradient(135deg, rgba(15,20,25,0.95), rgba(26,31,38,0.95));
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border-bottom: 1px solid rgba(100,116,139,0.3);
    box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05);
    height: var(--header-height);
    flex-shrink: 0;
    transition: all var(--animation-duration) var(--animation-easing);
    position: relative;
    overflow: hidden;
  }
  
  header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,.05), transparent);
    pointer-events: none;
  }
  
  header:hover {
    background: linear-gradient(135deg, var(--bg-1), var(--bg-2));
    box-shadow: var(--shadow-2);
    transform: translateY(-1px);
  }
  .nav-left,.nav-right{
    display:flex; align-items:center; gap:.8rem; flex-wrap:wrap;
  }
  .nav-left{ justify-content:flex-start }
  .nav-right{ justify-content:flex-end; flex-direction: column; align-items: flex-end; gap: 0.5rem; }
  .nav-right nav { display: flex; gap: .8rem; }
  .logo{
    font-family: var(--font-heading);
    font-weight: 800;
    font-size: 2rem;
    letter-spacing: 0.15em;
    cursor: pointer;
    background: linear-gradient(135deg, var(--accent), var(--accent-soft));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    transition: all var(--animation-duration) var(--animation-easing);
    position: relative;
    line-height: 1;
    text-shadow: 0 0 20px rgba(var(--accent-rgb), 0.3);
  }
  
  .logo:hover {
    transform: scale(1.05);
    filter: brightness(1.2);
  }
  nav a{
    color: var(--text);
    opacity: 0.9;
    text-decoration: none;
    cursor: pointer;
    font-weight: 600;
    position: relative;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    transition: all var(--animation-duration) var(--animation-easing);
  }
  
  nav a:hover {
    opacity: 1;
    background: rgba(255,255,255,0.05);
    transform: translateY(-1px);
  }
  
  nav a:after{
    content: "";
    position: absolute;
    left: 50%;
    right: 50%;
    bottom: -2px;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent-soft));
    transition: all 0.3s ease;
    border-radius: 1px;
  }
  
  nav a:hover:after {
    left: 10%;
    right: 10%;
  }

  .auth-buttons{display:flex;gap:.5rem;align-items:center; justify-content:flex-end}
  button{
    padding:.75rem 1.25rem;border-radius:var(--btn-radius);border:0;font-weight:700;cursor:pointer;
    letter-spacing:.3px; transition: all var(--animation-duration) var(--animation-easing);
    font-family: var(--font-body);
    position: relative;
    overflow: hidden;
  }
  
  button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.5s ease;
  }
  
  button:hover::before {
    left: 100%;
  }
  .btn-primary{
    background: linear-gradient(135deg, var(--accent), var(--accent-strong));
    color: #ffffff; 
    box-shadow: 0 8px 24px rgba(var(--accent-rgb), 0.3), 0 0 0 1px rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    position: relative;
    overflow: hidden;
    font-weight: 600;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  
  .btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
    transition: left 0.6s ease;
  }
  
  .btn-primary:hover{ 
    transform: translateY(-3px) scale(1.02); 
    box-shadow: 0 16px 32px rgba(var(--accent-rgb), 0.4), 0 0 0 1px rgba(255,255,255,0.2);
  }
  
  .btn-primary:hover::before {
    left: 100%;
  }
  
  .btn-primary:active {
    transform: translateY(0) scale(0.98);
  }
  .btn-secondary{
    background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
    border: 1px solid rgba(100,116,139,0.4); 
    color: var(--text);
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    box-shadow: 0 8px 24px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.05);
    position: relative;
    overflow: hidden;
    font-weight: 600;
  }
  
  .btn-secondary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.1), transparent);
    transition: left 0.5s ease;
  }
  
  .btn-secondary:hover{ 
    transform: translateY(-2px) scale(1.01); 
    box-shadow: 0 12px 24px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
    background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08));
    border-color: rgba(100,116,139,0.6);
  }
  
  .btn-secondary:hover::before {
    left: 100%;
  }

  .user-chip{ display:flex; align-items:center; gap:.5rem; }
  #userAvatar{ width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid var(--stroke-weak); display:none; }

  .container{max-width:1280px;margin:0 auto;padding:1.25rem}
  
    /* =================================
       HOMEPAGE 10000x STYLES
       ================================= */
    #homePage .container { max-width: 1400px; padding: 0 2rem; margin: 0 auto; }
    #homePage .home-section { 
        padding: 6rem 0; 
        opacity: 0; 
        transform: translateY(50px); 
        transition: all 1s cubic-bezier(0.4, 0, 0.2, 1); 
        position: relative;
        border-radius: 24px;
        margin: 2rem 0;
    }
    #homePage .home-section.is-visible { 
        opacity: 1; 
        transform: translateY(0); 
    }
    
    #homePage .home-section::before {
        display: none;
    }
    
    #homePage .home-section.is-visible::before {
        display: none;
    }
    #homePage .section-header { text-align: center; margin-bottom: 3rem; }
    #homePage .section-header h2 { font-family: var(--font-heading); font-size: 3.2rem; font-weight: 700; line-height: 1.2; margin-bottom: .75rem; letter-spacing: -1px; }
    #homePage .section-header p { font-size: 1.2rem; color: var(--muted); max-width: 650px; margin: auto; }

    /* Enhanced Feature Showcase Layout - FIXED: Stable positioning */
    #homePage .feature-showcase {
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: center;
      gap: 5rem;
      position: relative;
      overflow: visible;
    }
    
    #homePage .feature-showcase .text-content { 
      grid-column: 1; 
      opacity: 1;
      transform: none;
      transition: all 0.3s ease;
    }
    
    #homePage .feature-showcase .mockup-content { 
      grid-column: 2; 
      opacity: 1;
      transform: none;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #homePage .feature-showcase.reversed .text-content { 
      grid-column: 2;
      opacity: 1;
      transform: none;
    }
    
    #homePage .feature-showcase.reversed .mockup-content { 
      grid-column: 1;
      opacity: 1;
      transform: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #homePage .feature-showcase.is-visible .text-content,
    #homePage .feature-showcase.is-visible .mockup-content {
      opacity: 1;
      transform: none;
    }
    
    #homePage .feature-showcase h3 { 
      font-family: var(--font-heading); 
      font-weight: 700; 
      font-size: 2.8rem; 
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--text), var(--accent-soft));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: all 0.3s ease;
    }
    
    #homePage .feature-showcase h3:hover {
      transform: translateY(-2px);
    }
    
    #homePage .feature-showcase p { 
      color: var(--muted); 
      margin-bottom: 1.5rem; 
      font-size: 1.2rem;
      line-height: 1.7;
      transition: all 0.3s ease;
    }
    
    #homePage .feature-showcase p:hover {
      /* Disabled hover effect */
    }

    /* Enhanced Mockup Card Style */
    .mockup-card {
        border-radius: 20px;
        border: 1px solid rgba(255,255,255,0.12);
        background: linear-gradient(135deg, rgba(12,15,22,0.8), rgba(12,15,22,0.6));
        backdrop-filter: blur(20px) saturate(150%);
        box-shadow: 0 50px 100px -20px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
        padding: 2rem;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transform: rotateY(8deg) rotateX(3deg);
        position: relative;
        overflow: visible;
        width: 100%;
        max-width: 500px;
    }
    
    .mockup-card::before {
        display: none; /* Removed overlay */
    }
    
    .reversed .mockup-card { 
        transform: rotateY(-8deg) rotateX(3deg); 
    }
    
    .mockup-card:hover { 
        transform: rotateY(0) rotateX(0) scale(1.03);
        border-color: rgba(var(--accent-rgb), 0.3);
        box-shadow: 0 60px 120px -20px rgba(0,0,0,0.7), 0 0 0 1px rgba(var(--accent-rgb), 0.2);
    }
    
    .mockup-card:hover::before {
        display: none; /* Removed overlay */
    }

    /* Enhanced Hero Section */
    .home-hero {
        padding: 8rem 0;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .home-hero::before {
        display: none; /* Removed red glow overlay */
    }
    
    @keyframes heroGlow {
        0% { transform: translate(-20%, -20%) scale(1); opacity: 0.3; }
        100% { transform: translate(20%, 20%) scale(1.2); opacity: 0.6; }
    }
    
    .hero-text {
        position: relative;
        z-index: 2;
    }
    
    .hero-text h1 {
        font-family: var(--font-heading);
        font-size: 5rem;
        font-weight: 900;
        line-height: 1.1;
        letter-spacing: -3px;
        background: linear-gradient(135deg, #ffffff, var(--accent-soft), var(--accent));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1.5rem;
        animation: heroTitle 1s ease-out;
    }
    
    @keyframes heroTitle {
        0% { opacity: 0; transform: translateY(30px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    
    .hero-text p { 
        font-size: 1.4rem; 
        color: var(--muted); 
        margin-bottom: 3rem; 
        max-width: 700px; 
        margin-left: auto; 
        margin-right: auto;
        line-height: 1.7;
        animation: heroSubtitle 1s ease-out 0.3s both;
    }
    
    @keyframes heroSubtitle {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    
    .hero-cta { 
        display: flex; 
        gap: 1rem; 
        justify-content: center;
        animation: heroCTA 1s ease-out 0.6s both;
    }
    
    @keyframes heroCTA {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* Enhanced Homepage Stats */
    .home-stats {
        display:flex; 
        gap:1.5rem; 
        justify-content:center; 
        margin-top:3rem; 
        flex-wrap:wrap;
        animation: heroStats 1s ease-out 0.9s both;
    }
    
    @keyframes heroStats {
        0% { opacity: 0; transform: translateY(30px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    
    .home-stat {
        background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
        border:1px solid var(--stroke-weak);
        padding: 1rem 1.5rem; 
        border-radius: 16px; 
        font-weight:700; 
        color:var(--muted);
        min-width: 180px; 
        text-align:center;
        backdrop-filter: blur(12px);
        transition: all var(--animation-duration) var(--animation-easing);
        position: relative;
        overflow: hidden;
    }
    
    .home-stat::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: left 0.6s ease;
    }
    
    .home-stat:hover {
        transform: translateY(-4px) scale(1.02);
        border-color: var(--accent);
        box-shadow: 0 12px 30px rgba(0,0,0,.3), 0 0 0 1px rgba(var(--accent-rgb),.2);
    }
    
    .home-stat:hover::before {
        left: 100%;
    }
    
    .home-stat .value { 
        font-size:1.5rem; 
        color:var(--accent-soft); 
        margin-top:.5rem; 
        font-weight:900;
        background: linear-gradient(135deg, var(--accent-soft), var(--accent));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Enhanced MacBook mockup with advanced animations - FIXED: Better positioning */
    .macbook-mockup {
        width: 100%;
        max-width: 800px;
        margin: 4rem auto 0 auto;
        border-radius: 20px;
        background: linear-gradient(180deg, rgba(20,22,28,0.98), rgba(10,12,16,0.9));
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 60px 120px -20px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.05);
        overflow: hidden;
        position: relative;
        transform: perspective(1200px) rotateX(3deg) rotateY(-3deg);
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        animation: macbookFloat 6s ease-in-out infinite;
        z-index: 1;
    }
    
    @keyframes macbookFloat {
        0%, 100% { transform: perspective(1200px) rotateX(3deg) rotateY(-3deg) translateY(0); }
        50% { transform: perspective(1200px) rotateX(2deg) rotateY(-2deg) translateY(-10px); }
    }
    
    .macbook-mockup::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(var(--accent-rgb), 0.1) 0%, transparent 70%);
        animation: macbookGlow 8s ease-in-out infinite alternate;
        pointer-events: none;
    }
    
    @keyframes macbookGlow {
        0% { transform: translate(-30%, -30%) scale(1); opacity: 0.3; }
        100% { transform: translate(30%, 30%) scale(1.2); opacity: 0.6; }
    }
    
    .macbook-mockup:hover { 
        transform: perspective(1200px) rotateX(0deg) rotateY(0deg) scale(1.05);
        box-shadow: 0 80px 160px -20px rgba(0,0,0,0.8), 0 0 0 1px rgba(var(--accent-rgb), 0.2);
    }
    .macbook-topbar {
        height: 45px;
        display:flex; align-items:center; gap:.8rem; padding: .6rem 1rem;
        background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
        border-bottom: 1px solid rgba(255,255,255,0.06);
        backdrop-filter: blur(8px);
    }
    .macbook-dots { display:flex; gap:.4rem; align-items:center; }
    .macbook-dot { width:11px; height:11px; border-radius:50%; }
    .macbook-screen {
        padding: 1.5rem;
        display:flex; gap:1.5rem; align-items:flex-start;
        background: linear-gradient(135deg, rgba(0,0,0,0.1), rgba(255,255,255,0.02));
    }
    .macbook-left {
        width: 42%;
        display:flex; flex-direction:column; gap:.5rem;
    }
    .macbook-right {
        width: 58%;
        display:flex; flex-direction:column; gap:.5rem;
    }
    .mini-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
        border: 1px solid rgba(255,255,255,0.08);
        padding: 1rem; 
        border-radius: 12px; 
        font-weight:700; 
        color:var(--muted);
        backdrop-filter: blur(8px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .mini-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: left 0.5s ease;
    }
    
    .mini-card:hover {
        transform: translateY(-2px);
        border-color: rgba(var(--accent-rgb), 0.2);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .mini-card:hover::before {
        left: 100%;
    }
    .mini-chart {
        height: 90px;
        border-radius: 8px; overflow: hidden;
        background: linear-gradient(180deg, rgba(0,0,0,0.05), rgba(255,255,255,0.02));
        display:flex; align-items:center; justify-content:center;
    }
    .mini-list { display:flex; flex-direction:column; gap:.4rem; }
    .mini-list .row { display:flex; justify-content:space-between; align-items:center; gap:.5rem; }
    .mini-list .tag { font-size:.8rem; color:var(--muted); padding:.2rem .4rem; border-radius:6px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.02); }

    /* MOCKUP CONTENT - Enhanced with better visual appeal */
    #homePage .mockup-card {
        position: relative;
        z-index: 2;
        background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 16px;
        padding: 2rem;
        backdrop-filter: blur(12px);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: visible;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 500px;
    }
    
    .mockup-card:hover {
        transform: translateY(-4px) scale(1.02);
        border-color: rgba(var(--accent-rgb), 0.3);
        box-shadow: 0 16px 48px rgba(0,0,0,0.2), 0 0 0 1px rgba(var(--accent-rgb), 0.1);
    }
    .mock-sidebar { display: flex; flex-direction: column; gap: .5rem; }
    .mock-sidebar-item { padding: .5rem .75rem; border-radius: 6px; font-size: .8rem; font-weight: 700; color: var(--muted); transition: all .2s ease; }
    #homePage .mock-sidebar-item.active { 
        background: rgba(255,255,255,0.04); 
        border: 1px solid rgba(255,255,255,0.06);
        color: var(--mock-accent-color);
    }
    
    .mock-main { display: flex; flex-direction: column; gap: .75rem; }
    .mock-main h2 { font-family: var(--font-heading); font-weight: 700; font-size: 1.4rem; margin: 0; }
    .mock-stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: .5rem; }
    .mock-stat-card { background: rgba(255,255,255,0.03); border-radius: 6px; padding: .5rem; text-align: center; }
    .mock-stat-label { font-size: .6rem; color: var(--muted); margin-bottom: .2rem; }
    .mock-stat-value { font-size: .9rem; font-weight: 800; transition: color .2s ease; }
    #homePage .mock-stat-value.profit { color: var(--mock-success-color); }
    #homePage .mock-stat-value.loss { color: var(--mock-danger-color); }

    .mock-trades-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: .3rem; }
    .mock-trade-day { 
        aspect-ratio: 1 / 1; border-radius: 4px; 
        display: flex; flex-direction: column; justify-content: center; align-items: center; 
        font-size: .6rem; background: rgba(255,255,255,0.04); 
        transition: background .2s ease;
        font-weight: 700;
    }

    /* Journal Mockup (HTML-based) */
    #mockup-journal-card { padding: 1rem; }
    #homePage .mock-tag {
        background: rgba(255,255,255,.06);
        border:1px solid var(--stroke-weak);
        padding:.18rem .5rem; border-radius:999px;
        font-size:.78rem; display: inline-block;
        transition: color .3s, border-color .3s, background-color .3s;
    }
    #homePage .mock-pnl-tag {
        border-color: rgba(from var(--mock-success-color) r g b / 0.35);
        color: var(--mock-success-color);
    }

    /* Stats Mockup - FIXED: Proper positioning and layout */
    #mockup-stats-card .charts-grid { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 1rem; 
        align-items: center;
        min-height: 150px;
        position: relative;
        width: 100%;
        height: auto;
        overflow: hidden;
    }
    #mockup-stats-card canvas { 
        max-height: 150px; 
        width: 100%;
        height: auto;
        position: relative;
    }

    /* AI Mockup */
    #mockup-ai-card { padding: 1.2rem; }
    .bento-ai-chat { 
        font-family: monospace; 
        font-size: .9em; 
        max-height: 200px;
        overflow-y: auto;
        padding: 0.5rem;
        background: rgba(255,255,255,0.02);
        border-radius: 8px;
        margin-bottom: 0.5rem;
    }
    .bento-ai-chat .line { margin-bottom: .5rem; }
    .bento-ai-chat .line.user { color: var(--muted); }
    .bento-ai-chat .line.ai { color: var(--accent-soft); }
    #homePage .bento-ai-chat .line.ai { color: var(--mock-accent-color); }
    .bento-ai-chat .cursor { display: inline-block; width: 8px; height: 1em; background: var(--accent-soft); animation: blink .7s infinite; }
    #homePage .bento-ai-chat .cursor { background: var(--mock-accent-color); }
    @keyframes blink { 50% { opacity: 0; } }

    /* ZEN Mockup */
    .zen-pulse-mockup { position: relative; width: 150px; height: 150px; margin: 0 auto; }
    .zen-pulse-mockup .zen-pulse {
        width: 100%; height: 100%; border-radius: 50%;
        background: rgba(from var(--mock-accent-color) r g b / 0.2);
        animation: pulse 4s ease-in-out infinite;
        transition: background .3s ease;
    }
    @keyframes pulse { 0%, 100% { transform: scale(0.8); opacity: 0.2; } 50% { transform: scale(1.2); opacity: 0.4; } }

    /* Color Customization Mockup */
    #mockup-color-card { border-color: var(--mock-accent-color); box-shadow: 0 40px 80px -20px rgba(from var(--mock-accent-color) r g b / 0.2); }
    .color-picker-mockup { display: flex; justify-content: space-around; align-items: center; padding: 1rem; }
    .color-swatch { text-align: center; font-size: .8em; position: relative; }
    .color-swatch .swatch-box { 
        width: 50px; height: 50px; border-radius: 8px; margin: 0 auto .5rem auto; 
        border: 2px solid var(--stroke-strong); cursor: pointer;
        transition: transform .2s ease, background-color .3s ease, color .3s ease;
        position: relative;
        overflow: hidden;
    }
    .color-swatch .swatch-box:hover { transform: scale(1.1); box-shadow: 0 0 15px -2px currentColor; }
    #swatch-accent-box { background-color: var(--mock-accent-color); color: var(--mock-accent-color); }
    #swatch-win-box { background-color: var(--mock-success-color); color: var(--mock-success-color); }
    #swatch-loss-box { background-color: var(--mock-danger-color); color: var(--mock-danger-color); }
    /* Overlay the native color input on top of the swatch so the color picker opens in-place */
    .color-swatch input[type="color"] { position:absolute; inset:0; width:100%; height:100%; opacity:0; cursor:pointer; border:none; padding:0; margin:0; }

    /* Final CTA */
    #homePage .final-cta { 
        text-align: center; 
        background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.05), rgba(var(--accent-rgb), 0.02));
        border-radius: 24px;
        padding: 3rem 2rem;
        border: 1px solid rgba(var(--accent-rgb), 0.1);
        backdrop-filter: blur(10px);
    }
    #homePage .final-cta h2 { 
        font-family: var(--font-heading); 
        font-weight: 700; 
        font-size: 2.8rem; 
        margin-bottom: .5rem;
        background: linear-gradient(135deg, var(--text), var(--accent));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    #homePage .final-cta p { color: var(--muted); margin-bottom: 1.5rem; font-size: 1.1rem; }
    #homePage .final-cta-wrapper {
        display: flex;
        justify-content: center;
        padding: 4rem 0;
    }
    #finalCtaRegisterBtn { 
        display:inline-block; 
        margin: 0 auto; 
        transform: scale(1.05);
        transition: all 0.3s ease;
    }
    #finalCtaRegisterBtn:hover {
        transform: scale(1.1) translateY(-2px);
        box-shadow: 0 12px 32px rgba(var(--accent-rgb), 0.3);
    }

  /* =================================
       FEATURES & SUBSCRIPTIONS PAGES
     ================================= */
  .page .hero { text-align: center; padding: 3rem 1.5rem; }
  .page .hero h1 { font-family: var(--font-heading); font-weight: 700; font-size: 3.2rem; letter-spacing: -1px; }
  .page .hero p { font-size: 1.2rem; max-width: 700px; margin: 0.5rem auto 0 auto; color: var(--muted); }
  
  /* REVAMPED Features Page */
  .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 3rem;
  }
  .feature-card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--stroke-weak);
      padding: 2rem;
      border-radius: var(--card-radius);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: visible;
  }
  .feature-card::before {
      display: none; /* Removed white shimmer effect */
  }
  .feature-card:hover::before {
      display: none; /* Removed white shimmer effect */
  }
  .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
      border-color: var(--accent);
  }
  .feature-card .icon {
      font-size: 2.5rem;
      color: var(--accent-soft);
      margin-bottom: 1rem;
      display: inline-block;
      line-height: 1;
      transition: all 0.3s ease;
  }
  .feature-card:hover .icon {
      transform: scale(1.1);
  }
  .feature-card h3 {
      font-family: var(--font-heading);
      font-weight: 700;
      font-size: 1.5rem;
      margin-bottom: 0.75rem;
      transition: color 0.3s ease;
  }
  .feature-card:hover h3 {
      color: var(--accent);
  }
  .feature-card p {
      color: var(--muted);
      font-size: 1rem;
      transition: color 0.3s ease;
  }
  .feature-card:hover p {
      /* Disabled hover effect */
  }

  /* Enhanced Feature Card Animations */
  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(30px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }
  
  @keyframes pulse {
      0%, 100% {
          transform: scale(1);
      }
      50% {
          transform: scale(1.05);
      }
  }
  
  @keyframes glow {
      0%, 100% {
          box-shadow: 0 0 5px rgba(var(--accent-rgb), 0.3);
      }
      50% {
          box-shadow: 0 0 20px rgba(var(--accent-rgb), 0.6);
      }
  }
  
  @keyframes slideIn {
      from {
          opacity: 0;
          transform: translateX(-20px);
      }
      to {
          opacity: 1;
          transform: translateX(0);
      }
  }

  /* Staggered animation for feature cards */
  .feature-card:nth-child(1) { animation: fadeInUp 0.6s ease-out 0.1s both; }
  .feature-card:nth-child(2) { animation: fadeInUp 0.6s ease-out 0.2s both; }
  .feature-card:nth-child(3) { animation: fadeInUp 0.6s ease-out 0.3s both; }
  .feature-card:nth-child(4) { animation: fadeInUp 0.6s ease-out 0.4s both; }
  .feature-card:nth-child(5) { animation: fadeInUp 0.6s ease-out 0.5s both; }
  .feature-card:nth-child(6) { animation: fadeInUp 0.6s ease-out 0.6s both; }

  /* Hero section animations */
  .hero h1 {
      animation: fadeInUp 0.8s ease-out;
  }
  
  .hero p {
      animation: fadeInUp 0.8s ease-out 0.2s both;
  }

  /* Stats counter animation */
  @keyframes countUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
  }

  /* Testimonial card hover effects */
  .testimonial-card {
      transition: all 0.3s ease;
      cursor: pointer;
  }
  
  .testimonial-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.2);
  }

  /* Call to action button animations */
  .cta-button {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
  }
  
  .cta-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
  }
  
  .cta-button:hover::before {
      left: 100%;
  }
  
  .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(var(--accent-rgb), 0.3);
  }

  /* About Us Page */
  .team-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      margin-top: 4rem;
      text-align: left;
  }
  .team-member-card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--stroke-weak);
      padding: 2rem;
      border-radius: var(--card-radius);
  }
  .team-member-card h3 {
      font-family: var(--font-heading);
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--accent-soft);
      margin-bottom: .5rem;
  }
  .team-member-card .role {
      color: var(--muted);
      font-weight: 700;
      margin-bottom: 1.5rem;
  }
  .team-member-card p {
      margin-bottom: 1rem;
  }

  /* Subscriptions Page */
  .pricing-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      margin-top: 2rem;
      justify-content: center;
      max-width: 900px; /* Wider for horizontal features layout */
      margin-left: auto;
      margin-right: auto;
  }
  .pricing-card {
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.028));
      border: 1px solid var(--stroke-weak);
      padding: 2rem;
      border-radius: var(--card-radius);
      display: flex;
      flex-direction: column;
  }
  .pricing-card.recommended {
      border-color: var(--accent);
      box-shadow: 0 0 30px rgba(var(--accent-rgb), 0.15), 0 0 0 4px rgba(var(--accent-rgb), 0.1) inset;
  }
  .pricing-card h3 { font-family: var(--font-heading); font-weight: 700; font-size: 2rem; color: var(--accent-soft); }
  .pricing-card .price { font-size: 2.5rem; font-weight: 900; margin: 0.5rem 0; }
  .pricing-card .price-note { color: var(--muted); margin-bottom: 1.5rem; min-height: 40px; }
  .pricing-card ul { 
    list-style: none; 
    padding: 0; 
    margin: 0 0 2rem 0; 
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
  }
  .pricing-card li { 
    padding: 0.6rem 1rem; 
    display: flex; 
    align-items: center; 
    gap: 0.5rem; 
    border: 1px solid var(--stroke-weak);
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    white-space: nowrap;
    font-size: 0.9rem;
  }
  .pricing-card li:before { content: '✓'; color: var(--success); font-weight: 800; }
  .pricing-card li.disabled { color: var(--muted); opacity: 0.7; }
  .pricing-card li.disabled:before { content: '×'; color: var(--danger); }
  .pricing-card button { width: 100%; margin-top: auto; padding: 0.8rem 1rem; font-size: 1.05rem; }

  /* Giveaways Page */
  #giveawaysPage .features-grid { max-width: 1200px; margin-left: auto; margin-right: auto; }
  #giveawaysPage .feature-card { text-align: left; }
  #giveawaysPage .feature-card h3 { font-family: var(--font-heading); font-weight: 700; color: var(--accent-soft); }


  /* Support Page */
  #supportPage .support-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-top: 3rem;
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
  }
  .faq-item {
      border-bottom: 1px solid var(--stroke-weak);
      padding-bottom: 1rem;
      margin-bottom: 1rem;
  }
  .faq-item h4 { font-size: 1.2rem; cursor: pointer; font-weight: 600; }
  .faq-item p { color: var(--muted); margin-top: .5rem; display: none; }
  .faq-item.active p { display: block; }
  .support-contact-card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--stroke-weak);
      padding: 1.5rem;
      border-radius: var(--card-radius);
  }
  .support-contact-card h3 { font-family: var(--font-heading); font-weight: 700; color: var(--accent-soft); }

  /* =================================
       END GENERIC PAGE STYLES
     ================================= */
  main {
    flex-grow: 1;
    overflow-y: auto;
    height: calc(100vh - var(--header-height));
  }
  .page{
    display:none;
    width:100%;
    height: 100%;
    overflow-y: auto;
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  .page::-webkit-scrollbar {
    display: none; /* Chrome, Safari, and Opera */
  }
  .page.active{display:block}

  /* DASHBOARD: two-column layout */
  #dashboardPage.active .container{
    display:flex; flex-direction:row; gap:1.5rem; align-items:flex-start;
    height: 100%; max-width: none;
    padding: 1.25rem;
  }
  #sidebar{
    display:flex; flex-direction:column; gap:.6rem;
    position:sticky; top: 0;
    width: 260px;
    flex-shrink: 0;
    height: calc(100vh - var(--header-height) - 1.25rem * 2);
    background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
    border:1px solid var(--stroke-weak);
    border-radius:12px; padding:.8rem;
  }
  #dashboardPage .tab{
    flex-grow: 1;
    height: calc(100vh - var(--header-height) - 1.25rem * 2);
    overflow-y: auto;
    padding-right: 0; /* space for scrollbar */
    background-image: var(--dashboard-bg);
    background-size: cover;
    background-position: center;
    position:relative;
  }

  .nav-item{
    padding:.6rem 1rem; display: block; width: 100%; text-align: left;
    background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
    border:1px solid var(--stroke-weak);
    border-radius:10px; cursor:pointer; font-weight:700; font-size: 1rem; color:#e8e8e8; letter-spacing:.3px;
    transition: border-color .2s, transform .15s, box-shadow .2s, background .2s;
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.8rem;
  }
  .nav-item .nav-icon {
    width: 20px;
    height: 20px;
    stroke-width: 2.5;
    opacity: 0.7;
  }
  .nav-item:hover{ transform: translateY(-2px); }
  .nav-item.active{
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(var(--accent-rgb),.15) inset, 0 10px 24px rgba(var(--accent-rgb),.10);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
  }
  .nav-item.active .nav-icon {
    opacity: 1;
    stroke: var(--accent-soft);
  }
  .notification-badge {
    position: absolute;
    top: 8px;
    right: 12px;
    background: var(--accent);
    color: #000;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    font-size: 0.8rem;
    font-weight: 900;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
  }


  /* Stat cards (kept) */
  .stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;margin-bottom:1rem}
  .stat-card{
    background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
    border:1px solid var(--stroke-weak);
    padding:1rem;border-radius:var(--card-radius);text-align:center;
    transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease;
  }
  .stat-card:hover{ transform: translateY(-3px); border-color: var(--stroke-strong); box-shadow: 0 14px 28px rgba(0,0,0,.34); }
  .stat-label{color:var(--muted);font-size:.88rem;margin-bottom:.35rem}
  .stat-value{
    font-size:1.6rem;font-weight:900;
  }
  .stat-value.profit{ color: var(--success); }
  .stat-value.loss{ color: var(--danger); }
  .stat-value:not(.profit):not(.loss) {
    background: linear-gradient(90deg, var(--accent-soft), var(--accent));
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent
  }

  .period-selector select{
    background: linear-gradient(180deg, rgba(255,255,255,.065), rgba(255,255,255,.035));
    border:1px solid var(--stroke-weak);
    color:var(--text);padding:.55rem .9rem;border-radius:.6rem;font-size:1rem;appearance:none;padding-right:2.4rem
  }
  select option{background:var(--bg-1);color:var(--text)}

  /* Calendar grid (kept) */
  .weekday-header{
    display:grid;grid-template-columns:repeat(7, minmax(110px,1fr));gap:.6rem;margin-bottom:.25rem;
    text-align:center;color:var(--muted);font-weight:700; letter-spacing:.25px;
  }
  .weekday-header div{padding:.25rem 0}
  .trades-grid{
    display:grid;grid-template-columns:repeat(7, minmax(110px,1fr));gap:.6rem
  }
  .trade-day{
    padding:.85rem;border-radius:12px;text-align:center;border:1px solid var(--stroke-weak);
    background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
    transition: transform .18s, box-shadow .18s, border-color .18s, background .18s;
    cursor:pointer
  }
  .trade-day.weekend{
      /* weekends are allowed now - not disabled */
      opacity: 0.95;
  }
  .trade-day:not(.weekend):hover{
    transform:translateY(-4px);
    border-color:var(--stroke-strong);
    box-shadow: 0 12px 24px rgba(0,0,0,.32), 0 0 0 2px rgba(var(--accent-rgb),.10) inset;
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  }
  /* FULL FILL for win/loss days on dashboard (default; can be overridden dynamically) */
  .trade-day.profit{
    background: linear-gradient(180deg, rgba(45,220,144,.45), rgba(45,220,144,.25)) !important;
    border-color: rgba(45,220,144,.6) !important;
    box-shadow: 0 12px 28px rgba(45,220,144,.12);
  }
  .trade-day.loss{
    background: linear-gradient(180deg, rgba(255,107,107,.45), rgba(255,107,107,.25)) !important;
    border-color: rgba(255,107,107,.6) !important;
    box-shadow: 0 12px 28px rgba(255,107,107,.12);
  }
  .trade-day.placeholder{visibility:hidden;pointer-events:none;border:none}
  .day-number{font-weight:900;margin-bottom:.25rem}
  .pnl{font-weight:900}

  /* Journal list (stretched, non-overlapping) */
  .trades-log{display:grid;grid-template-columns:repeat(auto-fill,minmax(460px,1fr));gap:1rem;margin-top:1rem}
  @media (max-width: 920px){ .trades-log{grid-template-columns:repeat(auto-fill,minmax(380px,1fr));} }
  @media (max-width: 720px){ .trades-log{grid-template-columns:1fr;} }

  .trade-card{
    background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));
    border:1px solid var(--stroke-weak);
    padding:1rem;border-radius:14px; position:relative;
    transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;
  }
  .trade-card:hover{ transform: translateY(-3px); border-color: var(--stroke-strong); box-shadow: 0 14px 28px rgba(0,0,0,.34); }
  .trade-card .trade-actions{ position:static; display:flex; gap:.6rem; justify-content:flex-end; margin-top:.8rem }
  .trade-card p{overflow-wrap:anywhere}
  .trade-card img{display:block;max-width:100%;height:auto;border-radius:.5rem;border:1px solid var(--stroke-weak)}

  /* Chart cards */
  .chart-card{
    background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
    border:1px solid var(--stroke-weak);
    padding:.9rem;border-radius:14px; transition: transform .2s, border-color .2s, box-shadow .2s;
  }
  .chart-card:hover{ transform: translateY(-3px); border-color: var(--stroke-strong); box-shadow: 0 14px 28px rgba(0,0,0,.34); }
  .charts-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:1rem; margin-top:.75rem; }
  .charts-grid .small-donut { max-width: 340px; margin: 0 auto; }

  /* Modals (glass) */
  .modal{display:none;position:fixed;inset:0;background:rgba(4,6,12,0.55);backdrop-filter:blur(12px) saturate(140%);z-index:3000;align-items:center;justify-content:center}
  .modal .modal-content{
    background: linear-gradient(180deg, rgba(16,20,32,.96), rgba(12,16,24,.97));
    padding:1.5rem;border-radius:14px;border:1px solid var(--stroke-strong);max-width:640px;width:92%; box-shadow: var(--shadow-2);
  }
  .modal .modal-content h2 { font-family: var(--font-heading); font-weight: 700; margin-top: 0; }
  .modal .close{float:right;font-size:1.6rem;color:var(--accent-soft);cursor:pointer}

  input[type="text"],input[type="password"],input[type="email"],input[type="number"],textarea,select{
    background:linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));
    border:1px solid var(--stroke-weak); color:var(--text);
    padding:.6rem .75rem;border-radius:.6rem;width:100%;
    outline: 2px solid transparent; transition: outline-color .15s, border-color .15s, box-shadow .15s;
    font-family: var(--font-body);
  }
  input:focus,textarea:focus,select:focus{
    outline-color: rgba(var(--accent-rgb),.22);
    border-color: var(--accent); box-shadow: 0 0 0 3px rgba(var(--accent-rgb),.14);
  }

  /* Improved Date Input */
  .date-input-wrapper { position: relative; }
  input[type="date"] {
      position: relative;
      padding-right: 2.5rem; /* space for icon */
  }
  input[type="date"]::-webkit-calendar-picker-indicator {
      position: absolute;
      top: 0; right: 0; bottom: 0; left: 0;
      width: 100%; height: 100%;
      padding: 0; margin: 0;
      color: transparent;
      background: transparent;
      cursor: pointer;
  }
  .date-input-wrapper::after {
      content: '';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239fb0c8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
      background-size: contain;
      pointer-events: none;
      opacity: 0.7;
  }


  /* Meditation (kept) */
  .meditation-overlay{ position:fixed;inset:0;z-index:4995; display:flex;align-items:center;justify-content:center; backdrop-filter: blur(6px) brightness(.75) }
  .meditation-bg { position:absolute; inset:0; z-index:4996; background: linear-gradient(120deg, rgba(20,40,70,0.7), rgba(40,30,90,0.65), rgba(20,70,80,0.65)); background-size:400% 400%; animation: coolflow 14s ease-in-out infinite; filter: blur(18px) saturate(1.05); opacity:.95; }
  @keyframes coolflow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
  .meditation-screen{position:relative;z-index:4998;display:flex;align-items:center;justify-content:center;flex-direction:column;color:#fff;padding:1rem}
  .meditation-panel{background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));padding:2rem;border-radius:1rem;max-width:720px;width:90%;text-align:center;border:1px solid rgba(255,255,255,0.10)}
  .meditation-panel h2 { font-family: var(--font-heading); font-weight: 700; }
  .meditation-instruction{font-size:1.05rem;margin-bottom:.8rem}
  .meditation-timer{font-weight:900;font-size:1.4rem}

  body.in-meditation header, body.in-meditation main, body.in-meditation footer { filter: blur(3px) brightness(.7); pointer-events: none; user-select: none; }
  /* FIX: Removed pointer-events:none from overlay itself */

  #notification{
    position:fixed;top:18px;right:18px;background:linear-gradient(90deg, rgba(45,220,144,.95), rgba(0,188,212,.85));color:#041616;
    padding:.7rem 1rem;border-radius:.75rem;z-index:3001; font-weight:700; letter-spacing:.2px; box-shadow: 0 10px 22px rgba(var(--accent-rgb),.18);
  }

  footer{
    height:var(--footer-height);
    display:flex;align-items:center;justify-content:center;
    background: linear-gradient(180deg, rgba(10,12,18,.92), rgba(8,10,16,.96));
    border-top:1px solid var(--stroke-weak);
    padding:0 1rem;color:#b9c9e0;z-index:1000;font-size:.95rem;
    flex-shrink: 0;
  }
  footer .inner{width:100%;max-width:1200px;display:flex;align-items:center;justify-content:center;gap:.5rem}
  footer a { color: var(--accent-soft); text-decoration: none; font-weight:700; }

  /* Theme variants (kept) */
  body.theme-redblack { --accent: #ff6b6b; --accent-strong: #ff8585; --accent-soft: #ffbaba; --accent-rgb: 255, 107, 107; --btn-glow: 0 10px 24px rgba(255,107,107,.22); }
  body.theme-blueblack{ --accent:#00bcd4; --accent-strong:#19d1e8; --accent-soft:#9feaff; --accent-rgb: 0, 188, 212; --btn-glow: 0 10px 24px rgba(0,188,212,.22); }
  body.theme-greenblack{ --accent:#2cc97d; --accent-strong:#52e0a0; --accent-soft:#aef5d5; --accent-rgb: 44, 201, 125; --btn-glow: 0 10px 24px rgba(44,201,125,.22); }
  body.theme-purpleblack{ --accent:#a070ff; --accent-strong:#c49bff; --accent-soft:#e1d2ff; --accent-rgb: 160, 112, 255; --btn-glow: 0 10px 24px rgba(160,112,255,.22); }

  /* =================================
       ZEN PAGE OVERHAUL
     ================================= */
  #zenTab .zen-hero {
    padding: 2.5rem 1.5rem;
    border-radius: 18px;
    background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.05), rgba(var(--accent-rgb), 0.15));
    border: 1px solid var(--stroke-weak);
    text-align: center;
  }
  #zenTab .zen-hero h1 { font-family: var(--font-heading); font-weight: 700; font-size: 2.8rem; color: var(--accent-soft); }
  #zenTab .zen-hero p { font-size: 1.1rem; color: var(--muted); max-width: 600px; margin: .5rem auto 0 auto; }
  
  .zen-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }
  .zen-feature-card {
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border: 1px solid var(--stroke-weak);
    padding: 1.5rem;
    border-radius: var(--card-radius);
  }
  .zen-feature-card h3 { font-family: var(--font-heading); font-weight: 700; color: var(--accent-soft); margin-bottom: 1rem; }

  /* Breathing Visualizer */
  .breathing-visualizer {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    gap: 1rem;
  }
  #breathPacer {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 30px rgba(var(--accent-rgb), 0.3);
    transition: transform 3.8s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .breathing-visualizer.active #breathPacer {
    animation: box-breath 16s ease-in-out infinite;
  }
  #breathInstruction { font-size: 1.1rem; font-weight: 700; }
  @keyframes box-breath {
    0%, 100% { transform: scale(0.6); opacity: 0.7; } /* Inhale Start */
    25% { transform: scale(1.0); opacity: 1; }      /* Inhale End / Hold Start */
    50% { transform: scale(1.0); opacity: 1; }      /* Hold End / Exhale Start */
    75% { transform: scale(0.6); opacity: 0.7; }      /* Exhale End / Hold Start */
  }

  /* Soundscapes */
  .soundscape-controls { display: flex; gap: 0.8rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .sound-btn { font-size: 1.5rem; padding: 0.6rem; border-radius: 8px; cursor: pointer; background: rgba(255,255,255,0.05); border: 1px solid var(--stroke-weak); transition: all .2s; }
  .sound-btn:hover { border-color: var(--accent); transform: scale(1.05); }
  .sound-btn.active { background: rgba(var(--accent-rgb), 0.2); border-color: var(--accent); }
  #nowPlayingSound { color: var(--muted); }
  
  /* Meditation Options (re-styled) */
  .meditation-options { display: flex; gap: 1rem; }
  .meditation-option-card {
    flex: 1;
    text-align: center;
    padding: 1.5rem;
    border-radius: 12px;
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025));
    border: 1px solid var(--stroke-weak);
    cursor: pointer;
    transition: transform .2s, box-shadow .2s, border-color .2s;
  }
  .meditation-option-card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 14px 28px rgba(0,0,0,.3); }
  .meditation-option-card h4 { font-family: var(--font-heading); font-weight: 700; font-size: 1.5rem; margin-bottom: .25rem; }
  .meditation-option-card p { color: var(--muted); font-size: 0.9rem; }

  /* Mindfulness Journal */
  #mindfulnessJournal { min-height: 120px; margin-bottom: 0.5rem; }
  .mindfulness-log { margin-top: 1rem; display: grid; gap: .6rem; }
  .mindfulness-note { background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); padding:.8rem; border-radius:10px; border:1px solid var(--stroke-weak); }

  /* =================================
       AI PAGE OVERHAUL
     ================================= */
  #aiTab {
      display: flex;
      flex-direction: column;
      height: 100%;
  }
  .ai-suggested-prompts {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--stroke-weak);
  }
  .ai-prompt-btn {
      padding: .5rem .9rem;
      border-radius: 8px;
      font-size: 0.9rem;
  }
  #aiChatWindow {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem;
      background: rgba(0,0,0,0.06);
      border-radius: 12px;
  }
  .ai-chat-bubble {
      max-width: 80%;
      padding: .8rem 1.1rem;
      border-radius: 18px;
      margin-bottom: 1rem;
      line-height: 1.5;
  }
  .ai-chat-bubble.user {
      background: linear-gradient(135deg, var(--accent-strong), var(--accent));
      color: #071317;
      border-bottom-right-radius: 4px;
      margin-left: auto;
  }
  .ai-chat-bubble.ai {
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke-weak);
      border-bottom-left-radius: 4px;
      margin-right: auto;
      white-space: pre-wrap;
  }
  .ai-chat-bubble.ai ul { margin: .8rem 0; padding-left: 1.5rem; }
  .ai-chat-bubble.ai li { margin-bottom: .5rem; }
  
  .ai-thinking-indicator {
      display: flex;
      gap: 4px;
      align-items: center;
  }
  .ai-thinking-indicator span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--accent-soft);
      animation: ai-pulse 1.4s infinite ease-in-out both;
  }
  .ai-thinking-indicator span:nth-child(1) { animation-delay: -0.32s; }
  .ai-thinking-indicator span:nth-child(2) { animation-delay: -0.16s; }
  @keyframes ai-pulse {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1.0); }
  }

  .ai-input-form {
      display: flex;
      gap: 0.8rem;
      margin-top: 1rem;
  }
  #aiQuestion { flex-grow: 1; }

  /* ADMIN PANEL */
  .admin-user-table { width: 100%; border-collapse: collapse; margin-top: 1rem; table-layout: fixed; }
  .admin-user-table th, .admin-user-table td { padding: 12px 10px; text-align: left; border-bottom: 1px solid var(--stroke-weak); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .admin-user-table th { color: var(--accent-soft); font-weight: 800; }
  .admin-user-table tr.banned-user { background: rgba(var(--accent-rgb), 0.1); }
  .admin-user-table tr.banned-user td { opacity: 0.6; }
  .admin-user-table tr:not(.banned-user):hover { /* Disabled hover effect */ }
  .admin-user-pfp { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 1px solid var(--stroke-strong); vertical-align: middle; margin-right: 10px; }
  .admin-user-info { display: inline-block; vertical-align: middle; }
  .admin-user-info span { display: block; }
  .admin-user-info .email { color: var(--muted); font-size: 0.9em; }
  .admin-activity-log { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 1rem; max-height: 200px; overflow-y: auto; border: 1px solid var(--stroke-weak);}
  .admin-activity-log div { padding: 4px 0; border-bottom: 1px solid var(--stroke-weak); font-size: 0.95em; }
  .admin-activity-log div:last-child { border: none; }
  .btn-ban { background: var(--danger); color: white; padding: .4rem .8rem; font-size: .85em; }
  .btn-unban { background: var(--success); color: white; padding: .4rem .8rem; font-size: .85em; }

  /* Settings Toggle Switch */
  .toggle-switch { display: flex; align-items: center; gap: 10px; }
  .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
  .switch input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.1); transition: .4s; border-radius: 28px; }
  .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
  input:checked + .slider { background-color: var(--accent); }
  input:checked + .slider:before { transform: translateX(22px); }

  /* NEW: Settings Page Redesign */
  #settingsTab .settings-container { display: flex; gap: 1.5rem; }
  #settingsTab .settings-nav { display: flex; flex-direction: column; gap: 0.5rem; width: 200px; flex-shrink: 0; }
  #settingsTab .settings-nav-item {
    padding: .8rem 1rem; border-radius: 10px; font-weight: 700; cursor: pointer;
    border: 1px solid transparent;
  }
  #settingsTab .settings-nav-item:hover { /* Disabled hover effect */ }
  #settingsTab .settings-nav-item.active {
    background: rgba(var(--accent-rgb), 0.1);
    border-color: rgba(var(--accent-rgb), 0.2);
    color: var(--accent-soft);
  }
  #settingsTab .settings-content { flex-grow: 1; }
  #settingsTab .settings-pane { display: none; }
  #settingsTab .settings-pane.active { display: block; }
  #settingsTab .settings-card {
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border: 1px solid var(--stroke-weak);
    padding: 1.5rem;
    border-radius: 14px;
    margin-bottom: 1.5rem;
  }
  #settingsTab .settings-card h3 { font-family: var(--font-heading); font-weight: 700; color: var(--accent-soft); margin-top: 0; margin-bottom: 1rem; }
  #settingsTab .settings-field { margin-bottom: 1.25rem; }
  #settingsTab .settings-field label { display: block; color: var(--muted); margin-bottom: 0.3rem; font-size: 0.9em; }
  #settingsTab .settings-field .field-group { display: flex; gap: 0.5rem; align-items: center; }

  /* NEW: Leaderboard Styles */
  #leaderboardTab .leaderboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  .leaderboard-card {
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border: 1px solid var(--stroke-weak);
    padding: 1.5rem;
    border-radius: 14px;
    text-align: center;
  }
  .leaderboard-card h3 { font-family: var(--font-heading); font-weight: 700; color: var(--accent-soft); }
  .leaderboard-card .rank { font-size: 3rem; font-weight: 900; }
  .leaderboard-card .level { font-size: 1.2rem; color: var(--muted); }

  .leaderboard-list { margin-top: 1.5rem; }
  .leaderboard-item {
    display: flex;
    align-items: center;
    padding: .8rem 1rem;
    border-radius: 10px;
    margin-bottom: .5rem;
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--stroke-weak);
    cursor: pointer;
    transition: background .2s, border-color .2s;
  }
  .leaderboard-item:hover {
      border-color: var(--stroke-strong);
      transform: translateX(4px);
  }
  .leaderboard-item.current-user {
    border-color: var(--accent);
    background: rgba(var(--accent-rgb), 0.1);
  }
  .leaderboard-item .rank { font-size: 1.2rem; font-weight: 900; width: 40px; color: var(--muted); }
  .leaderboard-item .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 1rem; }
  .leaderboard-item .name { font-weight: 700; flex-grow: 1; }
  .leaderboard-item .level { font-weight: 900; color: var(--accent-soft); }
  .leaderboard-item .xp { font-size: .9rem; color: var(--muted); margin-left: 1rem; }

  .podium-item { text-align: center; }
  .podium-item .rank-icon { font-size: 2rem; }
  .podium-item .name { font-weight: 700; font-size: 1.2rem; margin-top: .5rem; }
  .podium-item .level { color: var(--muted); }

  /* NEW: Habit Tracker Styles */
  #habitsTab .habit-grid-container {
    overflow-x: auto;
  }
  #habitsTab .habit-grid {
    display: grid;
    gap: .5rem;
    margin-top: 1rem;
    min-width: 800px;
  }
  #habitsTab .habit-grid-header, #habitsTab .habit-row {
    display: contents; /* Use subgrid-like behavior */
  }
  #habitsTab .habit-grid-header .header-item {
    font-weight: 700;
    color: var(--muted);
    text-align: center;
    font-size: 0.9em;
    padding-bottom: .5rem;
  }
  #habitsTab .habit-grid-header .header-item:first-child {
    text-align: left;
  }
  #habitsTab .habit-row .habit-name {
    padding: .75rem;
    background: rgba(255,255,255,0.03);
    border-radius: 8px;
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #habitsTab .habit-day-cell {
    aspect-ratio: 1 / 1;
    border-radius: 8px;
    background: rgba(255,255,255,0.04);
    cursor: pointer;
    transition: background .2s, transform .2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #habitsTab .habit-day-cell:hover {
    transform: scale(1.1);
  }
  #habitsTab .habit-day-cell.checked {
    background: var(--success);
  }
  #habitsTab .habit-day-cell.checked:before {
    content: '✓';
    color: #fff;
    font-weight: 900;
  }
  #habitsTab .habit-day-cell.is-today {
    border: 2px solid var(--accent);
  }

  /* Grit-Inspired Habit Tracker Styles */
  .grit-habit-card {
    background: var(--bg-secondary);
    border: 1px solid var(--stroke-weak);
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: all 0.3s;
  }
  .grit-habit-card:hover {
    border-color: var(--stroke);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  .habit-week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
    padding: 2px;
  }
  .habit-day {
    aspect-ratio: 1;
    border-radius: 12px;
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.1);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.9rem;
    color: var(--muted);
    transition: all 0.3s;
    position: relative;
  }
  .habit-day:hover {
    background: rgba(255,255,255,0.08);
    border-color: var(--accent);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .habit-day.checked {
    background: linear-gradient(135deg, var(--success), #4ade80);
    border-color: var(--success);
    color: var(--bg-primary);
  }
  .habit-day.checked::after {
    content: '✓';
    position: absolute;
    font-size: 1.2rem;
    font-weight: 900;
  }
  .habit-day.missed {
    background: linear-gradient(135deg, rgba(255,107,107,0.3), rgba(255,107,107,0.2));
    border-color: rgba(255,107,107,0.5);
    color: var(--danger);
  }
  .habit-day.missed::after {
    content: '✗';
    position: absolute;
    font-size: 1.2rem;
    font-weight: 900;
    color: var(--danger);
  }
  .habit-day span {
    font-size: 0.75rem;
    font-weight: 600;
  }
  .habit-day.checked span,
  .habit-day.missed span {
    display: none;
  }
  
  .habit-day.future-day,
  .habit-day.missed {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .habit-day.future-day:hover,
  .habit-day.missed:hover {
    background: rgba(255,255,255,0.05);
    border-color: rgba(255,255,255,0.1);
    box-shadow: none;
  }
  
  .habit-day.future-day {
    background: rgba(255,255,255,0.02);
    border-color: rgba(255,255,255,0.05);
  }
  
  .habit-icon-btn:hover {
    background: rgba(255,255,255,0.1) !important;
    transform: scale(1.1);
  }
  
  /* Journal Emotion Buttons */
  .emotion-btn {
    font-weight: 600;
    color: var(--text);
  }
  .emotion-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .emotion-btn.selected {
    border-width: 3px !important;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  
  #screenshotDropZone:hover {
    border-color: var(--accent);
    background: rgba(255,255,255,0.05);
  }

  @media (max-width:1080px){
    header{ 
      grid-template-columns: 1fr auto auto; 
      grid-auto-flow: row dense;
      padding: 0.8rem 1rem;
    }
    .nav-left{ 
      grid-column: 1 / -1; 
      justify-content:center; 
      order:2;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .nav-right{ 
      grid-column: 1 / -1; 
      justify-content:center; 
      order:3;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .logo{ 
      order:1; 
      text-align:center;
      font-size: 1.6rem;
    }
    .auth-buttons{ 
      order:4; 
      grid-column: 1 / -1; 
      justify-content:center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .home-hero { 
      padding: 4rem 0;
      text-align: center; 
    }
    .hero-text h1 {
      font-size: 3.5rem;
    }
    .hero-text p {
      font-size: 1.2rem;
    }
    .hero-cta { 
      justify-content: center;
      flex-wrap: wrap;
    }
    .home-stats {
      gap: 1rem;
    }
    .home-stat {
      min-width: 140px;
      padding: 0.8rem 1rem;
    }
  }
  @media (max-width:920px){
    #dashboardPage.active .container{ flex-direction: column; height: auto; }
    #sidebar{ position:relative; top:0; height: auto; width: 100%; }
    .weekday-header, .trades-grid{ grid-template-columns:repeat(7, minmax(64px,1fr)); }
    
    /* Enhanced mobile homepage layout */
    #homePage .feature-showcase, #homePage .feature-showcase.reversed { 
      grid-template-columns: 1fr; 
      gap: 3rem;
    }
    #homePage .feature-showcase .text-content, #homePage .feature-showcase.reversed .text-content { 
      grid-row: 1; 
      text-align: center;
      opacity: 1;
      transform: none;
    }
    #homePage .feature-showcase .mockup-content, #homePage .feature-showcase.reversed .mockup-content { 
      grid-row: 2;
      opacity: 1;
      transform: none;
    }
    
    /* Enhanced mobile mockup cards */
    .mockup-card {
      transform: none;
      margin: 0 auto;
      max-width: 90%;
    }
    
    .macbook-mockup {
      transform: none;
      animation: none;
      max-width: 95%;
    }
    
    .feature-showcase-item, .feature-showcase-item:nth-child(even) { grid-template-columns: 1fr; }
    .feature-showcase-item:nth-child(even) .feature-text { grid-column: 1; }
    .feature-showcase-item:nth-child(even) .feature-mockup { grid-column: 1; }
    .team-grid { grid-template-columns: 1fr; }
    #supportPage .support-grid { grid-template-columns: 1fr; }
  }
  @media (max-width:640px){
    .weekday-header, .trades-grid{ grid-template-columns:repeat(7, minmax(44px,1fr)); }
    .day-number{font-size:.95rem}
    
    /* Enhanced mobile hero section */
    .hero-text h1 { 
      font-size: 2.8rem;
      letter-spacing: -1px;
    }
    .hero-text p {
      font-size: 1.1rem;
      line-height: 1.6;
    }
    .hero-cta {
      flex-direction: column;
      gap: 0.8rem;
    }
    .hero-cta button {
      width: 100%;
      max-width: 280px;
    }
    
    /* Enhanced mobile stats */
    .home-stats {
      flex-direction: column;
      gap: 0.8rem;
      align-items: center;
    }
    .home-stat {
      width: 100%;
      max-width: 200px;
    }
    
    /* Enhanced mobile feature sections */
    #homePage .feature-showcase h3 {
      font-size: 2.2rem;
    }
    #homePage .feature-showcase p {
      font-size: 1.1rem;
    }
    
    /* Enhanced mobile mockups */
    .macbook-mockup {
      margin: 2rem auto 0 auto;
      padding: 1rem;
    }
    .macbook-screen {
      flex-direction: column;
      gap: 1rem;
    }
    .macbook-left, .macbook-right {
      width: 100%;
    }
    
    /* Enhanced mobile navigation */
    header {
      padding: 0.6rem 0.8rem;
    }
    .nav-left, .nav-right {
      font-size: 0.9rem;
    }
    .auth-buttons {
      gap: 0.4rem;
    }
    .auth-buttons button {
      padding: 0.5rem 0.8rem;
      font-size: 0.9rem;
    }
    
    #settingsTab .settings-container { flex-direction: column; }
    #settingsTab .settings-nav { flex-direction: row; width: 100%; overflow-x: auto; }
    #leaderboardTab .leaderboard-grid { grid-template-columns: 1fr; }
  }
</style>

<!-- Dynamic color override style (injected by JS) -->
<style id="dynamicColorStyle"></style>
</head>
<body class="page-home">

<!-- Decorative background layers -->
<div class="fx-stripes" aria-hidden="true"></div>
<canvas id="bgCanvas"></canvas>

<header>
  <!-- Left nav group -->
  <nav class="nav-left">
    <a id="homeNav">Home</a>
    <a id="featuresNav">Features</a>
    <a id="aboutNav">About Us</a>
    <a id="subsNav">Subscriptions</a>
  </nav>

  <!-- Centered logo -->
  <div class="logo" id="logo">INTRADEL</div>

  <!-- Right nav group with auth buttons -->
  <div class="nav-right">
    <nav>
      <a id="giveawaysNav">Giveaways</a>
      <a id="supportNav">Support</a>
    </nav>
    <div class="auth-buttons">
      <div class="user-chip">
        <img id="userAvatar" alt="Avatar"/>
        <span id="userDisplay" style="display:none;color:var(--accent-soft)"></span>
      </div>
      <button class="btn-secondary" id="loginBtn">Login</button>
      <button class="btn-primary" id="registerBtn">Register</button>
      <button class="btn-primary" id="logoutBtn" style="display:none">Logout</button>
    </div>
  </div>
</header>

<main>
    <!-- Home Page -->
    <div id="homePage" class="page active">
      <div class="container">
          <section class="home-hero">
              <div class="hero-text">
                  <h1>Master Trading with AI-Powered Precision</h1>
                  <p>Join 10,000+ traders who've transformed their performance with INTRADEL. Get personalized AI insights, emotional mastery tools, and the discipline system that turns consistent profits into reality.</p>
                  <div class="hero-cta">
                      <button class="btn-primary" id="ctaBtn">Start Your Journey</button>
                      <button class="btn-secondary" id="homeToDashboardBtn">See It In Action</button>
                  </div>

                  <div class="home-stats" id="homeStatsRow" aria-live="polite">
                      <div class="home-stat">
                          <div class="label">Active Traders</div>
                          <div class="value" id="homeActive">0</div>
                      </div>
                      <div class="home-stat">
                          <div class="label">Profits Tracked</div>
                          <div class="value" id="homeSubs">$0M</div>
                      </div>
                      <div class="home-stat">
                          <div class="label">Trades Analyzed</div>
                          <div class="value" id="homeTrades">0</div>
                      </div>
                      <div class="home-stat">
                          <div class="label">Success Rate</div>
                          <div class="value" id="homeHelped">0%</div>
                      </div>
                  </div>

                  <div id="hero-3d-card-wrapper">
                      <div class="macbook-mockup">
                          <div class="macbook-topbar">
                              <div class="macbook-dots">
                                  <div class="macbook-dot" style="background:var(--chrome)"></div>
                                  <div class="macbook-dot" style="background:var(--chrome-light)"></div>
                                  <div class="macbook-dot" style="background:var(--accent)"></div>
                              </div>
                              <div style="flex:1;text-align:center;color:var(--muted);font-weight:600;font-size:0.85rem;">Trading Dashboard</div>
                              <div style="width:40px"></div>
                          </div>
                          <div class="macbook-screen">
                              <div class="macbook-left">
                                  <div class="mini-card">
                                      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
                                          <div style="font-weight:700;font-size:0.9rem;color:var(--muted);">Total P&L</div>
                                          <div style="font-size:.75rem;color:var(--muted)">Oct 2024</div>
                                      </div>
                                      <div style="font-weight:900;font-size:1.8rem;color:var(--success);margin-bottom:0.8rem;">+$12,847</div>
                                      <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:0.5rem;">
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">M</div>
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">T</div>
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">W</div>
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">T</div>
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">F</div>
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">S</div>
                                          <div style="font-size:0.6rem;color:var(--muted);text-align:center;font-weight:600;">S</div>
                                      </div>
                                      <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;">
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">1</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$234</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">2</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$567</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(255,107,107,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">3</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--danger);">-$89</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">4</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$412</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">5</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$891</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(255,255,255,0.05);border-radius:3px;"></div>
                                          <div style="aspect-ratio:1;background:rgba(255,255,255,0.05);border-radius:3px;"></div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">8</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$345</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(255,107,107,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">9</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--danger);">-$156</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">10</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$678</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">11</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$523</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">12</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$789</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(255,255,255,0.05);border-radius:3px;"></div>
                                          <div style="aspect-ratio:1;background:rgba(255,255,255,0.05);border-radius:3px;"></div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">15</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$445</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">16</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$612</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(255,107,107,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">17</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--danger);">-$234</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">18</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$934</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(45,220,144,0.3);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2px;">
                                              <div style="font-size:0.5rem;font-weight:600;color:var(--muted);">19</div>
                                              <div style="font-size:0.55rem;font-weight:700;color:var(--success);">+$723</div>
                                          </div>
                                          <div style="aspect-ratio:1;background:rgba(255,255,255,0.05);border-radius:3px;"></div>
                                          <div style="aspect-ratio:1;background:rgba(255,255,255,0.05);border-radius:3px;"></div>
                                      </div>
                                  </div>
                                  <div class="mini-card">
                                      <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.8rem;">
                                          <div>
                                              <div style="font-size:.75rem;color:var(--muted);margin-bottom:0.25rem;">Win Rate</div>
                                              <div style="font-weight:900;color:var(--success);font-size:1.3rem;">68.4%</div>
                                          </div>
                                          <div>
                                              <div style="font-size:.75rem;color:var(--muted);margin-bottom:0.25rem;">Total Trades</div>
                                              <div style="font-weight:900;color:var(--text);font-size:1.3rem;">142</div>
                                          </div>
                                      </div>
                                      <div style="margin-top:0.8rem;padding-top:0.8rem;border-top:1px solid rgba(255,255,255,0.08);">
                                          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.3rem;">
                                              <span style="color:var(--muted);">Avg Win</span>
                                              <span style="color:var(--success);font-weight:700;">+$187</span>
                                          </div>
                                          <div style="display:flex;justify-content:space-between;font-size:0.8rem;">
                                              <span style="color:var(--muted);">Avg Loss</span>
                                              <span style="color:var(--danger);font-weight:700;">-$94</span>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="macbook-right">
                                  <div class="mini-card">
                                      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem">
                                          <div style="font-weight:700;font-size:0.9rem;">Recent Activity</div>
                                          <div style="font-size:.7rem;color:var(--muted);background:rgba(255,255,255,0.05);padding:0.2rem 0.5rem;border-radius:4px;">LIVE</div>
                                      </div>
                                      <div class="mini-list">
                                          <div class="row"><div class="tag" style="font-size:0.75rem;">ES • LONG</div><div style="font-weight:800;color:var(--success);font-size:0.85rem;">+$342</div></div>
                                          <div class="row"><div class="tag" style="font-size:0.75rem;">NQ • LONG</div><div style="font-weight:800;color:var(--success);font-size:0.85rem;">+$278</div></div>
                                          <div class="row"><div class="tag" style="font-size:0.75rem;">AAPL • SHORT</div><div style="font-weight:800;color:var(--danger);font-size:0.85rem;">-$125</div></div>
                                          <div class="row"><div class="tag" style="font-size:0.75rem;">TSLA • LONG</div><div style="font-weight:800;color:var(--success);font-size:0.85rem;">+$584</div></div>
                                          <div class="row"><div class="tag" style="font-size:0.75rem;">SPY • SHORT</div><div style="font-weight:800;color:var(--success);font-size:0.85rem;">+$196</div></div>
                                      </div>
                                  </div>
                                  <div class="mini-card">
                                      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem;">
                                          <div>
                                              <div style="font-size:.75rem;color:var(--muted);margin-bottom:0.2rem;">Today's P&L</div>
                                              <div style="font-weight:900;font-size:1.5rem;color:var(--success);">+$1,275</div>
                                          </div>
                                          <div style="text-align:right;">
                                              <div style="font-size:.7rem;color:var(--muted);margin-bottom:0.2rem;">Streak</div>
                                              <div style="font-weight:900;font-size:1.2rem;color:var(--accent-soft);">7 Days</div>
                                          </div>
                                      </div>
                                      <div style="padding-top:0.8rem;border-top:1px solid rgba(255,255,255,0.08);display:flex;gap:1rem;">
                                          <div style="flex:1;">
                                              <div style="font-size:0.7rem;color:var(--muted);margin-bottom:0.3rem;">Level</div>
                                              <div style="font-weight:900;color:var(--accent-soft);font-size:1.1rem;">24</div>
                                          </div>
                                          <div style="flex:1;">
                                              <div style="font-size:0.7rem;color:var(--muted);margin-bottom:0.3rem;">XP</div>
                                              <div style="font-weight:900;color:var(--text);font-size:1.1rem;">8,420</div>
                                          </div>
                                          <div style="flex:1;">
                                              <div style="font-size:0.7rem;color:var(--muted);margin-bottom:0.3rem;">Rank</div>
                                              <div style="font-weight:900;color:var(--success);font-size:1.1rem;">#142</div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </section>

          <section class="home-section">
            <div class="feature-showcase">
                <div class="text-content">
                    <h3>Precision Journaling</h3>
                    <p>Capture every trade with surgical precision. Log setups, emotions, and outcomes to build a comprehensive trading database that reveals your true edge.</p>
                </div>
                <div class="mockup-content">
                    <div id="mockup-journal-card" class="mockup-card">
                        <!-- High-fidelity HTML Journal Card Mockup -->
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.25rem">
                            <div style="display:flex;gap:.35rem;flex-wrap:wrap">
                                <span class="mock-tag">#SPY</span>
                                <span class="mock-tag">LONG</span>
                                <span class="mock-tag mock-pnl-tag">$345.20</span>
                            </div>
                            <span class="mock-tag" style="background: rgba(from var(--mock-success-color) r g b / 0.1); color: var(--mock-success-color);">WIN</span>
                        </div>
                        <div style="color:var(--muted); font-size: 0.9em;">2025-10-17</div>
                        <p id="mockJournalText" style="color:var(--muted);margin-top:.6rem;white-space:pre-wrap">Break and retest of key level after morning consolidation. Entry was clean, could have held for longer.</p>
                        <div style="display:flex; gap:.6rem; justify-content:flex-end; margin-top:.8rem">
                            <button class="btn-secondary" id="mockJournalEditBtn" style="font-size: 0.8em; padding: .4rem .8rem; cursor: pointer;">Edit</button>
                            <button class="btn-secondary" style="font-size: 0.8em; padding: .4rem .8rem; pointer-events: none;">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
          </section>

          <section class="home-section">
            <div class="feature-showcase">
                <div class="text-content">
                    <h3>AI-Powered Mentor</h3>
                    <p>Get personalized coaching from IntradelAI. Our advanced AI analyzes your trading patterns to identify weaknesses, suggest improvements, and help you overcome emotional trading.</p>
                </div>
                <div class="mockup-content">
                    <div id="mockup-ai-card" class="mockup-card">
                         <div class="bento-ai-chat" id="mockAiChat">
                            <div class="line user">> How can I improve my entries?</div>
                            <div class="line ai" id="ai-typewriter"></div>
                        </div>
                        <div style="margin-top:1rem;display:flex;gap:0.5rem;">
                            <input type="text" id="mockAiInput" placeholder="Ask the AI a question..." style="flex:1;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:0.6rem;border-radius:8px;color:var(--text);font-size:0.85rem;font-family:monospace;">
                            <button class="btn-primary" id="mockAiSendBtn" style="padding:0.6rem 1rem;font-size:0.85rem;">Send</button>
                        </div>
                    </div>
                </div>
            </div>
          </section>

          <section class="home-section">
            <div class="feature-showcase reversed">
                <div class="text-content">
                    <h3>Master Your Mind with ZEN</h3>
                    <p>Transform emotional trading into disciplined execution. Use guided meditations, breathing exercises, and focus soundscapes to maintain peak mental performance.</p>
                </div>
                <div class="mockup-content">
                    <div class="mockup-card">
                        <div class="zen-pulse-mockup">
                            <div class="zen-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>
          </section>

          <section class="home-section">
            <div class="feature-showcase">
                <div class="text-content">
                    <h3>Complete Customization</h3>
                    <p>Create your perfect trading environment. Customize colors, themes, and layouts to match your style. Upload custom backgrounds and create a workspace that inspires confidence.</p>
                </div>
                <div class="mockup-content">
                    <div id="mockup-color-card" class="mockup-card">
                        <div class="color-picker-mockup">
                            <div class="color-swatch">
                                <div class="swatch-box" id="swatch-accent-box" data-picker="mock-color-accent"></div>
                                <span>Accent</span>
                                <input type="color" id="mock-color-accent" value="#ff6b6b" data-target="accent">
                            </div>
                            <div class="color-swatch">
                                <div class="swatch-box" id="swatch-win-box" data-picker="mock-color-win"></div>
                                <span>Win</span>
                                <input type="color" id="mock-color-win" value="#2ddc90" data-target="success">
                            </div>
                            <div class="color-swatch">
                                <div class="swatch-box" id="swatch-loss-box" data-picker="mock-color-loss"></div>
                                <span>Loss</span>
                                <input type="color" id="mock-color-loss" value="#ff6b6b" data-target="danger">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          </section>

          <section class="home-section final-cta">
              <div class="final-cta-wrapper">
                  <div>
                      <h2>Ready to Transform Your Trading?</h2>
                      <p>Join 10,000+ traders who've mastered their craft with INTRADEL. Start your journey to consistent profitability today.</p>
                      <button class="btn-primary" id="finalCtaRegisterBtn" style="padding: 1.2rem 2.5rem; font-size: 1.2rem;">Start Now</button>
                  </div>
              </div>
          </section>
      </div>
    </div>

    <!-- Features Page -->
    <div id="featuresPage" class="page">
        <div class="container">
            <!-- Enhanced Hero Section -->
            <div class="hero" style="text-align: center; margin-bottom: 4rem;">
                <div style="display: inline-block; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); padding: 0.5rem 1.5rem; border-radius: 50px; margin-bottom: 1.5rem; font-weight: 600; font-size: 0.9rem; letter-spacing: 0.5px;">
                    🚀 POWERED BY AI • TRUSTED BY 10,000+ TRADERS
                </div>
                <h1 style="font-size: 3.5rem; font-weight: 900; margin-bottom: 1.5rem; background: linear-gradient(135deg, #ffffff, var(--accent-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Your Complete Trading Arsenal
                </h1>
                <p style="font-size: 1.3rem; color: var(--muted); max-width: 800px; margin: 0 auto 2rem; line-height: 1.7;">
                    Transform your trading with the world's most advanced journaling platform. 
                    <strong style="color: var(--accent);">AI-powered insights</strong>, 
                    <strong style="color: var(--success);">emotional mastery tools</strong>, and 
                    <strong style="color: var(--accent-strong);">gamified discipline</strong> 
                    — all in one powerful ecosystem.
                </p>
                <div style="display: flex; gap: 2rem; justify-content: center; align-items: center; margin-top: 2rem; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--accent);">10,000+</div>
                        <div style="color: var(--muted); font-size: 0.9rem;">Active Traders</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: var(--stroke-weak);"></div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--success);">$2.3M+</div>
                        <div style="color: var(--muted); font-size: 0.9rem;">Profits Tracked</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: var(--stroke-weak);"></div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: 900; color: var(--accent-strong);">94%</div>
                        <div style="color: var(--muted); font-size: 0.9rem;">Success Rate</div>
                    </div>
                </div>
            </div>

            <!-- Core Features Section -->
            <div style="margin-bottom: 5rem;">
                <h2 style="text-align: center; font-size: 2.5rem; font-weight: 800; margin-bottom: 3rem; color: var(--text);">
                    Core Trading Tools
                </h2>
                <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                    <!-- Advanced Journaling -->
                    <div class="feature-card" style="background: linear-gradient(135deg, rgba(255,107,107,0.08), rgba(255,107,107,0.03)); border: 1px solid rgba(255,107,107,0.2); position: relative; overflow: hidden;">
                        <div class="icon" style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">📈</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">Advanced Trade Journaling</h3>
                        <p style="color: var(--muted); margin-bottom: 1.5rem; line-height: 1.6;">
                            Log every trade with surgical precision. Capture screenshots, custom tags, emotional state, 
                            and rule adherence to build a comprehensive trading database.
                        </p>
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 0.5rem;">Key Features:</div>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 0.3rem 0; color: var(--text);">• Screenshot capture & annotation</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Custom field creation</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Emotional state tracking</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Rule adherence monitoring</li>
                            </ul>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--success); font-weight: 600;">
                            <span>✓</span> <span>Used by 10,000+ traders</span>
                        </div>
                    </div>

                    <!-- AI Performance Coach -->
                    <div class="feature-card" style="background: linear-gradient(135deg, rgba(45,220,144,0.08), rgba(45,220,144,0.03)); border: 1px solid rgba(45,220,144,0.2); position: relative; overflow: hidden;">
                        <div class="icon" style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--success), #4ade80); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">🤖</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">AI Performance Coach</h3>
                        <p style="color: var(--muted); margin-bottom: 1.5rem; line-height: 1.6;">
                            Your personal trading mentor powered by advanced AI. Get instant feedback on patterns, 
                            identify weaknesses, and receive actionable recommendations to improve your edge.
                        </p>
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 0.5rem;">AI Insights:</div>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 0.3rem 0; color: var(--text);">• Pattern recognition & analysis</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• FOMO & revenge trading detection</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Personalized improvement tips</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Risk management recommendations</li>
                            </ul>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--success); font-weight: 600;">
                            <span>✓</span> <span>Runs 100% locally on your device</span>
                        </div>
                    </div>

                    <!-- ZEN Focus Mode -->
                    <div class="feature-card" style="background: linear-gradient(135deg, rgba(139,69,19,0.08), rgba(139,69,19,0.03)); border: 1px solid rgba(139,69,19,0.2); position: relative; overflow: hidden;">
                        <div class="icon" style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, #d97706, #f59e0b); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">🧘</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">ZEN Focus Mode</h3>
                        <p style="color: var(--muted); margin-bottom: 1.5rem; line-height: 1.6;">
                            Master your emotions with guided meditations, breathing exercises, and focus soundscapes. 
                            Transform emotional trading into disciplined execution.
                        </p>
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 0.5rem;">ZEN Tools:</div>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 0.3rem 0; color: var(--text);">• Pre-trade meditation sessions</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Breathing exercises & techniques</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Focus soundscapes & binaural beats</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Post-trade reflection guides</li>
                            </ul>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--success); font-weight: 600;">
                            <span>✓</span> <span>Proven to reduce emotional trading by 67%</span>
                        </div>
                    </div>

                    <!-- Gamified Leveling -->
                    <div class="feature-card" style="background: linear-gradient(135deg, rgba(168,85,247,0.08), rgba(168,85,247,0.03)); border: 1px solid rgba(168,85,247,0.2); position: relative; overflow: hidden;">
                        <div class="icon" style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, #a855f7, #c084fc); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">🏆</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">Gamified Discipline</h3>
                        <p style="color: var(--muted); margin-bottom: 1.5rem; line-height: 1.6;">
                            Turn trading discipline into an engaging game. Earn XP, level up, and compete on leaderboards 
                            while building the habits that lead to consistent profitability.
                        </p>
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 0.5rem;">Gamification Features:</div>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 0.3rem 0; color: var(--text);">• XP system for consistent journaling</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Achievement badges & milestones</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Global leaderboards & rankings</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Streak tracking & rewards</li>
                            </ul>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--success); font-weight: 600;">
                            <span>✓</span> <span>Increases journaling consistency by 340%</span>
                        </div>
                    </div>

                    <!-- Full Customization -->
                    <div class="feature-card" style="background: linear-gradient(135deg, rgba(236,72,153,0.08), rgba(236,72,153,0.03)); border: 1px solid rgba(236,72,153,0.2); position: relative; overflow: hidden;">
                        <div class="icon" style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, #ec4899, #f472b6); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">🎨</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">Complete Customization</h3>
                        <p style="color: var(--muted); margin-bottom: 1.5rem; line-height: 1.6;">
                            Make INTRADEL truly yours. Customize colors, themes, layouts, and even upload your own 
                            backgrounds to create the perfect trading environment.
                        </p>
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 0.5rem;">Customization Options:</div>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="padding: 0.3rem 0; color: var(--text);">• 50+ color themes & gradients</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Custom background uploads</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Layout & component arrangement</li>
                                <li style="padding: 0.3rem 0; color: var(--text);">• Font & typography settings</li>
                            </ul>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--success); font-weight: 600;">
                            <span>✓</span> <span>Unlimited customization options</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Features Section -->
            <div style="margin-bottom: 5rem;">
                <h2 style="text-align: center; font-size: 2.5rem; font-weight: 800; margin-bottom: 3rem; color: var(--text);">
                    Advanced Features
                </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem;">
                    <!-- Habit Tracking -->
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 1rem;">🎯</div>
                        <h3 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">Habit & Rule Tracking</h3>
                        <p style="color: var(--muted); line-height: 1.6;">
                            Build and maintain the habits that lead to trading success. Track your daily routines, 
                            rule adherence, and discipline metrics.
                        </p>
                    </div>

                    <!-- Data Import/Export -->
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 1rem;">📤</div>
                        <h3 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">Data Portability</h3>
                        <p style="color: var(--muted); line-height: 1.6;">
                            Import from other platforms or export your data anytime. Your trading data belongs to you, 
                            always accessible and portable.
                        </p>
                    </div>

                    <!-- API Access -->
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 1rem;">🔌</div>
                        <h3 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">API Integration</h3>
                        <p style="color: var(--muted); line-height: 1.6;">
                            Connect with your favorite trading platforms and tools. Build custom integrations 
                            and automate your workflow.
                        </p>
                    </div>

                    <!-- Priority Support -->
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 1rem;">🎧</div>
                        <h3 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem; color: var(--text);">Priority Support</h3>
                        <p style="color: var(--muted); line-height: 1.6;">
                            Get dedicated support from our team of trading experts. Fast response times, 
                            personalized onboarding, and feature requests.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Testimonials Section -->
            <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid var(--stroke-weak); border-radius: 20px; padding: 3rem; margin-bottom: 4rem;">
                <h2 style="text-align: center; font-size: 2.2rem; font-weight: 800; margin-bottom: 3rem; color: var(--text);">
                    What Our Traders Say
                </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div class="testimonial-card" style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <div style="color: #fbbf24;">★★★★★</div>
                            <span style="color: var(--muted); font-size: 0.9rem;">5.0</span>
                        </div>
                        <p style="color: var(--text); font-style: italic; margin-bottom: 1rem; line-height: 1.6;">
                            "INTRADEL transformed my trading. The AI insights helped me identify patterns I never saw before. 
                            My win rate increased from 45% to 78% in just 3 months."
                        </p>
                        <div style="font-weight: 600; color: var(--accent);">— Sarah M., Day Trader</div>
                    </div>
                    <div class="testimonial-card" style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <div style="color: #fbbf24;">★★★★★</div>
                            <span style="color: var(--muted); font-size: 0.9rem;">5.0</span>
                        </div>
                        <p style="color: var(--text); font-style: italic; margin-bottom: 1rem; line-height: 1.6;">
                            "The ZEN features are game-changing. I used to make emotional trades, but the meditation 
                            sessions and breathing exercises keep me focused and disciplined."
                        </p>
                        <div style="font-weight: 600; color: var(--accent);">— Marcus T., Swing Trader</div>
                    </div>
                    <div class="testimonial-card" style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <div style="color: #fbbf24;">★★★★★</div>
                            <span style="color: var(--muted); font-size: 0.9rem;">5.0</span>
                        </div>
                        <p style="color: var(--text); font-style: italic; margin-bottom: 1rem; line-height: 1.6;">
                            "The gamification aspect makes journaling addictive in the best way. I actually look forward 
                            to logging my trades and seeing my progress."
                        </p>
                        <div style="font-weight: 600; color: var(--accent);">— Alex R., Options Trader</div>
                    </div>
                </div>
            </div>

            <!-- Call to Action -->
            <div style="text-align: center; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); border-radius: 20px; padding: 3rem; margin-bottom: 2rem;">
                <h2 style="font-size: 2.5rem; font-weight: 900; margin-bottom: 1rem; color: white;">
                    Ready to Transform Your Trading?
                </h2>
                <p style="font-size: 1.2rem; margin-bottom: 2rem; color: rgba(255,255,255,0.9);">
                    Join thousands of successful traders who have already discovered their edge with INTRADEL.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn-primary cta-button" style="background: white; color: var(--accent); font-weight: 700; padding: 1rem 2rem; font-size: 1.1rem;">
                        View Pricing
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="aboutPage" class="page">
        <div class="container">
            <!-- Enhanced Hero Section -->
            <div class="hero" style="text-align: center; padding: 4rem 1.5rem 3rem; position: relative;">
                <div style="display: inline-block; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); padding: 0.5rem 1.5rem; border-radius: 50px; margin-bottom: 1.5rem; font-weight: 600; font-size: 0.9rem; letter-spacing: 0.5px; text-transform: uppercase;">
                    🚀 Our Story
                </div>
                <h1 style="font-size: 3.5rem; font-weight: 900; margin-bottom: 1.5rem; background: linear-gradient(135deg, #ffffff, var(--accent-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    From Struggle to Solution
                </h1>
                <p style="font-size: 1.3rem; color: var(--muted); max-width: 800px; margin: 0 auto 3rem; line-height: 1.7;">
                    Born from frustration, built with precision. INTRADEL is the trading journal we wished existed when we needed it most.
                </p>
            </div>

            <!-- Mission Statement -->
            <div style="max-width: 1000px; margin: 0 auto 4rem; padding: 2.5rem; background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.08), rgba(var(--accent-rgb), 0.03)); border: 1px solid rgba(var(--accent-rgb), 0.2); border-radius: 20px; text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">💡</div>
                <h2 style="font-family: var(--font-heading); font-size: 2rem; font-weight: 700; color: var(--accent-soft); margin-bottom: 1rem;">Our Mission</h2>
                <p style="font-size: 1.2rem; color: var(--text); line-height: 1.8; max-width: 700px; margin: 0 auto;">
                    To transform emotional traders into disciplined professionals through data-driven insights, AI-powered guidance, and a community that celebrates consistency over chaos.
                </p>
            </div>

            <!-- Founder Stories Grid -->
            <div class="team-grid" style="gap: 2.5rem; margin-bottom: 4rem;">
                <div class="team-member-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); padding: 2.5rem; border-radius: 20px; position: relative; overflow: hidden; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 900; color: white;">A</div>
                        <div>
                            <h3 style="font-size: 1.8rem; margin-bottom: 0.25rem;">Alex R.</h3>
                            <p class="role" style="color: var(--accent-soft); font-weight: 700; margin: 0;">Lead Trader & Co-founder</p>
                        </div>
                    </div>
                    <div style="padding-left: 1rem; border-left: 3px solid var(--accent); margin-bottom: 1rem;">
                        <p style="font-style: italic; color: var(--muted); margin-bottom: 1rem; line-height: 1.7;">
                            "For years, I was stuck in a boom-and-bust cycle. I'd have a great week, get overconfident, and give it all back. My notebooks were a mess of charts and angry scribbles. I knew the data held the key, but I couldn't connect the dots."
                        </p>
                    </div>
                    <p style="color: var(--text); line-height: 1.7; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 12px;">
                        "We built INTRADEL to be the coach I never had—to cut through the emotional noise and show me the hard truths in my own data. It forced me to be objective and turned my biggest weaknesses into my greatest strengths."
                    </p>
                </div>
                
                <div class="team-member-card" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); padding: 2.5rem; border-radius: 20px; position: relative; overflow: hidden; transition: all 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, var(--success), #52e0a0); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 900; color: white;">M</div>
                        <div>
                            <h3 style="font-size: 1.8rem; margin-bottom: 0.25rem;">Maya T.</h3>
                            <p class="role" style="color: var(--accent-soft); font-weight: 700; margin: 0;">Product & Co-founder</p>
                        </div>
                    </div>
                    <div style="padding-left: 1rem; border-left: 3px solid var(--success); margin-bottom: 1rem;">
                        <p style="font-style: italic; color: var(--muted); margin-bottom: 1rem; line-height: 1.7;">
                            "My struggle wasn't with strategy, but with consistency. I'd try a new journaling app every month, but nothing stuck. They were either too simple to be useful or too complex to be practical. I spent more time configuring fields than analyzing trades."
                        </p>
                    </div>
                    <p style="color: var(--text); line-height: 1.7; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 12px;">
                        "With INTRADEL, we focused on a seamless workflow. Journaling had to be fast, and the insights had to be immediate. Adding gamification through the leveling system was the final piece—it makes the daily habit of discipline feel rewarding, not like a chore."
                    </p>
                </div>
            </div>

            <!-- Company Values -->
            <div style="margin-bottom: 4rem;">
                <h2 style="text-align: center; font-size: 2.5rem; font-weight: 900; margin-bottom: 3rem; background: linear-gradient(135deg, #ffffff, var(--accent-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">What Drives Us</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                    <div style="padding: 2rem; background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid var(--stroke-weak); border-radius: 16px; text-align: center; transition: all 0.3s ease;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                        <h3 style="color: var(--accent-soft); font-weight: 700; margin-bottom: 0.75rem;">Data-Driven</h3>
                        <p style="color: var(--muted); line-height: 1.6;">Numbers don't lie. We believe in making decisions based on cold, hard data—not gut feelings.</p>
                    </div>
                    <div style="padding: 2rem; background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid var(--stroke-weak); border-radius: 16px; text-align: center; transition: all 0.3s ease;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🧘</div>
                        <h3 style="color: var(--accent-soft); font-weight: 700; margin-bottom: 0.75rem;">Mental Mastery</h3>
                        <p style="color: var(--muted); line-height: 1.6;">The best strategy means nothing without emotional control. We prioritize mental fitness.</p>
                    </div>
                    <div style="padding: 2rem; background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid var(--stroke-weak); border-radius: 16px; text-align: center; transition: all 0.3s ease;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🤝</div>
                        <h3 style="color: var(--accent-soft); font-weight: 700; margin-bottom: 0.75rem;">Community First</h3>
                        <p style="color: var(--muted); line-height: 1.6;">Trading can be lonely. We're building a supportive community that lifts everyone up.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subscriptions Page -->
    <div id="subscriptionsPage" class="page">
      <div class="container">
        <div class="hero">
          <h1>Choose Your Edge</h1>
          <p>Unlock every feature with the Elite plan. Upgrade or cancel anytime.</p>
        </div>
        <div class="pricing-grid">
            <div class="pricing-card recommended">
                <h3>Elite</h3>
                <p class="price">$39 <span style="font-size: 1rem; font-weight: 500;">/ month</span></p>
                <p class="price-note">For dedicated traders who want every possible edge.</p>
                <ul>
                    <li>Unlimited Journal Entries</li>
                    <li>Advanced Statistics & Charts</li>
                    <li>Full ZEN Meditation Library</li>
                    <li>AI-Powered Mentor</li>
                    <li>Leaderboard Access</li>
                    <li>Data Import/Export</li>
                    <li>Full Color Customization</li>
                    <li>Priority Support & Feature Requests</li>
                    <li>Early Access to New Features</li>
                    <li>Exclusive "Elite" Giveaways</li>
                    <li>Advanced AI Models (Beta)</li>
                    <li>Animated Profile Avatars</li>
                    <li>API Access (Coming Soon)</li>
                    <li>One-on-one Onboarding Call</li>
                </ul>
                <button class="btn-primary" id="planEliteBtn">Go Elite</button>
            </div>
        </div>
      </div>
    </div>

    <div id="giveawaysPage" class="page"> 
        <div class="container"> 
            <!-- Enhanced Hero Section -->
            <div class="hero" style="text-align: center; padding: 4rem 1.5rem 3rem; position: relative;">
                <div style="display: inline-block; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); padding: 0.5rem 1.5rem; border-radius: 50px; margin-bottom: 1.5rem; font-weight: 600; font-size: 0.9rem; letter-spacing: 0.5px; text-transform: uppercase;">
                    🎁 Rewards & Recognition
                </div>
                <h1 style="font-size: 3.5rem; font-weight: 900; margin-bottom: 1.5rem; background: linear-gradient(135deg, #ffffff, var(--accent-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Win Big, Trade Better
                </h1>
                <p style="font-size: 1.3rem; color: var(--muted); max-width: 800px; margin: 0 auto 3rem; line-height: 1.7;">
                    We believe in rewarding discipline, consistency, and excellence. Join our competitions and win prizes that can change your trading career.
                </p>
            </div>

            <!-- Featured Prize Banner -->
            <div style="margin-bottom: 4rem; padding: 3rem; background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.15), rgba(var(--accent-rgb), 0.05)); border: 2px solid var(--accent); border-radius: 24px; text-align: center; position: relative; overflow: hidden;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">🏆</div>
                <h2 style="font-size: 2.5rem; font-weight: 900; color: var(--accent-soft); margin-bottom: 1rem;">Current Challenge: $50K Funded Account</h2>
                <p style="font-size: 1.2rem; color: var(--text); margin-bottom: 1.5rem; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Compete for a chance to trade with real capital. Top 3 traders this month win funded accounts with our partner prop firms.
                </p>
                <div style="display: inline-block; padding: 0.8rem 2rem; background: var(--accent); color: white; font-weight: 700; border-radius: 50px; font-size: 1.1rem;">
                    Ends in 12 Days
                </div>
            </div>

            <!-- Giveaway Categories -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; margin-bottom: 4rem;">
                <!-- Funded Accounts -->
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 20px; padding: 2.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="font-size: 3.5rem; margin-bottom: 1.5rem;">💰</div>
                    <h3 style="font-size: 1.8rem; font-weight: 700; color: var(--accent-soft); margin-bottom: 1rem;">Funded Account Challenges</h3>
                    <div style="display: inline-block; padding: 0.4rem 1rem; background: rgba(var(--accent-rgb), 0.2); border-radius: 20px; color: var(--accent-soft); font-weight: 700; font-size: 0.85rem; margin-bottom: 1rem;">
                        🔥 MONTHLY
                    </div>
                    <p style="color: var(--muted); line-height: 1.7; margin-bottom: 1.5rem;">
                        The ultimate prize. Top performers in our leaderboard competitions get the chance to trade a funded account with our prop firm partners, keeping a majority of the profits.
                    </p>
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 12px; border-left: 3px solid var(--accent);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--muted); font-size: 0.9rem;">Prize Pool</span>
                            <span style="color: var(--accent-soft); font-weight: 700;">$150K Total</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--muted); font-size: 0.9rem;">Winners</span>
                            <span style="color: var(--accent-soft); font-weight: 700;">Top 3 Traders</span>
                        </div>
                    </div>
                </div>

                <!-- Lifetime Subscriptions -->
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 20px; padding: 2.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="font-size: 3.5rem; margin-bottom: 1.5rem;">🎟️</div>
                    <h3 style="font-size: 1.8rem; font-weight: 700; color: var(--success); margin-bottom: 1rem;">Lifetime Subscription Raffles</h3>
                    <div style="display: inline-block; padding: 0.4rem 1rem; background: rgba(45,220,144,0.2); border-radius: 20px; color: var(--success); font-weight: 700; font-size: 0.85rem; margin-bottom: 1rem;">
                        ⚡ QUARTERLY
                    </div>
                    <p style="color: var(--muted); line-height: 1.7; margin-bottom: 1.5rem;">
                        As a thank you to our Pro and Elite members, we regularly raffle off lifetime INTRADEL subscriptions. One payment, and you're set for life.
                    </p>
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 12px; border-left: 3px solid var(--success);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--muted); font-size: 0.9rem;">Value</span>
                            <span style="color: var(--success); font-weight: 700;">$5,000+</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--muted); font-size: 0.9rem;">Winners</span>
                            <span style="color: var(--success); font-weight: 700;">5 Per Quarter</span>
                        </div>
                    </div>
                </div>

                <!-- Journal Competitions -->
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 20px; padding: 2.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="font-size: 3.5rem; margin-bottom: 1.5rem;">📝</div>
                    <h3 style="font-size: 1.8rem; font-weight: 700; color: #c49bff; margin-bottom: 1rem;">Best Journal Entry Awards</h3>
                    <div style="display: inline-block; padding: 0.4rem 1rem; background: rgba(160,112,255,0.2); border-radius: 20px; color: #c49bff; font-weight: 700; font-size: 0.85rem; margin-bottom: 1rem;">
                        📅 WEEKLY
                    </div>
                    <p style="color: var(--muted); line-height: 1.7; margin-bottom: 1.5rem;">
                        The best trade isn't always the most profitable. We run competitions for the most insightful, well-documented journal entries, rewarding thoughtful analysis over pure P&L.
                    </p>
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 12px; border-left: 3px solid #c49bff;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--muted); font-size: 0.9rem;">Prize</span>
                            <span style="color: #c49bff; font-weight: 700;">$500 Cash</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--muted); font-size: 0.9rem;">Winners</span>
                            <span style="color: #c49bff; font-weight: 700;">1 Per Week</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- How to Enter Section -->
            <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid var(--stroke-weak); border-radius: 20px; padding: 3rem; text-align: center;">
                <h2 style="font-size: 2.2rem; font-weight: 900; margin-bottom: 2rem; color: var(--accent-soft);">How to Enter</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; max-width: 800px; margin: 0 auto;">
                    <div>
                        <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 900; color: white;">1</div>
                        <h4 style="color: var(--text); font-weight: 700; margin-bottom: 0.5rem;">Be Active</h4>
                        <p style="color: var(--muted); font-size: 0.95rem;">Journal daily and maintain consistency</p>
                    </div>
                    <div>
                        <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 900; color: white;">2</div>
                        <h4 style="color: var(--text); font-weight: 700; margin-bottom: 0.5rem;">Climb Leaderboard</h4>
                        <p style="color: var(--muted); font-size: 0.95rem;">Gain XP and rise in rankings</p>
                    </div>
                    <div>
                        <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 900; color: white;">3</div>
                        <h4 style="color: var(--text); font-weight: 700; margin-bottom: 0.5rem;">Win Prizes</h4>
                        <p style="color: var(--muted); font-size: 0.95rem;">Get rewarded for your dedication</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="supportPage" class="page"> 
        <div class="container"> 
            <!-- Enhanced Hero Section -->
            <div class="hero" style="text-align: center; padding: 4rem 1.5rem 3rem; position: relative;">
                <div style="display: inline-block; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); padding: 0.5rem 1.5rem; border-radius: 50px; margin-bottom: 1.5rem; font-weight: 600; font-size: 0.9rem; letter-spacing: 0.5px; text-transform: uppercase;">
                    💬 Help Center
                </div>
                <h1 style="font-size: 3.5rem; font-weight: 900; margin-bottom: 1.5rem; background: linear-gradient(135deg, #ffffff, var(--accent-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    We're Here to Help
                </h1>
                <p style="font-size: 1.3rem; color: var(--muted); max-width: 800px; margin: 0 auto 3rem; line-height: 1.7;">
                    Find answers to common questions or reach out to our support team. We're committed to your success.
                </p>
            </div>

            <!-- Quick Actions -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 4rem;">
                <div style="background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.1), rgba(var(--accent-rgb), 0.05)); border: 1px solid rgba(var(--accent-rgb), 0.2); border-radius: 16px; padding: 2rem; text-align: center; transition: all 0.3s ease;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📧</div>
                    <h3 style="color: var(--accent-soft); font-weight: 700; margin-bottom: 0.75rem; font-size: 1.3rem;">Email Support</h3>
                    <p style="color: var(--muted); margin-bottom: 1rem; line-height: 1.6;">Get help from our team</p>
                    <a href="mailto:support@intradel.ai" style="color: var(--accent-soft); font-weight: 700; text-decoration: none;">support@intradel.ai</a>
                </div>
                <div style="background: linear-gradient(135deg, rgba(45,220,144,0.1), rgba(45,220,144,0.05)); border: 1px solid rgba(45,220,144,0.2); border-radius: 16px; padding: 2rem; text-align: center; transition: all 0.3s ease;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📞</div>
                    <h3 style="color: var(--success); font-weight: 700; margin-bottom: 0.75rem; font-size: 1.3rem;">Phone Support</h3>
                    <p style="color: var(--muted); margin-bottom: 1rem; line-height: 1.6;">Talk to a real person</p>
                    <div style="color: var(--success); font-weight: 700;">+1 (555) 012-3456</div>
                    <div style="color: var(--muted); font-size: 0.85rem; margin-top: 0.5rem;">Mon-Fri 9am - 5pm EST</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(160,112,255,0.1), rgba(160,112,255,0.05)); border: 1px solid rgba(160,112,255,0.2); border-radius: 16px; padding: 2rem; text-align: center; transition: all 0.3s ease;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">💬</div>
                    <h3 style="color: #c49bff; font-weight: 700; margin-bottom: 0.75rem; font-size: 1.3rem;">Live Chat</h3>
                    <p style="color: var(--muted); margin-bottom: 1rem; line-height: 1.6;">Instant answers</p>
                    <div style="color: #c49bff; font-weight: 700;">Coming Soon</div>
                </div>
            </div>

            <!-- FAQ Section -->
            <div style="margin-bottom: 4rem;">
                <h2 style="text-align: center; font-size: 2.5rem; font-weight: 900; margin-bottom: 3rem; background: linear-gradient(135deg, #ffffff, var(--accent-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Frequently Asked Questions</h2>
                
                <div id="faqContainer" style="max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; gap: 1rem;">
                    <div class="faq-item" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: var(--text); font-weight: 700; font-size: 1.2rem; margin: 0;">🔒 Is my trading data secure?</h4>
                            <div style="color: var(--accent); font-size: 1.5rem; transform: rotate(0deg); transition: transform 0.3s ease;">+</div>
                        </div>
                        <p style="color: var(--muted); line-height: 1.7; margin-top: 1rem; display: none;">Absolutely. All your data is stored locally on your device in your browser's storage. We never see your journal entries or performance data. It's 100% private and secure.</p>
                    </div>
                    
                    <div class="faq-item" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: var(--text); font-weight: 700; font-size: 1.2rem; margin: 0;">💳 Can I cancel my subscription anytime?</h4>
                            <div style="color: var(--accent); font-size: 1.5rem; transform: rotate(0deg); transition: transform 0.3s ease;">+</div>
                        </div>
                        <p style="color: var(--muted); line-height: 1.7; margin-top: 1rem; display: none;">Yes. You can manage your subscription from the "Account" section in your settings. You can upgrade, downgrade, or cancel at any time, no questions asked. We believe in earning your business every month.</p>
                    </div>
                    
                    <div class="faq-item" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: var(--text); font-weight: 700; font-size: 1.2rem; margin: 0;">🤖 How does the AI Mentor work?</h4>
                            <div style="color: var(--accent); font-size: 1.5rem; transform: rotate(0deg); transition: transform 0.3s ease;">+</div>
                        </div>
                        <p style="color: var(--muted); line-height: 1.7; margin-top: 1rem; display: none;">The AI Mentor runs entirely in your browser. It reads your locally-stored trade data, analyzes it for patterns, and generates personalized feedback without your data ever leaving your computer. Your privacy is our priority.</p>
                    </div>
                    
                    <div class="faq-item" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: var(--text); font-weight: 700; font-size: 1.2rem; margin: 0;">📱 Is there a mobile app?</h4>
                            <div style="color: var(--accent); font-size: 1.5rem; transform: rotate(0deg); transition: transform 0.3s ease;">+</div>
                        </div>
                        <p style="color: var(--muted); line-height: 1.7; margin-top: 1rem; display: none;">INTRADEL works great on mobile browsers! We're also working on native iOS and Android apps that will be launching in Q2 2026. Elite members will get early access.</p>
                    </div>
                    
                    <div class="faq-item" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: var(--text); font-weight: 700; font-size: 1.2rem; margin: 0;">📊 Can I import data from other platforms?</h4>
                            <div style="color: var(--accent); font-size: 1.5rem; transform: rotate(0deg); transition: transform 0.3s ease;">+</div>
                        </div>
                        <p style="color: var(--muted); line-height: 1.7; margin-top: 1rem; display: none;">Yes! Elite members can import trade data from CSV files and we support most major brokers. We're constantly adding more integrations based on user feedback.</p>
                    </div>
                    
                    <div class="faq-item" style="background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid var(--stroke-weak); border-radius: 16px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: var(--text); font-weight: 700; font-size: 1.2rem; margin: 0;">🎓 Do you offer training or tutorials?</h4>
                            <div style="color: var(--accent); font-size: 1.5rem; transform: rotate(0deg); transition: transform 0.3s ease;">+</div>
                        </div>
                        <p style="color: var(--muted); line-height: 1.7; margin-top: 1rem; display: none;">Absolutely! We have a comprehensive knowledge base with video tutorials, guides, and best practices. Elite members also get access to exclusive webinars and a one-on-one onboarding call.</p>
                    </div>
                </div>
            </div>

            <!-- Still Need Help Banner -->
            <div style="background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.1), rgba(var(--accent-rgb), 0.05)); border: 1px solid rgba(var(--accent-rgb), 0.2); border-radius: 20px; padding: 3rem; text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">🤝</div>
                <h2 style="font-size: 2rem; font-weight: 900; color: var(--accent-soft); margin-bottom: 1rem;">Still need help?</h2>
                <p style="font-size: 1.1rem; color: var(--muted); max-width: 600px; margin: 0 auto 2rem;">
                    Our support team typically responds within 24 hours. Elite members get priority support.
                </p>
                <a href="mailto:support@intradel.ai" style="display: inline-block; padding: 1rem 2.5rem; background: var(--accent); color: white; font-weight: 700; border-radius: 12px; text-decoration: none; transition: all 0.3s ease;">
                    Contact Support
                </a>
            </div>
        </div>
    </div>


    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page">
      <div class="container">
        <div id="sidebar">
          <div class="nav-item active" data-tab="dashboard">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            Dashboard
          </div>
          <div class="nav-item" data-tab="journal">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            Journal
          </div>
          <div class="nav-item" data-tab="stats">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20V16"></path></svg>
            Statistics
          </div>
          <div class="nav-item" data-tab="habits">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            Habit Tracker
          </div>
          <div class="nav-item" data-tab="leaderboard">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 15h16"/><path d="M12 12V6.5a2.5 2.5 0 0 1 5 0V12"/><path d="M8 12V6.5a2.5 2.5 0 0 0-5 0V12"/><path d="M12 12h- popolazione"/></svg>
            Leaderboard
          </div>
          <div class="nav-item" data-tab="zen">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12c-2 0-4.5 1-4.5 3.5V20h9v-4.5c0-2.5-2.5-3.5-4.5-3.5z"></path><path d="M20.2 13.8c.6-3.4-1.9-6.3-5.2-6.3-2.4 0-4.5 1.4-5.2 3.5"></path><path d="M7.7 12.8c-.6-3.4 1.9-6.3 5.2-6.3 2.4 0 4.5 1.4 5.2 3.5"></path><path d="M12 2a2.4 2.4 0 0 0-1 4.3 2.4 2.4 0 0 0 2 0A2.4 2.4 0 0 0 12 2z"></path></svg>
            ZEN
          </div>
          <div class="nav-item" data-tab="ai">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><path d="M16 4h-4"></path><rect x="4" y="12" width="16" height="8" rx="2"></rect><path d="M9 16.5v-1"></path><path d="M15 16.5v-1"></path></svg>
            AI Mentor
          </div>
          <div class="nav-item" data-tab="settings">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            Settings
          </div>
          <div class="nav-item" data-tab="admin" id="adminNavBtn" style="display:none; border-color: var(--accent-strong);">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            Admin
          </div>
        </div>

        <div id="dashboardTab" class="tab">
          <!-- EPIC DASHBOARD REDESIGN -->
          <div style="max-width:1600px;margin:0 auto;">
            
            <!-- Hero Stats Section -->
            <div style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.2), rgba(var(--accent-rgb), 0.05));border:1px solid var(--stroke-weak);border-radius:20px;padding:2.5rem;margin-bottom:2rem;position:relative;overflow:hidden;">
              <div style="position:absolute;top:-100px;right:-100px;width:300px;height:300px;background:radial-gradient(circle, rgba(var(--accent-rgb), 0.4), transparent);filter:blur(80px);"></div>
              <div style="position:relative;z-index:1;">
                <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;flex-wrap:wrap;gap:1rem;">
                  <div>
                    <h1 style="font-family:var(--font-heading);font-weight:800;font-size:2.8rem;margin:0;background:linear-gradient(135deg, var(--accent-soft), var(--accent));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">Trading Dashboard</h1>
                    <p class="muted" style="margin:0.5rem 0 0 0;font-size:1.1rem;">Your complete trading performance overview</p>
                  </div>
                  <div style="display:flex;gap:1rem;flex-wrap:wrap;">
                    <div style="background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:12px;padding:1rem 1.5rem;text-align:center;">
                      <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Weekly Total</div>
                      <div id="weeklyTotal" style="font-size:1.3rem;font-weight:700;color:var(--success);">$0</div>
                    </div>
                    <div style="background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:12px;padding:1rem 1.5rem;text-align:center;">
                      <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Monthly Total</div>
                      <div id="monthlyTotal" style="font-size:1.3rem;font-weight:700;color:var(--accent);">$0</div>
                    </div>
                  </div>
                </div>
                
                <!-- Key Metrics Grid -->
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;">
                  <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:1.5rem;transition:all 0.3s;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.1)';this.style.boxShadow='';">
                    <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                      <div style="font-size:2rem;margin-right:0.75rem;color:var(--accent);">●</div>
                      <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Total Trades</div>
                    </div>
                    <div id="totalTrades" style="font-size:2.2rem;font-weight:800;color:var(--text);font-family:var(--font-heading);">0</div>
                  </div>
                  
                  <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:1.5rem;transition:all 0.3s;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.1)';this.style.boxShadow='';">
                    <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                      <div style="font-size:2rem;margin-right:0.75rem;color:var(--accent);">●</div>
                      <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Total P&L</div>
                    </div>
                    <div id="totalPnL" style="font-size:2.2rem;font-weight:800;color:var(--success);font-family:var(--font-heading);">$0.00</div>
                  </div>
                  
                  <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:1.5rem;transition:all 0.3s;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.1)';this.style.boxShadow='';">
                    <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                      <div style="font-size:2rem;margin-right:0.75rem;color:var(--accent);">●</div>
                      <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Win Rate</div>
                    </div>
                    <div id="winRate" style="font-size:2.2rem;font-weight:800;color:var(--accent);font-family:var(--font-heading);">0.0%</div>
                  </div>
                  
                  <div style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.2), rgba(var(--accent-rgb), 0.1));border:1px solid rgba(var(--accent-rgb), 0.3);border-radius:16px;padding:1.5rem;transition:all 0.3s;" onmouseenter="this.style.transform='translateY(-5px)';this.style.boxShadow='0 8px 20px rgba(var(--accent-rgb),0.4)';" onmouseleave="this.style.transform='';this.style.boxShadow='';">
                    <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                      <div style="font-size:2rem;margin-right:0.75rem;color:var(--accent);">●</div>
                      <div style="font-size:0.85rem;color:var(--accent-soft);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Current Level</div>
                    </div>
                    <div id="dashboardLevel" style="font-size:2.2rem;font-weight:800;color:var(--accent-soft);font-family:var(--font-heading);">0</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Period Selector -->
            <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:1.5rem;margin-bottom:2rem;">
              <div style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;">
                <div style="flex:0 0 auto;">
                  <label style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;font-size:0.85rem;">Period</label>
                  <select id="periodSelect" style="min-width:200px;padding:0.875rem;border-radius:10px;font-weight:600;cursor:pointer;">
                    <option value="currentMonth">Current Month</option>
                    <option value="last14days">Last 14 Days</option>
                    <option value="lastMonth">Last Month</option>
                    <option value="allTime">All Time</option>
                    <option value="weekly">Weekly</option>
                    <option value="yearly">Yearly</option>
                    <option value="custom">Custom Range</option>
                  </select>
                </div>
                <div id="customRangeInputs" style="display:none;gap:0.75rem;align-items:center;flex:1;">
                  <input type="date" id="customStart" style="padding:0.875rem;border-radius:10px;"> 
                  <span style="color:var(--muted);font-weight:600;">to</span>
                  <input type="date" id="customEnd" style="padding:0.875rem;border-radius:10px;">
                  <button class="btn-secondary" id="applyCustomRange" style="padding:0.875rem 1.5rem;font-weight:600;">Apply</button>
                </div>
              </div>
            </div>

            <!-- Calendar Title -->
            <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:1.5rem;margin-bottom:1rem;">
              <h3 id="periodTitle" style="margin:0;font-family:var(--font-heading);font-weight:700;font-size:1.5rem;color:var(--accent-soft);">📅 Current Month</h3>
            </div>

            <!-- Calendar Container -->
            <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:1.5rem;overflow:hidden;">
              <div id="weekdayHeader" class="weekday-header" style="display:grid;grid-template-columns:repeat(7,1fr);gap:0.5rem;margin-bottom:1rem;padding:0 0.5rem;">
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Mon</div>
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Tue</div>
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Wed</div>
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Thu</div>
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Fri</div>
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Sat</div>
                <div style="text-align:center;font-weight:700;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;">Sun</div>
              </div>

              <div class="trades-grid" id="tradesGrid"></div>
            </div>
            <!-- Close calendar container -->

            <!-- Habits & Rules Tracker -->
            <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-top:1.5rem;">
              <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                <span style="font-size:2rem;margin-right:0.75rem;">✅</span>
                <h3 style="font-family:var(--font-heading);font-weight:700;margin:0;font-size:1.5rem;color:var(--accent-soft);">Habits & Rules Tracker</h3>
              </div>
              <div id="habitsContainer" style="display:flex;gap:1rem;flex-wrap:wrap;"></div>
            </div>
          </div>
          <!-- Close main dashboard wrapper -->
        </div>

        <div id="journalTab" class="tab" style="display:none">
          <!-- Epic Journal Header -->
          <div style="background:linear-gradient(135deg,rgba(255,107,107,0.15),rgba(139,69,19,0.1));border:2px solid rgba(255,107,107,0.3);border-radius:20px;padding:2.5rem;margin-bottom:2rem;position:relative;overflow:hidden;">
            <div style="position:absolute;top:-50px;right:-50px;width:200px;height:200px;background:radial-gradient(circle,rgba(255,107,107,0.2),transparent);border-radius:50%;"></div>
            <div style="position:relative;z-index:1;">
              <h1 style="font-size:2.5rem;font-weight:900;margin:0 0 0.5rem 0;background:linear-gradient(135deg,var(--accent),var(--success));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">Trading Journal</h1>
              <p style="color:var(--muted);font-size:1.1rem;margin:0 0 1.5rem 0;">Document every trade. Build your edge. Achieve consistency.</p>
              
              <!-- Quick Stats -->
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;">
                <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1rem;">
                  <div style="font-size:0.8rem;color:var(--muted);margin-bottom:0.25rem;">This Week</div>
                  <div style="font-size:1.8rem;font-weight:900;color:var(--success);" id="journalWeekPnl">+$0</div>
                </div>
                <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1rem;">
                  <div style="font-size:0.8rem;color:var(--muted);margin-bottom:0.25rem;">Win Rate</div>
                  <div style="font-size:1.8rem;font-weight:900;color:var(--text);" id="journalWinRate">0%</div>
                </div>
                <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1rem;">
                  <div style="font-size:0.8rem;color:var(--muted);margin-bottom:0.25rem;">Total Entries</div>
                  <div style="font-size:1.8rem;font-weight:900;color:var(--text);" id="journalTotalEntries">0</div>
                </div>
                <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1rem;">
                  <div style="font-size:0.8rem;color:var(--muted);margin-bottom:0.25rem;">Current Streak</div>
                  <div style="font-size:1.8rem;font-weight:900;color:var(--success);" id="journalStreak">🔥 0</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Filters & Search -->
          <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:2rem;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
              <h3 style="margin:0;font-size:1.2rem;font-weight:700;">Search & Filter</h3>
              <button class="btn-primary" onclick="document.getElementById('journalComposer').scrollIntoView({behavior:'smooth'})" style="padding:0.75rem 1.5rem;">+ New Entry</button>
            </div>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:0.75rem;">
              <input id="journalSearch" type="text" placeholder="🔍 Search symbol, notes..." style="font-size:0.95rem;">
              <select id="journalSort">
                <option value="dateDesc">📅 Newest First</option>
                <option value="dateAsc">📅 Oldest First</option>
                <option value="winFirst">✅ Wins First</option>
                <option value="lossFirst">❌ Losses First</option>
              </select>
              <select id="journalFilterOutcome">
                <option value="all">All Outcomes</option>
                <option value="win">✅ Wins Only</option>
                <option value="loss">❌ Losses Only</option>
              </select>
              <select id="journalFilterSide">
                <option value="all">All Sides</option>
                <option value="long">📈 Long</option>
                <option value="short">📉 Short</option>
              </select>
              <select id="journalRange">
                <option value="last7days">Last 7 Days</option>
                <option value="last14days" selected>Last 14 Days</option>
                <option value="currentMonth">Current Month</option>
                <option value="all">All Time</option>
              </select>
              <select id="journalCustomFieldKey" style="display:none;">
                <option value="">Custom field</option>
              </select>
              <input id="journalCustomFieldValue" placeholder="Custom value" style="display:none;">
            </div>
            <div style="margin-top:0.75rem;display:flex;align-items:center;gap:1rem;">
              <span id="journalMeta" class="muted" style="font-size:0.9rem;"></span>
            </div>
          </div>

          <!-- Journal Entries List -->
          <div style="margin-bottom:2rem;">
            <h3 style="font-weight:700;font-size:1.3rem;margin-bottom:1rem;">📖 Journal Entries</h3>
            <div class="trades-log" id="tradesLog"></div>
          </div>

          <!-- Journal Composer - New Entry Form -->
          <div id="journalComposer" style="background:linear-gradient(135deg,rgba(45,220,144,0.08),rgba(45,220,144,0.03));border:2px solid rgba(45,220,144,0.3);padding:2rem;border-radius:20px;margin-top:2rem;position:relative;overflow:hidden;">
            <div style="position:absolute;top:-30px;right:-30px;width:150px;height:150px;background:radial-gradient(circle,rgba(45,220,144,0.15),transparent);border-radius:50%;"></div>
            <div style="position:relative;z-index:1;">
              <h3 style="font-size:1.8rem;font-weight:800;margin:0 0 1.5rem 0;">✍️ Create New Journal Entry</h3>
              
              <!-- Trade Details Card -->
              <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;">
                <h4 style="font-size:1.1rem;font-weight:700;margin:0 0 1rem 0;color:var(--text);">📊 Trade Details</h4>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;">
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Symbol *</label>
                    <input id="jSymbol" type="text" placeholder="e.g., AAPL, SPY" style="font-size:1rem;font-weight:600;">
                  </div>
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Side *</label>
                    <select id="jSide" style="font-size:1rem;">
                      <option value="long">📈 Long</option>
                      <option value="short">📉 Short</option>
                    </select>
                  </div>
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">P&L ($) *</label>
                    <input id="jPnl" type="number" step="0.01" placeholder="e.g., 150.50" style="font-size:1rem;font-weight:700;">
                  </div>
                  <div class="date-input-wrapper">
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Date *</label>
                    <input id="tradeDate" type="date" style="font-size:1rem;">
                  </div>
                </div>
                
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:1rem;">
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Entry Price</label>
                    <input id="jEntry" type="number" step="0.01" placeholder="Entry price" style="font-size:1rem;">
                  </div>
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Stop Loss</label>
                    <input id="jStop" type="number" step="0.01" placeholder="Stop price" style="font-size:1rem;">
                  </div>
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Take Profit</label>
                    <input id="jTakeProfit" type="number" step="0.01" placeholder="Target price" style="font-size:1rem;">
                  </div>
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Position Size</label>
                    <input id="jSize" type="number" step="0.01" placeholder="Shares/contracts" style="font-size:1rem;">
                  </div>
                </div>
              </div>

              <!-- Emotions & Mindset -->
              <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;">
                <h4 style="font-size:1.1rem;font-weight:700;margin:0 0 1rem 0;color:var(--text);">💭 Emotions & Mindset</h4>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:1rem;">
                  <button class="emotion-btn" data-emotion="confident" style="padding:0.5rem 1rem;background:rgba(45,220,144,0.2);border:2px solid rgba(45,220,144,0.4);border-radius:8px;cursor:pointer;transition:all 0.3s;">😎 Confident</button>
                  <button class="emotion-btn" data-emotion="focused" style="padding:0.5rem 1rem;background:rgba(139,69,19,0.2);border:2px solid rgba(139,69,19,0.4);border-radius:8px;cursor:pointer;transition:all 0.3s;">🎯 Focused</button>
                  <button class="emotion-btn" data-emotion="calm" style="padding:0.5rem 1rem;background:rgba(45,220,144,0.2);border:2px solid rgba(45,220,144,0.4);border-radius:8px;cursor:pointer;transition:all 0.3s;">😌 Calm</button>
                  <button class="emotion-btn" data-emotion="anxious" style="padding:0.5rem 1rem;background:rgba(255,107,107,0.2);border:2px solid rgba(255,107,107,0.4);border-radius:8px;cursor:pointer;transition:all 0.3s;">😰 Anxious</button>
                  <button class="emotion-btn" data-emotion="fomo" style="padding:0.5rem 1rem;background:rgba(255,107,107,0.2);border:2px solid rgba(255,107,107,0.4);border-radius:8px;cursor:pointer;transition:all 0.3s;">😤 FOMO</button>
                  <button class="emotion-btn" data-emotion="revenge" style="padding:0.5rem 1rem;background:rgba(255,107,107,0.2);border:2px solid rgba(255,107,107,0.4);border-radius:8px;cursor:pointer;transition:all 0.3s;">😡 Revenge</button>
                </div>
                <input type="hidden" id="jEmotions" value="">
              </div>

              <!-- Journal Notes -->
              <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;">
                <h4 style="font-size:1.1rem;font-weight:700;margin:0 0 1rem 0;color:var(--text);">📝 Trade Analysis</h4>
                <div style="margin-bottom:1rem;">
                  <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Setup & Execution</label>
                  <textarea id="tradeNotes" placeholder="What was your trade setup? Why did you enter? How was the execution?" style="min-height:100px;font-size:1rem;"></textarea>
                </div>
                
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Pre-Market Analysis</label>
                    <textarea id="preMarket" placeholder="Key levels, catalysts, market conditions..." style="min-height:80px;font-size:0.95rem;"></textarea>
                  </div>
                  <div>
                    <label style="display:block;color:var(--muted);font-size:0.85rem;font-weight:600;margin-bottom:0.5rem;">Post-Trade Review</label>
                    <textarea id="postMarket" placeholder="What went well? What to improve?" style="min-height:80px;font-size:0.95rem;"></textarea>
                  </div>
                </div>
              </div>

              <!-- Screenshot Upload -->
              <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;">
                <h4 style="font-size:1.1rem;font-weight:700;margin:0 0 1rem 0;color:var(--text);">📸 Chart Screenshot</h4>
                <div style="border:2px dashed rgba(255,255,255,0.2);border-radius:12px;padding:2rem;text-align:center;background:rgba(255,255,255,0.02);cursor:pointer;transition:all 0.3s;" id="screenshotDropZone">
                  <div style="font-size:2rem;margin-bottom:0.5rem;">📷</div>
                  <div style="color:var(--muted);margin-bottom:0.5rem;">Click to upload or drag & drop</div>
                  <input id="jScreenshot" type="file" accept="image/*" style="display:none;">
                  <button class="btn-secondary" onclick="document.getElementById('jScreenshot').click()" style="margin-top:0.5rem;">Choose File</button>
                </div>
              </div>

              <!-- Rules Followed -->
              <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;">
                <h4 style="font-size:1.1rem;font-weight:700;margin:0 0 1rem 0;color:var(--text);">✅ Rules Followed</h4>
                <div id="rulesChecklist" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:0.75rem;"></div>
              </div>

              <!-- Custom Fields -->
              <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;display:none;" id="customFieldsSection">
                <h4 style="font-size:1.1rem;font-weight:700;margin:0 0 1rem 0;color:var(--text);">🏷️ Custom Tags</h4>
                <div id="customFieldsContainer" style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:1rem;"></div>
                <div style="display:flex;gap:0.5rem;">
                  <input id="newCustomKey" placeholder="Key (e.g., strategy)" style="flex:1;">
                  <input id="newCustomValue" placeholder="Value" style="flex:1;">
                  <button class="btn-secondary" id="addCustomFieldBtn">Add Tag</button>
                </div>
              </div>

              <!-- Action Buttons -->
              <div style="display:flex;gap:1rem;align-items:center;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.1);">
                <button class="btn-primary" id="logTradeBtn" style="padding:1rem 2rem;font-size:1.1rem;font-weight:700;">💾 Save Journal Entry</button>
                <button class="btn-secondary" id="clearJournalBtn" style="padding:1rem 1.5rem;">Clear Form</button>
                <div style="margin-left:auto;color:var(--muted);font-size:0.85rem;">* Required fields</div>
              </div>
            </div>
          </div>
        </div>

        <div id="statsTab" class="tab" style="display:none">
            <!-- EPIC STATISTICS PAGE REDESIGN -->
            <div style="max-width:1400px;margin:0 auto;">
                
                <!-- Hero Stats Header -->
                <div style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.15), rgba(var(--accent-rgb), 0.05));border:1px solid var(--stroke-weak);border-radius:20px;padding:2.5rem;margin-bottom:2rem;position:relative;overflow:hidden;">
                    <div style="position:absolute;top:-50px;right:-50px;width:200px;height:200px;background:radial-gradient(circle, rgba(var(--accent-rgb), 0.3), transparent);filter:blur(50px);"></div>
                    <div style="position:relative;z-index:1;">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;">
                            <div>
                                <h1 style="font-family:var(--font-heading);font-weight:800;font-size:2.5rem;margin:0;background:linear-gradient(135deg, var(--accent-soft), var(--accent));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">Performance Analytics</h1>
                                <p class="muted" style="margin:0.5rem 0 0 0;font-size:1.1rem;">Track your trading performance and identify areas for improvement</p>
                            </div>
                            <div style="background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:12px;padding:1rem 1.5rem;text-align:center;">
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Current Period</div>
                                <div style="font-size:1.1rem;font-weight:700;color:var(--text);">This Month</div>
                            </div>
                        </div>
                        
                        <!-- Key Metrics Grid -->
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;">
                            <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:1.5rem;transition:all 0.3s;position:relative;overflow:hidden;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.08)';this.style.boxShadow='';">
                                <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                                    <div style="font-size:2rem;margin-right:0.75rem;color:var(--accent);">●</div>
                                    <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Total P&L</div>
                                </div>
                                <div id="statTotalPnL" style="font-size:2rem;font-weight:800;color:var(--success);font-family:var(--font-heading);margin-bottom:0.5rem;">$0.00</div>
                                <div class="muted" style="font-size:0.85rem;">All-time performance</div>
                            </div>
                            
                            <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:1.5rem;transition:all 0.3s;position:relative;overflow:hidden;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.08)';this.style.boxShadow='';">
                                <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                                    <div style="font-size:2rem;margin-right:0.75rem;color:var(--accent);">●</div>
                                    <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Win Rate</div>
                                </div>
                                <div id="statWinRate" style="font-size:2rem;font-weight:800;color:var(--accent);font-family:var(--font-heading);margin-bottom:0.5rem;">0%</div>
                                <div class="muted" style="font-size:0.85rem;">Success ratio</div>
                            </div>
                            
                            <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:1.5rem;transition:all 0.3s;position:relative;overflow:hidden;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.08)';this.style.boxShadow='';">
                                <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                                    <div style="font-size:2rem;margin-right:0.75rem;">📊</div>
                                    <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Profit Factor</div>
                                </div>
                                <div id="statProfitFactor" style="font-size:2rem;font-weight:800;color:var(--text);font-family:var(--font-heading);margin-bottom:0.5rem;">0.00</div>
                                <div class="muted" style="font-size:0.85rem;">Gross profit / Gross loss</div>
                            </div>
                            
                            <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:1.5rem;transition:all 0.3s;position:relative;overflow:hidden;" onmouseenter="this.style.transform='translateY(-5px)';this.style.borderColor='var(--accent)';this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)';" onmouseleave="this.style.transform='';this.style.borderColor='rgba(255,255,255,0.08)';this.style.boxShadow='';">
                                <div style="display:flex;align-items:center;margin-bottom:0.75rem;">
                                    <div style="font-size:2rem;margin-right:0.75rem;">⚖️</div>
                                    <div style="font-size:0.85rem;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Avg R:R</div>
                                </div>
                                <div id="statAvgRR" style="font-size:2rem;font-weight:800;color:var(--text);font-family:var(--font-heading);margin-bottom:0.5rem;">0.00</div>
                                <div class="muted" style="font-size:0.85rem;">Risk-reward ratio</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Stats Section -->
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-bottom:2rem;">
                    <!-- Winning Trades -->
                    <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:1.75rem;">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;">
                            <h3 style="font-family:var(--font-heading);font-weight:700;margin:0;font-size:1.3rem;color:var(--success);">💚 Winning Trades</h3>
                            <div style="background:rgba(var(--success-rgb),0.2);border-radius:8px;padding:0.5rem 0.75rem;">
                                <span style="font-weight:700;color:var(--success);font-size:0.9rem;">LONG</span>
                            </div>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:1rem;">
                            <div>
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Average Win</div>
                                <div id="statAvgWin" style="font-size:1.6rem;font-weight:800;color:var(--success);">$0.00</div>
                            </div>
                            <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:1rem;">
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Best Trade</div>
                                <div id="statBestTrade" style="font-size:1.4rem;font-weight:700;color:var(--success);">$0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Losing Trades -->
                    <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:1.75rem;">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;">
                            <h3 style="font-family:var(--font-heading);font-weight:700;margin:0;font-size:1.3rem;color:var(--danger);">❌ Losing Trades</h3>
                            <div style="background:rgba(var(--danger-rgb),0.2);border-radius:8px;padding:0.5rem 0.75rem;">
                                <span style="font-weight:700;color:var(--danger);font-size:0.9rem;">SHORT</span>
                            </div>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:1rem;">
                            <div>
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Average Loss</div>
                                <div id="statAvgLoss" style="font-size:1.6rem;font-weight:800;color:var(--danger);">$0.00</div>
                            </div>
                            <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:1rem;">
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Worst Trade</div>
                                <div id="statWorstTrade" style="font-size:1.4rem;font-weight:700;color:var(--danger);">$0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trading Insights -->
                    <div style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.15), rgba(var(--accent-rgb), 0.05));border:1px solid var(--stroke-weak);border-radius:18px;padding:1.75rem;">
                        <div style="display:flex;align-items:center;margin-bottom:1rem;">
                            <div style="font-size:2rem;margin-right:0.75rem;">💡</div>
                            <h3 style="font-family:var(--font-heading);font-weight:700;margin:0;font-size:1.3rem;">Insights</h3>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:0.75rem;">
                            <div style="background:rgba(255,255,255,0.05);border-radius:8px;padding:0.75rem;">
                                <div style="font-size:0.9rem;color:var(--text);">📈 <strong>Consistency:</strong> <span id="statConsistency" class="muted">Calculating...</span></div>
                            </div>
                            <div style="background:rgba(255,255,255,0.05);border-radius:8px;padding:0.75rem;">
                                <div style="font-size:0.9rem;color:var(--text);">⏰ <strong>Best Time:</strong> <span id="statBestTime" class="muted">Morning</span></div>
                            </div>
                            <div style="background:rgba(255,255,255,0.05);border-radius:8px;padding:0.75rem;">
                                <div style="font-size:0.9rem;color:var(--text);">📅 <strong>Avg. Daily:</strong> <span id="statAvgDaily" class="muted">$0.00</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:2rem;">
                    <h3 style="font-family:var(--font-heading);font-weight:700;font-size:1.5rem;margin:0 0 1.5rem 0;">📊 Visual Performance</h3>
                    <div id="statsCharts" class="charts-grid">
                        <div class="chart-card">
                            <div class="muted" style="margin-bottom:.75rem;font-weight:600;">Equity Curve & Daily P&L</div>
                            <canvas id="equityCanvas" height="260"></canvas>
                        </div>
                        <div class="chart-card">
                            <div class="muted" style="margin-bottom:.75rem;font-weight:600;">Trades per Day</div>
                            <canvas id="tradesBarCanvas" height="260"></canvas>
                        </div>
                        <div class="chart-card">
                            <div class="muted" style="margin-bottom:.75rem;font-weight:600;">Win vs Loss Days</div>
                            <div class="small-donut">
                                <canvas id="winLossDonutCanvas" height="180"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Breakdown -->
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;">
                    <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:12px;padding:1.25rem;">
                        <div class="muted" style="font-size:0.85rem;margin-bottom:0.5rem;">Total Trades</div>
                        <div id="statTotalTrades" style="font-size:1.8rem;font-weight:700;color:var(--text);">0</div>
                    </div>
                    <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:12px;padding:1.25rem;">
                        <div class="muted" style="font-size:0.85rem;margin-bottom:0.5rem;">Winning Days</div>
                        <div id="statWinningDays" style="font-size:1.8rem;font-weight:700;color:var(--success);">0</div>
                    </div>
                    <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:12px;padding:1.25rem;">
                        <div class="muted" style="font-size:0.85rem;margin-bottom:0.5rem;">Losing Days</div>
                        <div id="statLosingDays" style="font-size:1.8rem;font-weight:700;color:var(--danger);">0</div>
                    </div>
                    <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:12px;padding:1.25rem;">
                        <div class="muted" style="font-size:0.85rem;margin-bottom:0.5rem;">Longest Streak</div>
                        <div id="statLongestStreak" style="font-size:1.8rem;font-weight:700;color:var(--accent);">0 days</div>
                    </div>
                </div>
                
            </div>
        </div>

        <div id="habitsTab" class="tab" style="display:none">
            <!-- Grit-Inspired Habit Tracker -->
            <div style="max-width:1200px;margin:0 auto;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;">
                    <div>
                        <h2 style="font-family: var(--font-heading); font-weight: 800;margin:0;font-size:2rem;">Habits</h2>
                        <p class="muted" style="margin:0.5rem 0 0 0;">Build consistency. Track progress. Become legendary.</p>
                    </div>
                    <div style="display:flex;gap:1rem;align-items:center;">
                        <div style="display:flex;gap:0.5rem;background:rgba(255,255,255,0.05);border-radius:12px;padding:0.25rem;">
                            <button class="habit-period-btn active" data-period="week" style="padding:0.5rem 1rem;border:none;background:var(--accent);color:var(--bg-primary);border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s;">Week</button>
                            <button class="habit-period-btn" data-period="month" style="padding:0.5rem 1rem;border:none;background:transparent;color:var(--muted);border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s;">Month</button>
                            <button class="habit-period-btn" data-period="all" style="padding:0.5rem 1rem;border:none;background:transparent;color:var(--muted);border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s;">All Time</button>
                        </div>
                        <button class="btn-primary" id="addNewHabitBtn" style="padding:0.75rem 1.5rem;">+ New Habit</button>
                    </div>
                </div>

                <!-- Stats Overview -->
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem;">
                    <div style="background:linear-gradient(135deg,rgba(45,220,144,0.1),rgba(45,220,144,0.05));border:1px solid rgba(45,220,144,0.2);border-radius:16px;padding:1.5rem;">
                        <div style="font-size:0.85rem;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Current Streak</div>
                        <div style="font-size:2.5rem;font-weight:900;color:var(--success);display:flex;align-items:baseline;gap:0.5rem;">
                            <span id="currentStreakNum">0</span>
                            <span style="font-size:1.2rem;color:var(--muted);">days</span>
                        </div>
                    </div>
                    <div style="background:linear-gradient(135deg,rgba(255,107,107,0.1),rgba(255,107,107,0.05));border:1px solid rgba(255,107,107,0.2);border-radius:16px;padding:1.5rem;">
                        <div style="font-size:0.85rem;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Longest Streak</div>
                        <div style="font-size:2.5rem;font-weight:900;color:var(--accent);display:flex;align-items:baseline;gap:0.5rem;">
                            <span id="longestStreakNum">0</span>
                            <span style="font-size:1.2rem;color:var(--muted);">days</span>
                        </div>
                    </div>
                    <div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(168,85,247,0.05));border:1px solid rgba(168,85,247,0.2);border-radius:16px;padding:1.5rem;">
                        <div style="font-size:0.85rem;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Total Completions</div>
                        <div style="font-size:2.5rem;font-weight:900;color:#a855f7;display:flex;align-items:baseline;gap:0.5rem;">
                            <span id="totalCompletionsNum">0</span>
                            <span style="font-size:1.2rem;color:var(--muted);">checks</span>
                        </div>
                    </div>
                </div>

                <!-- Habits List -->
                <div id="habitsListContainer">
                    <!-- Habits will be dynamically generated here -->
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="habitsEmptyState" style="display:none;text-align:center;padding:4rem 2rem;">
                <div style="font-size:4rem;margin-bottom:1rem;">📊</div>
                <h3 style="font-size:1.5rem;font-weight:700;margin-bottom:0.5rem;">No Habits Yet</h3>
                <p style="color:var(--muted);margin-bottom:2rem;">Start building consistency by creating your first habit!</p>
                <button class="btn-primary" onclick="document.getElementById('addNewHabitBtn').click()">+ Create Your First Habit</button>
            </div>
        </div>

        <div id="leaderboardTab" class="tab" style="display:none">
            <!-- Modern Leaderboard Design -->
            <div style="max-width:1200px;margin:0 auto;">
                <div style="text-align:center;margin-bottom:3rem;">
                    <h2 style="font-family: var(--font-heading); font-weight: 900;margin:0;font-size:3rem;background:linear-gradient(135deg,var(--accent),var(--success));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">Global Leaderboard</h2>
                    <p class="muted" style="margin:0.75rem 0 0 0;font-size:1.1rem;">Compete with traders worldwide. Climb the ranks. Earn legendary status.</p>
                </div>

                <!-- Top 3 Podium -->
                <div style="margin-bottom:3rem;">
                    <div style="display:flex;align-items:flex-end;justify-content:center;gap:1rem;margin-bottom:2rem;">
                        <!-- 2nd Place -->
                        <div style="flex:1;max-width:250px;text-align:center;transform:translateY(20px);">
                            <div style="background:linear-gradient(135deg,rgba(192,192,192,0.15),rgba(192,192,192,0.05));border:2px solid rgba(192,192,192,0.3);border-radius:20px;padding:2rem 1.5rem;position:relative;">
                                <div style="position:absolute;top:-20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#c0c0c0,#e8e8e8);width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:900;color:#000;border:3px solid var(--bg-primary);">2</div>
                                <div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);margin:1.5rem auto 1rem;display:flex;align-items:center;justify-content:center;font-size:2rem;border:3px solid rgba(192,192,192,0.3);">👤</div>
                                <h3 style="margin:0 0 0.5rem 0;font-size:1.2rem;font-weight:700;" id="leaderRank2Name">TradeMaster</h3>
                                <div style="color:var(--muted);font-size:0.9rem;margin-bottom:0.5rem;">Level <span id="leaderRank2Level">24</span></div>
                                <div style="font-size:1.8rem;font-weight:900;color:#c0c0c0;"><span id="leaderRank2XP">12,450</span> XP</div>
                            </div>
                        </div>

                        <!-- 1st Place -->
                        <div style="flex:1;max-width:280px;text-align:center;">
                            <div style="background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,215,0,0.05));border:2px solid rgba(255,215,0,0.4);border-radius:20px;padding:2.5rem 1.5rem;position:relative;box-shadow:0 0 40px rgba(255,215,0,0.2);">
                                <div style="position:absolute;top:-25px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ffd700,#ffed4e);width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:900;color:#000;border:3px solid var(--bg-primary);box-shadow:0 0 20px rgba(255,215,0,0.5);">👑</div>
                                <div style="width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,#f093fb,#f5576c);margin:2rem auto 1rem;display:flex;align-items:center;justify-content:center;font-size:2.5rem;border:4px solid rgba(255,215,0,0.4);box-shadow:0 0 30px rgba(255,215,0,0.3);">👤</div>
                                <h3 style="margin:0 0 0.5rem 0;font-size:1.4rem;font-weight:800;" id="leaderRank1Name">EliteTrader</h3>
                                <div style="color:var(--muted);font-size:1rem;margin-bottom:0.5rem;">Level <span id="leaderRank1Level">42</span></div>
                                <div style="font-size:2.2rem;font-weight:900;color:#ffd700;"><span id="leaderRank1XP">28,750</span> XP</div>
                            </div>
                        </div>

                        <!-- 3rd Place -->
                        <div style="flex:1;max-width:250px;text-align:center;transform:translateY(40px);">
                            <div style="background:linear-gradient(135deg,rgba(205,127,50,0.15),rgba(205,127,50,0.05));border:2px solid rgba(205,127,50,0.3);border-radius:20px;padding:2rem 1.5rem;position:relative;">
                                <div style="position:absolute;top:-20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#cd7f32,#e3a857);width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:900;color:#000;border:3px solid var(--bg-primary);">3</div>
                                <div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#4facfe,#00f2fe);margin:1.5rem auto 1rem;display:flex;align-items:center;justify-content:center;font-size:2rem;border:3px solid rgba(205,127,50,0.3);">👤</div>
                                <h3 style="margin:0 0 0.5rem 0;font-size:1.2rem;font-weight:700;" id="leaderRank3Name">ProTrader</h3>
                                <div style="color:var(--muted);font-size:0.9rem;margin-bottom:0.5rem;">Level <span id="leaderRank3Level">18</span></div>
                                <div style="font-size:1.8rem;font-weight:900;color:#cd7f32;"><span id="leaderRank3XP">8,920</span> XP</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Your Rank Card -->
                <div style="background:linear-gradient(135deg,rgba(255,107,107,0.1),rgba(255,107,107,0.05));border:2px solid rgba(255,107,107,0.3);border-radius:20px;padding:2rem;margin-bottom:2rem;display:flex;align-items:center;justify-content:space-between;">
                    <div style="display:flex;align-items:center;gap:1.5rem;">
                        <div style="width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-strong));display:flex;align-items:center;justify-content:center;font-size:2rem;">👤</div>
                        <div>
                            <h3 style="margin:0 0 0.5rem 0;font-size:1.5rem;font-weight:800;">Your Rank: <span style="color:var(--accent);" id="myRank">#--</span></h3>
                            <div style="color:var(--muted);font-size:1rem;">Level <span id="myLevelNum">0</span> • <span id="myXPNum">0</span> XP</div>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:0.9rem;color:var(--muted);margin-bottom:0.5rem;">Next Level</div>
                        <div style="width:200px;height:12px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;position:relative;">
                            <div id="myXPProgressBar" style="height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:6px;width:0%;transition:width 0.5s;"></div>
                        </div>
                        <div style="font-size:0.85rem;color:var(--muted);margin-top:0.5rem;"><span id="myXPRemaining">100</span> XP to Level <span id="myNextLevel">1</span></div>
                    </div>
                </div>

                <!-- Full Leaderboard -->
                <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:20px;padding:2rem;">
                    <h3 style="margin:0 0 1.5rem 0;font-size:1.5rem;font-weight:800;">All Traders</h3>
                    <div id="leaderboardList">
                        <!-- Leaderboard items will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="zenTab" class="tab" style="display:none">
            <div class="zen-hero">
                <h1>The Trader's Sanctuary</h1>
                <p>A clear mind is your greatest asset. Use these tools to detach from market noise, reduce emotional trading, and find your focus.</p>
            </div>

            <div class="zen-grid">
                <div class="zen-feature-card">
                    <h3>Guided Meditation</h3>
                    <p class="muted" style="margin-bottom:1rem">Quick sessions to reset your emotional state before or after trading.</p>
                    <div class="meditation-options">
                        <div class="meditation-option-card" id="startMeditation5">
                            <h4>5 min</h4>
                            <p>Quick Reset</p>
                        </div>
                        <div class="meditation-option-card" id="startMeditation10">
                            <h4>10 min</h4>
                            <p>Deeper Focus</p>
                        </div>
                    </div>
                </div>

                <div class="zen-feature-card">
                    <h3>Breathing Exercise</h3>
                    <p class="muted" style="margin-bottom:1rem">Use this visual pacer to regulate your nervous system through box breathing.</p>
                    <div class="breathing-visualizer" id="breathingVisualizer">
                        <div id="breathPacer"><span id="breathInstruction">Start</span></div>
                        <button class="btn-secondary" id="toggleBreathworkBtn">Start Breathing</button>
                    </div>
                </div>
            </div>

            <div class="zen-grid" style="margin-top:1.5rem">
                 <div class="zen-feature-card">
                    <h3>Focus Soundscapes</h3>
                    <p class="muted" style="margin-bottom:1rem">Tune out distractions with calming ambient sounds.</p>
                    <div class="soundscape-controls">
                        <button class="sound-btn" data-sound="rain">🌧️</button>
                        <button class="sound-btn" data-sound="forest">🌳</button>
                        <button class="sound-btn" data-sound="waves">🌊</button>
                        <button class="sound-btn" data-sound="none">🚫</button>
                    </div>
                    <p id="nowPlayingSound">Now Playing: None</p>
                </div>
                <div class="zen-feature-card">
                    <h3>Mindfulness Journal</h3>
                    <p class="muted" style="margin-bottom:1rem">A private space to log your mental state. How do you feel right now?</p>
                    <textarea id="mindfulnessJournal" placeholder="e.g., Feeling anxious about the open..."></textarea>
                    <button class="btn-secondary" id="saveMindfulnessBtn">Save Note</button>
                    <button class="btn-secondary" id="clearMindfulnessBtn">Clear</button>
                </div>
            </div>
        </div>


        <div id="aiTab" class="tab" style="display:none">
            <!-- EPIC AI MENTOR REDESIGN -->
            <div style="max-width:1200px;margin:0 auto;">
                
                <!-- Hero Header -->
                <div style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.2), rgba(var(--accent-rgb), 0.05));border:1px solid var(--stroke-weak);border-radius:20px;padding:2.5rem;margin-bottom:2rem;position:relative;overflow:hidden;">
                    <div style="position:absolute;top:-100px;right:-100px;width:300px;height:300px;background:radial-gradient(circle, rgba(var(--accent-rgb), 0.4), transparent);filter:blur(80px);"></div>
                    <div style="position:relative;z-index:1;">
                        <div style="display:flex;align-items:center;margin-bottom:1rem;">
                            <div style="font-size:4rem;margin-right:1rem;">🤖</div>
                            <div>
                                <h1 style="font-family:var(--font-heading);font-weight:800;font-size:2.5rem;margin:0;background:linear-gradient(135deg, var(--accent-soft), var(--accent));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">IntradelAI Mentor</h1>
                                <p class="muted" style="margin:0.5rem 0 0 0;font-size:1.1rem;">Your personal AI trading coach, powered by advanced analytics</p>
                            </div>
                        </div>
                        
                        <!-- Quick Stats -->
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-top:1.5rem;">
                            <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:1rem;">
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Trades Analyzed</div>
                                <div id="aiTradesAnalyzed" style="font-size:1.5rem;font-weight:700;color:var(--accent);">0</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:1rem;">
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Insights Given</div>
                                <div style="font-size:1.5rem;font-weight:700;color:var(--success);">247</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:1rem;">
                                <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Accuracy</div>
                                <div style="font-size:1.5rem;font-weight:700;color:var(--text);">98.2%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Suggested Prompts Section -->
                <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:1.5rem;">
                    <h3 style="font-family:var(--font-heading);font-weight:700;font-size:1.3rem;margin:0 0 1rem 0;display:flex;align-items:center;">
                        <span style="font-size:1.5rem;margin-right:0.5rem;">💡</span>
                        Suggested Questions
                    </h3>
                    <div class="ai-suggested-prompts" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem;">
                        <button class="btn-secondary ai-prompt-btn" style="text-align:left;padding:1rem;font-size:0.95rem;display:flex;align-items:center;">
                            <span style="font-size:1.5rem;margin-right:0.75rem;">📉</span>
                            <span>Analyze my biggest weakness</span>
                        </button>
                        <button class="btn-secondary ai-prompt-btn" style="text-align:left;padding:1rem;font-size:0.95rem;display:flex;align-items:center;">
                            <span style="font-size:1.5rem;margin-right:0.75rem;">🎯</span>
                            <span>What patterns exist in my wins?</span>
                        </button>
                        <button class="btn-secondary ai-prompt-btn" style="text-align:left;padding:1rem;font-size:0.95rem;display:flex;align-items:center;">
                            <span style="font-size:1.5rem;margin-right:0.75rem;">🛡️</span>
                            <span>How can I improve risk management?</span>
                        </button>
                        <button class="btn-secondary ai-prompt-btn" style="text-align:left;padding:1rem;font-size:0.95rem;display:flex;align-items:center;">
                            <span style="font-size:1.5rem;margin-right:0.75rem;">⏰</span>
                            <span>What's my best trading time?</span>
                        </button>
                        <button class="btn-secondary ai-prompt-btn" style="text-align:left;padding:1rem;font-size:0.95rem;display:flex;align-items:center;">
                            <span style="font-size:1.5rem;margin-right:0.75rem;">🧠</span>
                            <span>Analyze my emotional patterns</span>
                        </button>
                        <button class="btn-secondary ai-prompt-btn" style="text-align:left;padding:1rem;font-size:0.95rem;display:flex;align-items:center;">
                            <span style="font-size:1.5rem;margin-right:0.75rem;">📊</span>
                            <span>Compare this month vs last month</span>
                        </button>
                    </div>
                </div>
                
                <!-- Chat Window -->
                <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:0;margin-bottom:1.5rem;overflow:hidden;">
                    <div style="background:linear-gradient(90deg, rgba(var(--accent-rgb), 0.1), transparent);padding:1.25rem;border-bottom:1px solid var(--stroke-weak);">
                        <div style="display:flex;align-items:center;justify-content:space-between;">
                            <div style="display:flex;align-items:center;">
                                <div style="width:10px;height:10px;border-radius:50%;background:var(--success);margin-right:0.5rem;animation:pulse 2s infinite;"></div>
                                <span style="font-weight:700;color:var(--text);">AI Mentor Active</span>
                            </div>
                            <div class="muted" style="font-size:0.85rem;">Powered by IntradelAI v3.0</div>
                        </div>
                    </div>
                    <div id="aiChatWindow" style="min-height:400px;max-height:600px;overflow-y:auto;padding:1.5rem;display:flex;flex-direction:column;gap:1rem;">
                        <div class="ai-chat-bubble ai" style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.15), rgba(var(--accent-rgb), 0.05));border:1px solid rgba(var(--accent-rgb), 0.3);border-radius:16px;padding:1.25rem;max-width:80%;align-self:flex-start;animation:slideIn 0.3s ease;">
                            <div style="display:flex;align-items:flex-start;gap:1rem;">
                                <div style="font-size:2rem;flex-shrink:0;">🤖</div>
                                <div>
                                    <div style="font-weight:700;color:var(--accent);margin-bottom:0.5rem;">IntradelAI</div>
                                    <div style="color:var(--text);line-height:1.6;">Hello! I'm IntradelAI, your personal trading mentor. I've analyzed your trading history and I'm ready to help you improve. Ask me anything about your performance, or try one of the suggested questions above!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Input Form -->
                <div class="ai-input-form" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:1.5rem;">
                    <div style="display:flex;gap:1rem;align-items:center;">
                        <div style="flex:1;position:relative;">
                            <input id="aiQuestion" type="text" placeholder="Ask IntradelAI anything about your trading..." style="width:100%;padding:1rem 1rem 1rem 3rem;font-size:1rem;border-radius:12px;">
                            <div style="position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.25rem;">💬</div>
                        </div>
                        <button class="btn-primary" id="askAIBtn" style="padding:1rem 2rem;font-weight:700;display:flex;align-items:center;gap:0.5rem;">
                            <span>Send</span>
                            <span style="font-size:1.25rem;">🚀</span>
                        </button>
                    </div>
                    <div class="muted" style="font-size:0.85rem;margin-top:0.75rem;display:flex;align-items:center;">
                        <span style="margin-right:0.5rem;">💡</span>
                        Tip: Be specific with your questions for more detailed insights
                    </div>
                </div>
                
            </div>
        </div>

        <div id="settingsTab" class="tab" style="display:none">
            <!-- EPIC SETTINGS PAGE REDESIGN -->
            <div style="max-width:1400px;margin:0 auto;">
                
                <!-- Hero Header -->
                <div style="background:linear-gradient(135deg, rgba(var(--accent-rgb), 0.15), rgba(var(--accent-rgb), 0.05));border:1px solid var(--stroke-weak);border-radius:20px;padding:2rem;margin-bottom:2rem;display:flex;align-items:center;justify-content:space-between;">
                    <div>
                        <h1 style="font-family:var(--font-heading);font-weight:800;font-size:2.5rem;margin:0;background:linear-gradient(135deg, var(--accent-soft), var(--accent));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;">⚙️ Settings</h1>
                        <p class="muted" style="margin:0.5rem 0 0 0;font-size:1.05rem;">Customize your INTRADEL experience</p>
                    </div>
                    <div style="background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:12px;padding:1rem 1.5rem;text-align:center;">
                        <div class="muted" style="font-size:0.85rem;margin-bottom:0.25rem;">Last Saved</div>
                        <div style="font-size:1rem;font-weight:700;color:var(--success);">Just now</div>
                    </div>
                </div>
                
                <div class="settings-container" style="display:flex;gap:2rem;">
                    <!-- Sidebar Navigation -->
                    <div class="settings-nav" style="display:flex;flex-direction:column;gap:0.75rem;width:250px;flex-shrink:0;">
                        <div style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:16px;padding:1rem;position:sticky;top:1rem;">
                            <div style="font-weight:600;color:var(--muted);font-size:0.85rem;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:1rem;">Navigation</div>
                            <div class="settings-nav-item active" data-pane="profile" style="padding:1rem;border-radius:10px;font-weight:600;cursor:pointer;border:1px solid transparent;transition:all 0.3s;display:flex;align-items:center;gap:0.75rem;background:rgba(var(--accent-rgb), 0.1);border-color:rgba(var(--accent-rgb), 0.2);color:var(--accent-soft);">
                                <span style="font-size:1.25rem;">👤</span>
                                <span>Profile</span>
                            </div>
                            <div class="settings-nav-item" data-pane="account" style="padding:1rem;border-radius:10px;font-weight:600;cursor:pointer;border:1px solid transparent;transition:all 0.3s;display:flex;align-items:center;gap:0.75rem;color:var(--muted);">
                                <span style="font-size:1.25rem;">🔐</span>
                                <span>Account</span>
                            </div>
                            <div class="settings-nav-item" data-pane="appearance" style="padding:1rem;border-radius:10px;font-weight:600;cursor:pointer;border:1px solid transparent;transition:all 0.3s;display:flex;align-items:center;gap:0.75rem;color:var(--muted);">
                                <span style="font-size:1.25rem;">🎨</span>
                                <span>Appearance</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content Area -->
                    <div class="settings-content" style="flex:1;">
                    <!-- Profile Pane -->
                    <div id="profilePane" class="settings-pane active">
                        <div class="settings-card" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:1.5rem;">
                            <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                                <span style="font-size:2rem;margin-right:0.75rem;">👤</span>
                                <h3 style="font-family:var(--font-heading);font-weight:700;color:var(--accent-soft);margin:0;font-size:1.5rem;">Public Profile</h3>
                            </div>
                            <div class="settings-field" style="margin-bottom:1.5rem;">
                                <label for="newUsername" style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Username</label>
                                <div class="field-group" style="display:flex;gap:0.75rem;align-items:center;">
                                    <input id="newUsername" type="text" placeholder="Enter new username" style="flex:1;padding:0.875rem;border-radius:10px;font-size:1rem;">
                                    <button id="saveUsernameBtn" class="btn-secondary" style="padding:0.875rem 1.5rem;font-weight:600;">Save</button>
                                </div>
                                <small id="usernameCooldown" class="muted" style="display:block;margin-top:0.5rem;"></small>
                            </div>
                            <div class="settings-field">
                                <label for="profilePicInput" style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Profile Avatar</label>
                                <div style="display:flex;align-items:center;gap:1.5rem;">
                                    <img id="profilePicPreview" alt="Profile preview" style="width:96px;height:96px;border-radius:50%;object-fit:cover;border:2px solid var(--accent);box-shadow:0 4px 12px rgba(0,0,0,0.3);display:none;"/>
                                    <div style="flex:1;">
                                        <div class="field-group" style="display:flex;gap:0.75rem;align-items:center;margin-bottom:0.75rem;">
                                            <input id="profilePicInput" type="file" accept="image/*,image/gif,image/jfif" style="flex:1;">
                                            <button id="saveProfileBtn" class="btn-secondary" style="padding:0.875rem 1.5rem;font-weight:600;">Upload</button>
                                        </div>
                                        <div class="muted" style="font-size:0.85rem;">Recommended: Square image, at least 200x200px</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Account Pane -->
                    <div id="accountPane" class="settings-pane" style="display:none;">
                        <div class="settings-card" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:1.5rem;">
                            <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                                <span style="font-size:2rem;margin-right:0.75rem;">🔐</span>
                                <h3 style="font-family:var(--font-heading);font-weight:700;color:var(--accent-soft);margin:0;font-size:1.5rem;">Account Details</h3>
                            </div>
                            <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;">
                                <div class="settings-field" style="margin-bottom:1rem;">
                                    <label style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;font-size:0.85rem;">📧 Email Address</label>
                                    <div id="settingsEmail" style="font-size:1.05rem;color:var(--text);font-weight:600;"></div>
                                </div>
                                <div class="settings-field" style="margin-bottom:0;">
                                    <label style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;font-size:0.85rem;">📅 Member Since</label>
                                    <div id="settingsCreatedDate" style="font-size:1.05rem;color:var(--text);font-weight:600;"></div>
                                </div>
                            </div>
                            <div class="settings-field" style="margin-bottom:1.5rem;">
                                <label for="newEmail" style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Change Email</label>
                                <input id="newEmail" type="email" placeholder="Enter new email" style="width:100%;padding:0.875rem;border-radius:10px;font-size:1rem;">
                            </div>
                            <div class="settings-field" style="margin-bottom:1.5rem;">
                                <label for="newPassword" style="display:block;color:var(--muted);margin-bottom:0.5rem;font-weight:600;">Change Password</label>
                                <input id="newPassword" type="password" placeholder="Enter new password" style="width:100%;padding:0.875rem;border-radius:10px;font-size:1rem;">
                            </div>
                            <button class="btn-primary" id="saveAccountSettings" style="padding:1rem 2rem;font-weight:700;">💾 Save Account Changes</button>
                            <div id="settingsMsg" style="display:none;margin-top:1rem;padding:0.875rem;background:rgba(var(--success-rgb),0.2);border:1px solid var(--success);border-radius:8px;color:var(--success);font-weight:600;"></div>
                        </div>
                        <div class="settings-card" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:1.5rem;">
                            <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                                <span style="font-size:2rem;margin-right:0.75rem;">🔒</span>
                                <h3 style="font-family:var(--font-heading);font-weight:700;color:var(--accent-soft);margin:0;font-size:1.5rem;">Privacy</h3>
                            </div>
                            <div class="settings-field">
                                <label style="display:block;color:var(--muted);margin-bottom:1rem;font-weight:600;">Profile Visibility</label>
                                <div class="toggle-switch" style="display:flex;align-items:center;gap:1rem;background:rgba(255,255,255,0.03);padding:1rem;border-radius:10px;border:1px solid rgba(255,255,255,0.1);">
                                    <label class="muted" style="font-weight:600;">Private</label>
                                    <label class="switch">
                                        <input type="checkbox" id="profilePrivacyToggle">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="muted" style="font-weight:600;">Public</label>
                                </div>
                                <p class="muted" style="font-size:0.9em;max-width:500px;margin-top:1rem;line-height:1.6;">When public, other users can see your subscription plan, join date, level, and rank on the leaderboard.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Appearance Pane -->
                    <div id="appearancePane" class="settings-pane" style="display:none;">
                        <div class="settings-card" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:1.5rem;">
                            <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                                <span style="font-size:2rem;margin-right:0.75rem;">🎨</span>
                                <h3 style="font-family:var(--font-heading);font-weight:700;color:var(--accent-soft);margin:0;font-size:1.5rem;">Theme Presets</h3>
                            </div>
                            <p class="muted" style="margin-bottom:1rem;line-height:1.6;">Choose a base theme for the application that matches your style.</p>
                            <select id="themeSelect" style="width:100%;padding:1rem;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;">
                                <option value="theme-light">☀️ Light Mode</option>
                                <option value="theme-redblack">🔴 Red & Black (Default)</option>
                                <option value="theme-blueblack">🔵 Blue & Black</option>
                                <option value="theme-greenblack">🟢 Green & Black</option>
                                <option value="theme-purpleblack">🟣 Purple & Black</option>
                            </select>
                        </div>
                        <div class="settings-card" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;margin-bottom:1.5rem;">
                            <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                                <span style="font-size:2rem;margin-right:0.75rem;">🌈</span>
                                <h3 style="font-family:var(--font-heading);font-weight:700;color:var(--accent-soft);margin:0;font-size:1.5rem;">Color Customization</h3>
                            </div>
                            <p class="muted" style="margin-bottom:1.5rem;line-height:1.6;">Override the current theme's colors with your personal preferences.</p>
                            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:1.5rem;">
                                <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1.25rem;">
                                    <label class="muted" style="display:block;margin-bottom:0.75rem;font-weight:600;font-size:0.9rem;">Accent Color</label>
                                    <input type="color" id="colorAccent" value="#ff6b6b" style="width:100%;height:60px;border-radius:8px;cursor:pointer;"/>
                                </div>
                                <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1.25rem;">
                                    <label class="muted" style="display:block;margin-bottom:0.75rem;font-weight:600;font-size:0.9rem;">Success (Green)</label>
                                    <input type="color" id="colorSuccess" value="#2ddc90" style="width:100%;height:60px;border-radius:8px;cursor:pointer;"/>
                                </div>
                                <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1.25rem;">
                                    <label class="muted" style="display:block;margin-bottom:0.75rem;font-weight:600;font-size:0.9rem;">Danger (Red)</label>
                                    <input type="color" id="colorDanger" value="#ff6b6b" style="width:100%;height:60px;border-radius:8px;cursor:pointer;"/>
                                </div>
                            </div>
                            <div style="display:flex;gap:1rem;flex-wrap:wrap;">
                                <button class="btn-primary" id="applyColorsBtn" style="padding:1rem 2rem;font-weight:700;">✨ Apply & Save</button>
                                <button class="btn-secondary" id="resetColorsBtn" style="padding:1rem 2rem;font-weight:600;">🔄 Reset to Default</button>
                            </div>
                        </div>

                        <div class="settings-card" style="background:var(--bg-secondary);border:1px solid var(--stroke-weak);border-radius:18px;padding:2rem;">
                          <div style="display:flex;align-items:center;margin-bottom:1.5rem;">
                              <span style="font-size:2rem;margin-right:0.75rem;">🖼️</span>
                              <h3 style="font-family:var(--font-heading);font-weight:700;color:var(--accent-soft);margin:0;font-size:1.5rem;">Custom Background</h3>
                          </div>
                          <p class="muted" style="margin-bottom:1.5rem;line-height:1.6;">Upload a custom background image for your Dashboard & Journal pages.</p>
                          <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1.25rem;margin-bottom:1rem;">
                              <div style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;">
                                <input id="dashboardBgInput" type="file" accept="image/*" style="flex:1;min-width:200px;">
                                <button class="btn-secondary" id="applyBgBtn" style="padding:0.875rem 1.5rem;font-weight:600;">📤 Apply</button>
                                <button class="btn-secondary" id="clearBgBtn" style="padding:0.875rem 1.5rem;font-weight:600;">🗑️ Clear</button>
                              </div>
                          </div>
                          <small class="muted" style="display:block;line-height:1.5;font-size:0.85rem;">💡 Background will be stored locally and only visible on this browser. For best results, use high-quality images.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminTab" class="tab" style="display:none">
            <h2 style="font-family: var(--font-heading); font-weight: 700;">Admin Dashboard</h2>
            <div class="stat-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 1rem;">
                <div class="stat-card">
                    <div class="stat-label">Total Registered Users</div>
                    <div class="stat-value" id="adminTotalUsers">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Journal Entries</div>
                    <div class="stat-value" id="adminTotalEntries">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Platform P&L</div>
                    <div class="stat-value" id="adminTotalPnl">$0</div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1.7fr 1fr; gap: 1rem;">
                <div>
                    <h3 style="color: var(--accent-soft); margin-bottom: 0.5rem;">User Management</h3>
                     <select id="adminUserFilter" style="max-width: 200px; margin-bottom: 1rem;">
                        <option value="24h">Active (24h)</option>
                        <option value="7d">Active (7d)</option>
                        <option value="30d">Active (30d)</option>
                        <option value="all" selected>All Users</option>
                    </select>
                    <div style="overflow-x: auto;">
                        <table class="admin-user-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Subscription</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUserTableBody">
                                <!-- User rows will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div>
                    <h3 style="color: var(--accent-soft); margin-bottom: 0.5rem;">Recent Activity</h3>
                    <div id="adminActivityLog" class="admin-activity-log">
                        <!-- Activity will be injected here -->
                    </div>
                </div>
            </div>
        </div>

      </div>
    </div>
</main>


<!-- Modals -->
<div id="loginModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <span class="close" data-close="loginModal">&times;</span>
    <h2>Login</h2>
    <div id="loginForm">
      <div style="margin-bottom:.6rem"><label class="muted" style="display:block;margin-bottom:.3rem">Email</label><input id="loginEmail" type="email" placeholder="you@email.com"></div>
      <div style="margin-bottom:.6rem;position:relative">
        <label class="muted" style="display:block;margin-bottom:.3rem">Password</label>
        <input id="loginPassword" type="password" placeholder="Password">
        <label style="position:absolute;right:10px;top:36px;cursor:pointer;color:var(--muted)"><input id="loginShowPassword" type="checkbox" style="margin-right:.35rem">Show</label>
      </div>
      <div style="margin-bottom:.6rem;display:flex;align-items:center;gap:.5rem"><input id="rememberMe" type="checkbox"><label for="rememberMe" class="muted">Remember me</label></div>
      <div><button class="btn-primary" id="performLoginBtn">Login</button></div>
      <p class="muted" style="margin-top:.5rem">Don't have an account? <a id="openRegisterLink" style="color:var(--accent-soft);cursor:pointer">Register here</a></p>
      <div id="loginError" style="display:none;color:var(--danger);margin-top:.4rem"></div>
    </div>
  </div>
</div>

<div id="registerModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <span class="close" data-close="registerModal">&times;</span>
    <h2>Register</h2>
    <div id="registerForm">
      <div style="margin-bottom:.45rem"><label class="muted" style="display:block;margin-bottom:.3rem">Username</label><input id="registerName" type="text"></div>
      <div style="margin-bottom:.45rem"><label class="muted" style="display:block;margin-bottom:.3rem">Email</label><input id="registerEmail" type="email"></div>
      <div style="display:flex;gap:.6rem">
        <div style="flex:1;position:relative"><label class="muted" style="display:block;margin-bottom:.3rem">Password</label><input id="registerPassword" type="password"></div>
        <div style="flex:1;position:relative"><label class="muted" style="display:block;margin-bottom:.3rem">Confirm</label><input id="registerConfirmPassword" type="password"></div>
      </div>
      <div style="margin-top:.4rem"><label style="cursor:pointer;color:var(--muted)"><input id="registerShowPassword" type="checkbox" style="margin-right:.35rem">Show passwords</label></div>
      <div style="margin-top:.6rem"><button class="btn-primary" id="performRegisterBtn">Register</button></div>
      <p class="muted" style="margin-top:.5rem">Already have an account? <a id="openLoginLink" style="color:var(--accent-soft);cursor:pointer">Login here</a></p>
      <div id="registerError" style="display:none;color:var(--danger);margin-top:.4rem"></div>
    </div>
  </div>
</div>

<div id="editTradeModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <span class="close" data-close="editTradeModal">&times;</span>
    <h2>Edit Journal Entry</h2>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.6rem">
      <div><label class="muted" style="display:block;margin-bottom:.25rem">Symbol</label><input id="editTradeSymbol" type="text"></div>
      <div><label class="muted" style="display:block;margin-bottom:.25rem">Side</label>
        <select id="editTradeSide"><option value="long">Long</option><option value="short">Short</option></select>
      </div>
      <div><label class="muted" style="display:block;margin-bottom:.25rem">P&L ($)</label><input id="editTradePnl" type="number" step="0.01"></div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.6rem;margin-top:.6rem">
      <div><label class="muted" style="display:block;margin-bottom:.25rem">Original Stop</label><input id="editTradeStop" type="number" step="0.0001"></div>
      <div><label class="muted" style="display:block;margin-bottom:.25rem">Take Profit</label><input id="editTradeTakeProfit" type="number" step="0.0001"></div>
      <div><label class="muted" style="display:block;margin-bottom:.25rem">Size</label><input id="editTradeSize" type="number" step="0.01"></div>
    </div>
    <div style="margin-top:.6rem"><label class="muted" style="display:block;margin-bottom:.25rem">Notes</label><textarea id="editTradeNotes" style="min-height:90px"></textarea></div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:.6rem; margin-top:.6rem">
      <div>
        <label class="muted" style="display:block;margin-bottom:.25rem">Pre-market Analysis</label>
        <textarea id="editPreMarket" style="min-height:80px"></textarea>
      </div>
      <div>
        <label class="muted" style="display:block;margin-bottom:.25rem">Post-market Review</label>
        <textarea id="editPostMarket" style="min-height:80px"></textarea>
      </div>
    </div>
    <div style="margin-top:.6rem">
      <label class="muted" style="display:block;margin-bottom:.25rem">Screenshot</label>
      <input id="editTradeScreenshot" type="file" accept="image/*">
      <div id="editScreenshotPreview" style="margin-top:.5rem;display:none">
        <img id="editScreenshotImg" src="" alt="Screenshot" style="max-width:100%;border-radius:.5rem;border:1px solid var(--stroke-weak)"/>
        <div style="margin-top:.4rem"><button class="btn-secondary" id="removeEditScreenshotBtn">Remove Image</button></div>
      </div>
    </div>
    <div style="margin-top:.8rem"><button class="btn-primary" id="saveEditTradeBtn">Save Changes</button></div>
  </div>
</div>

<div id="deleteConfirmModal" class="modal" aria-hidden="true">
  <div class="modal-content" style="max-width:420px;text-align:center">
    <h3 id="deleteConfirmTitle">Confirm Delete</h3>
    <p id="deleteConfirmText" style="color:var(--muted);margin-top:.4rem">Are you sure you want to delete this entry?</p>
    <div style="display:flex;gap:.6rem;justify-content:center;margin-top:1rem">
      <button class="btn-secondary" id="cancelDeleteBtn">Cancel</button>
      <button class="btn-primary" id="confirmDeleteBtn">Delete</button>
    </div>
  </div>
</div>

<div id="userProfileModal" class="modal" aria-hidden="true">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" data-close="userProfileModal">&times;</span>
        <div id="userProfileContent"></div>
    </div>
</div>

<footer id="footer">
  <div class="inner">
    <span>&copy; 2025 INTRADEL - AI Trading Journal & Mentor Platform. All rights reserved.</span>
  </div>
</footer>

<script>
/* ========== Helpers ========== */
function $(id){ return document.getElementById(id); }
function on(id, evt, handler, options){ const el = $(id); if(el) el.addEventListener(evt, handler, options||false); }
function val(id, dflt){ const el = $(id); return el && typeof el.value !== 'undefined' ? el.value : (dflt||''); }

/* State */
let currentUser = null;
let trades = []; // journal entries (type: 'journal')
let currentPeriod = 'currentMonth';
let meditationTimer = null;
let instructionInterval = null;
let meditationTimeLeft = 0;
let editingTradeId = null;
const ADMIN_EMAIL = 'intradelai@gmail.com';
let breathworkInterval = null;
let pendingDeleteCallback = null;

/* Profile state */
let userProfile = { avatarData: null, mindfulnessJournal: '', isPublic: true, rules: [], xp: 0, habitLog: {} };
let userColors = { accent: null, success: null, danger: null };


/* Charts */
let equityChart = null;
let tradesBarChart = null;
let winLossDonutChart = null;
let mockupEquityChart = null;
let mockupWinLossDonutChart = null;
let ai_pipeline = null;


/* Storage + Accounts */
function initializeUserAccounts(){
  let users = safeJsonParse(localStorage.getItem('intradelUsers')) || {};
  if(!users[ADMIN_EMAIL]) {
      users[ADMIN_EMAIL] = { name: 'INTRADEL', email: ADMIN_EMAIL, password: 'INTRADEL', createdAt: new Date().toISOString(), lastLogin: new Date().toISOString(), isBanned: false, subscription: 'Elite', usernameLastChanged: null };
      localStorage.setItem('intradelUsers', JSON.stringify(users));
  }
  if(!localStorage.getItem('intradelUserData')) localStorage.setItem('intradelUserData', JSON.stringify({}));
  if(!localStorage.getItem('intradelActivityLog')) localStorage.setItem('intradelActivityLog', JSON.stringify([]));
}
function safeJsonParse(str, dflt = null) {
    if (!str) return dflt;
    try {
        return JSON.parse(str);
    } catch (e) {
        console.error("Failed to parse JSON:", e);
        return dflt;
    }
}
function getAllUsers(){ return safeJsonParse(localStorage.getItem('intradelUsers'), {}); }
function getAllUserData(){ return safeJsonParse(localStorage.getItem('intradelUserData'), {}); }
function getActivityLog(){ return safeJsonParse(localStorage.getItem('intradelActivityLog'), []); }

function addActivityLog(message){
    let log = getActivityLog();
    log.unshift({ message, timestamp: new Date().toISOString() });
    if (log.length > 50) log.pop(); // Keep log from getting too large
    localStorage.setItem('intradelActivityLog', JSON.stringify(log));
}

function saveUserAccount(email, userData){
  const users = getAllUsers();
  if(users[email]) return false;
  users[email] = userData;
  localStorage.setItem('intradelUsers', JSON.stringify(users));
  return true;
}
function updateUserAccount(email, userData){
  const users = getAllUsers();
  users[email] = Object.assign({}, users[email] || {}, userData);
  localStorage.setItem('intradelUsers', JSON.stringify(users));
}
function getUserByEmail(email){ const users = getAllUsers(); return users[email] || null; }
function saveUserData(email, data){
  const all = getAllUserData();
  all[email] = data;
  localStorage.setItem('intradelUserData', JSON.stringify(all));
}
function buildUserData(){
  const defaultProfile = { avatarData: null, mindfulnessJournal: '', isPublic: true, rules: [], xp: 0, habitLog: {} };
  return { trades, profile: userProfile || defaultProfile, colors: userColors || { accent:null, success:null, danger:null } };
}

function loadUserData(email) {
    const defaultData = { 
        trades: [], 
        profile: { avatarData: null, mindfulnessJournal: '', isPublic: true, rules: [], xp: 0, habitLog: {} }, 
        colors: { accent: null, success: null, danger: null }
    };

    try {
        const allUserData = getAllUserData();
        let userData = allUserData[email];

        if (!userData) {
            saveUserData(email, defaultData);
            return defaultData;
        }
        
        if (typeof userData !== 'object' || userData === null) {
            console.warn("Corrupted user data object found. Resetting to default.");
            saveUserData(email, defaultData);
            return defaultData;
        }
        
        let wasModified = false;
        if (userData.hasOwnProperty('dailyPnL')) {
            delete userData.dailyPnL;
            wasModified = true;
        }

        if (!Array.isArray(userData.trades)) {
            userData.trades = [];
            wasModified = true;
        }
        
        // Ensure profile and colors objects exist and have default properties
        userData.profile = Object.assign({}, defaultData.profile, userData.profile);
        if(!Array.isArray(userData.profile.rules)) userData.profile.rules = [];
        if(typeof userData.profile.xp !== 'number') userData.profile.xp = 0;
        if(typeof userData.profile.habitLog !== 'object') userData.profile.habitLog = {};


        userData.colors = Object.assign({}, defaultData.colors, userData.colors);
        
        if(wasModified) {
            saveUserData(email, userData);
        }
        
        return userData;

    } catch (error) {
        console.error("CRITICAL: Error loading user data. Resetting to default to prevent crash.", error);
        saveUserData(email, defaultData);
        return defaultData;
    }
}

function saveRemembered(creds){ localStorage.setItem('intradelRemember', JSON.stringify(creds)); }
function loadRemembered(){ return safeJsonParse(localStorage.getItem('intradelRemember')); }
function clearRemembered(){ localStorage.removeItem('intradelRemember'); }

function showNotification(msg){
  const prev = $('notification');
  if(prev) prev.remove();
  const n = document.createElement('div');
  n.id = 'notification';
  n.textContent = msg;
  document.body.appendChild(n);
  setTimeout(()=>n.remove(), 3000);
}
function showError(id, msg){
  const el = $(id);
  if(!el) return;
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(()=>el.style.display='none', 4000);
}

function openModal(modalId) {
    const modal = $(modalId);
    if (modal) modal.style.display = 'flex';
}
function closeModal(modalId) {
    const modal = $(modalId);
    if (modal) modal.style.display = 'none';
}


/* Auth */
function performRegister(){
  const name = val('registerName').trim();
  const email = val('registerEmail').trim().toLowerCase();
  const password = val('registerPassword');
  const confirm = val('registerConfirmPassword');
  if(!name || !email || !password || !confirm){ showError('registerError','Please fill all fields'); return; }
  if (name.length < 3 || name.length > 20) { showError('registerError','Username must be 3-20 characters.'); return; }
  if(password !== confirm){ showError('registerError','Passwords do not match'); return; }
  if(password.length < 6){ showError('registerError','Password must be at least 6 characters'); return; }
  if(getUserByEmail(email)){ showError('registerError','Account already exists. Please login.'); return; }
  const now = new Date().toISOString();
  const userObj = { name, email, password, createdAt: now, lastLogin: now, isBanned: false, subscription: 'Elite', usernameLastChanged: null };
  const ok = saveUserAccount(email, userObj);
  if(!ok){ showError('registerError','Unable to create account'); return; }
  
  const defaultProfile = { avatarData: null, mindfulnessJournal: '', isPublic: true, rules: [], xp: 0, habitLog: {} };
  saveUserData(email, { trades: [], profile: defaultProfile, colors: { accent:null, success:null, danger:null } });
  
  addActivityLog(`New user registered: ${name} (${email})`);

  currentUser = { email, name, subscription: 'Elite' };
  trades = [];
  userProfile = defaultProfile;
  userColors = { accent:null, success:null, danger:null };
  updateUI();
  closeModal('registerModal');
  showPage('dashboard');
  switchToTab('dashboard');
  renderRecentTrades();
  renderDashboard();
  applyUserColors(userColors);
  showNotification('Welcome to INTRADEL, ' + name + '!');
}
function performLogin(){
  const email = val('loginEmail').trim().toLowerCase();
  const password = val('loginPassword');
  if(!email || !password){ showError('loginError','Please provide email and password'); return; }
  const user = getUserByEmail(email);
  if(!user || user.password !== password){ showError('loginError','Invalid email or password'); return; }
  if(user.isBanned) { showError('loginError', 'This account has been suspended.'); return; }
  
  user.lastLogin = new Date().toISOString();
  updateUserAccount(email, user);

  addActivityLog(`User logged in: ${user.name} (${email})`);

  currentUser = { email: user.email, name: user.name, subscription: user.subscription || 'Elite' };
  
  const ud = loadUserData(email);
  trades = ud.trades || [];
  userProfile = ud.profile;
  userColors = ud.colors || { accent:null, success:null, danger:null };

  loadTheme(); // Load theme after user data is loaded
  updateUI();
  closeModal('loginModal');
  showPage('dashboard');
  switchToTab('dashboard');
  renderRecentTrades();
  renderDashboard();
  applyUserColors(userColors);
  showNotification('Welcome back, ' + (user.name || '') + '!');
  const rememberBox = $('rememberMe');
  const remember = rememberBox && rememberBox.checked;
  if(remember) saveRemembered({ email }); // Only save email
  else clearRemembered();
}
function tryAutoLogin(){
  const creds = loadRemembered();
  if(!creds || !creds.email) return;
  const user = getUserByEmail(creds.email);
  if(user){
    if($('loginEmail')) $('loginEmail').value = creds.email;
    const rm = $('rememberMe'); if(rm) rm.checked = true;
    showNotification(`Welcome back! Please enter your password.`);
  } else {
    clearRemembered();
  }
}
function updateAvatarUI(){
  const img = $('userAvatar');
  if(img){
    if(currentUser && userProfile && userProfile.avatarData){
      img.src = userProfile.avatarData;
      img.style.display = 'inline-block';
    } else {
      img.removeAttribute('src');
      img.style.display = 'none';
    }
  }
  const prev = $('profilePicPreview');
  if(prev){
    if(userProfile && userProfile.avatarData){
      prev.src = userProfile.avatarData;
      prev.style.display = 'block';
    } else {
      prev.removeAttribute('src');
      prev.style.display = 'none';
    }
  }
}
function updateUI(){
  const loginBtn = $('loginBtn');
  const registerBtn = $('registerBtn');
  const logoutBtn = $('logoutBtn');
  const userDisplay = $('userDisplay');
  const ctaBtn = $('ctaBtn');
  const homeToDashboardBtn = $('homeToDashboardBtn');
  const adminNav = $('adminNavBtn');
  const finalCtaBtn = $('finalCtaRegisterBtn');

  if(currentUser){
    document.body.classList.remove('page-home');
    if(loginBtn) loginBtn.style.display = 'none';
    if(registerBtn) registerBtn.style.display = 'none';
    if(logoutBtn) logoutBtn.style.display = 'inline-block';
    if(userDisplay){ userDisplay.style.display = 'inline-block'; userDisplay.textContent = currentUser.name || currentUser.email; }
    if(ctaBtn) ctaBtn.style.display = 'none';
    if(homeToDashboardBtn) homeToDashboardBtn.style.display = 'inline-block';
    if(finalCtaBtn) finalCtaBtn.style.display = 'none';
    
    const isAdmin = currentUser.email === ADMIN_EMAIL;
    if(adminNav) adminNav.style.display = isAdmin ? 'flex' : 'none';

  } else {
    document.body.classList.add('page-home');
    if(loginBtn) loginBtn.style.display = 'inline-block';
    if(registerBtn) registerBtn.style.display = 'inline-block';
    if(logoutBtn) logoutBtn.style.display = 'none';
    if(userDisplay) userDisplay.style.display = 'none';
    if(ctaBtn) ctaBtn.style.display = 'inline-block';
    if(homeToDashboardBtn) homeToDashboardBtn.style.display = 'inline-block';
    if(finalCtaBtn) finalCtaBtn.style.display = 'block';
    if(adminNav) adminNav.style.display = 'none';
  }
  updateAvatarUI();
}
function logout(){
  if(currentUser) saveUserData(currentUser.email, buildUserData());
  currentUser = null;
  trades = [];
  userProfile = { avatarData:null, mindfulnessJournal: '', isPublic: true, rules: [], xp: 0, habitLog: {} };
  userColors = { accent:null, success:null, danger:null };
  updateUI();
  showPage('home');
  showNotification('Logged out successfully');
  clearRemembered();
}
function showPage(pageId){
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const el = $(pageId + 'Page');
  if(el) el.classList.add('active');
  if(pageId === 'home') document.body.classList.add('page-home');
  else document.body.classList.remove('page-home');

  if (pageId === 'support') {
     document.querySelectorAll('.faq-item').forEach(item => {
        item.addEventListener('click', () => {
            const answer = item.querySelector('p');
            const icon = item.querySelector('div[style*="font-size: 1.5rem"]');
            const isOpen = answer.style.display === 'block';
            
            // Close all other FAQs
            document.querySelectorAll('.faq-item p').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.faq-item div[style*="font-size: 1.5rem"]').forEach(i => {
                i.textContent = '+';
                i.style.transform = 'rotate(0deg)';
            });
            
            // Toggle current FAQ
            if (!isOpen) {
                answer.style.display = 'block';
                icon.textContent = '−';
                icon.style.transform = 'rotate(180deg)';
            }
        });
    });
  }
}
function switchToTab(tab){
  document.querySelectorAll('#sidebar .nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('#sidebar .nav-item').forEach(n => { if(n.dataset.tab === tab) n.classList.add('active'); });
  document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
  const tabEl = $(tab + 'Tab');
  if(tabEl) tabEl.style.display = 'block';
  
  // Tab-specific render functions
  if(tab === 'stats') updateStatistics(); // Re-render stats on tab switch
  if(tab === 'settings') renderProfileSettings();
  if(tab === 'admin') renderAdminDashboard();
  if(tab === 'leaderboard') renderLeaderboard();
  if(tab === 'habits') renderHabitTracker();
  if(tab === 'ai') updateAIStats(); // Update AI Mentor stats
  if(tab === 'zen') {
      const journalText = (userProfile && userProfile.mindfulnessJournal) ? userProfile.mindfulnessJournal : '';
      if($('mindfulnessJournal')) $('mindfulnessJournal').value = journalText;
  }
}

function updateAIStats() {
  // Update AI Mentor statistics
  if (!currentUser) return;
  const allTrades = trades.filter(t => t.type === 'journal');
  const tradesAnalyzed = allTrades.length;
  
  if ($('aiTradesAnalyzed')) {
    $('aiTradesAnalyzed').textContent = tradesAnalyzed;
  }
}

function renderAdminDashboard() {
    if (!currentUser || currentUser.email !== ADMIN_EMAIL) return;

    const allUsers = getAllUsers();
    const allUserData = getAllUserData();
    const activityLog = getActivityLog();

    // Platform-wide stats
    const totalUsers = Object.keys(allUsers).length;
    let totalEntries = 0;
    let totalPnl = 0;
    for (const email in allUserData) {
        const data = allUserData[email] || {};
        if (data.trades) totalEntries += data.trades.length;
        if (data.trades) {
             totalPnl += data.trades.reduce((sum, trade) => sum + (trade.pnl || 0), 0);
        }
    }
    $('adminTotalUsers').textContent = totalUsers;
    $('adminTotalEntries').textContent = totalEntries;
    const pnlEl = $('adminTotalPnl');
    pnlEl.textContent = `$${totalPnl.toFixed(2)}`;
    pnlEl.className = `stat-value ${totalPnl >= 0 ? 'profit' : 'loss'}`;

    // Render Recent Activity
    const activityLogEl = $('adminActivityLog');
    activityLogEl.innerHTML = activityLog.length > 0
        ? activityLog.slice(0, 10).map(item => `<div>${new Date(item.timestamp).toLocaleString()}: ${item.message}</div>`).join('')
        : '<div>No recent activity.</div>';

    // Filter and render user table
    const userTableBody = $('adminUserTableBody');
    userTableBody.innerHTML = '';
    const filter = val('adminUserFilter');
    const now = new Date().getTime();
    let cutoff;
    switch(filter) {
        case '24h': cutoff = now - (24 * 60 * 60 * 1000); break;
        case '7d': cutoff = now - (7 * 24 * 60 * 60 * 1000); break;
        case '30d': cutoff = now - (30 * 24 * 60 * 60 * 1000); break;
        case 'all': default: cutoff = 0;
    }

    const userList = Object.values(allUsers).filter(user => {
        if (filter === 'all') return true;
        const lastLogin = user.lastLogin ? new Date(user.lastLogin).getTime() : 0;
        return lastLogin >= cutoff;
    }).sort((a, b) => new Date(b.lastLogin || 0) - new Date(a.lastLogin || 0));

    if (userList.length === 0) {
        userTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center; color: var(--muted);">No users match this filter.</td></tr>';
        return;
    }
    
    userList.forEach(user => {
        if (user.email === ADMIN_EMAIL) return; // Don't show admin in the list
        const userData = (getAllUserData()[user.email] || {});
        const pfpData = (userData.profile || {}).avatarData;
        const pfp = pfpData ? `<img src="${pfpData}" class="admin-user-pfp">` : `<img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" class="admin-user-pfp" style="background: var(--bg-2);">`;

        const row = document.createElement('tr');
        if (user.isBanned) row.classList.add('banned-user');
        
        const banButton = `<button class="btn-${user.isBanned ? 'unban' : 'ban'}" onclick="toggleBanStatus('${user.email}')">${user.isBanned ? 'Unban' : 'Ban'}</button>`;
        
        row.innerHTML = `
            <td>
                ${pfp}
                <div class="admin-user-info">
                    <span>${user.name}</span>
                    <span class="email">${user.email}</span>
                </div>
            </td>
            <td>
                <select onchange="updateUserSubscription('${user.email}', this.value)">
                    <option value="Elite" ${user.subscription === 'Elite' ? 'selected' : ''}>Elite</option>
                </select>
            </td>
            <td>${user.isBanned ? 'Banned' : 'Active'}</td>
            <td>${banButton}</td>
        `;
        userTableBody.appendChild(row);
    });
}
function toggleBanStatus(email) {
    let user = getUserByEmail(email);
    if (!user) return;
    user.isBanned = !user.isBanned;
    updateUserAccount(email, user);
    addActivityLog(`User ${user.name} was ${user.isBanned ? 'banned' : 'unbanned'}.`);
    renderAdminDashboard();
}
function updateUserSubscription(email, newPlan) {
    let user = getUserByEmail(email);
    if (!user) return;
    user.subscription = newPlan;
    updateUserAccount(email, user);
    addActivityLog(`User ${user.name}'s subscription updated to ${newPlan}.`);
    renderAdminDashboard();
}

function renderProfileSettings() {
    if (!currentUser) return;
    const user = getUserByEmail(currentUser.email);
    if (!user) return;
    
    // Profile Pane
    $('newUsername').value = user.name || '';
    const usernameInput = $('newUsername');
    const usernameBtn = $('saveUsernameBtn');
    const cooldownEl = $('usernameCooldown');
    const lastChanged = user.usernameLastChanged ? new Date(user.usernameLastChanged).getTime() : 0;
    const now = new Date().getTime();
    const sevenDays = 7 * 24 * 60 * 60 * 1000;
    if (now - lastChanged < sevenDays) {
        usernameInput.disabled = true;
        usernameBtn.disabled = true;
        const nextChangeDate = new Date(lastChanged + sevenDays);
        cooldownEl.textContent = `You can change your username again on ${nextChangeDate.toLocaleDateString()}.`;
    } else {
        usernameInput.disabled = false;
        usernameBtn.disabled = false;
        cooldownEl.textContent = 'You can change your username once every 7 days.';
    }

    const prev = $('profilePicPreview');
    if(userProfile && userProfile.avatarData){
      prev.src = userProfile.avatarData;
      prev.style.display = 'block';
    } else {
      prev.style.display = 'none';
    }
    
    // Account Pane
    $('settingsEmail').textContent = user.email || 'N/A';
    $('settingsCreatedDate').textContent = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A';
    const privacyToggle = $('profilePrivacyToggle');
    if (privacyToggle) {
        privacyToggle.checked = userProfile.isPublic;
    }
    
    // Appearance Pane
    const theme = localStorage.getItem('intradelTheme') || 'theme-redblack';
    $('themeSelect').value = theme;
    $('colorAccent').value = (userColors && userColors.accent) ? userColors.accent : getComputedStyle(document.body).getPropertyValue('--accent').trim();
    $('colorSuccess').value = (userColors && userColors.success) ? userColors.success : getComputedStyle(document.body).getPropertyValue('--success').trim();
    $('colorDanger').value = (userColors && userColors.danger) ? userColors.danger : getComputedStyle(document.body).getPropertyValue('--danger').trim();

    // Habits Pane
    renderRulesManager();
}


/* Persist autosave */
setInterval(()=>{ if(currentUser) saveUserData(currentUser.email, buildUserData()); }, 30000);
window.addEventListener('beforeunload', ()=>{ if(currentUser) saveUserData(currentUser.email, buildUserData()); });

/* Theme */
function applyTheme(name){
  document.body.classList.remove('theme-redblack','theme-blueblack','theme-greenblack','theme-purpleblack', 'theme-light');
  document.body.classList.add(name);
  localStorage.setItem('intradelTheme', name || 'theme-redblack');
  const sel = $('themeSelect'); if(sel) sel.value = name || 'theme-redblack';
  
  // Re-apply custom colors on top of the new theme
  applyUserColors(userColors);

  // Redraw charts with new theme colors
  if (currentUser) {
    renderStatsCharts(getPeriodData(currentPeriod));
  }
}
function loadTheme(){
  const t = localStorage.getItem('intradelTheme') || 'theme-redblack';
  const sel = $('themeSelect'); if(sel) sel.value = t;
  applyTheme(t);
}

/* Journal */
function clearJournalForm(){
  const ids = ['jSymbol','jPnl','jStop','jTakeProfit','jSize','tradeNotes','preMarket','postMarket'];
  ids.forEach(id => { const el = $(id); if(el) el.value = ''; });
  const side = $('jSide'); if(side) side.value='long';
  const file = $('jScreenshot'); if(file) file.value='';
  // Set date to today by default
  $('tradeDate').value = new Date().toISOString().split('T')[0];

  // Clear custom fields and rules
  $('customFieldsContainer').innerHTML = '';
  document.querySelectorAll('#rulesChecklist input').forEach(c => c.checked = false);
}
function logTrade(){
  if(!currentUser){ showNotification('Please login to use Journal'); return; }
  const symbol = val('jSymbol').trim().toUpperCase();
  const side = val('jSide','long') || 'long';
  const pnl = parseFloat(val('jPnl'));
  const dateVal = val('tradeDate');
  const stop = parseFloat(val('jStop'));
  const takeProfit = parseFloat(val('jTakeProfit'));
  const size = parseFloat(val('jSize'));
  const notes = val('tradeNotes').trim();
  const preMarket = val('preMarket').trim();
  const postMarket = val('postMarket').trim();

  // Handle custom fields
  const customFields = {};
  document.querySelectorAll('.custom-field-item').forEach(item => {
    const key = item.dataset.key;
    const value = item.querySelector('input').value;
    if(key && value) customFields[key] = value;
  });

  // Handle rules
  const rulesFollowed = [];
  document.querySelectorAll('#rulesChecklist input:checked').forEach(checkbox => {
    rulesFollowed.push(checkbox.value);
  });

  const fileInput = $('jScreenshot');
  const file = fileInput && fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;

  if(!dateVal){ showNotification('Please select a date'); return; }
  if(isNaN(pnl)){ showNotification('Please enter a valid P&L amount'); return; }

  const outcome = pnl > 0 ? 'win' : (pnl < 0 ? 'loss' : 'breakeven');
  const ts = new Date(dateVal + 'T12:00:00.000Z').toISOString();
  
  const base = { id: Date.now(), type: 'journal', symbol, side, outcome, pnl, stop, takeProfit, size, notes, timestamp: ts, screenshotData: null, preMarket, postMarket, customFields, rulesFollowed };

  const finalize = (obj) => {
    trades.push(obj);
    
    // Add XP
    addXp(10); // +10 XP for journaling
    addXp(rulesFollowed.length * 2); // +2 XP for each rule followed

    autoSave();
    renderRecentTrades();
    renderDashboard();
    clearJournalForm();
    showNotification('Journal entry added! +10 XP');
  };

  if(file){
    const reader = new FileReader();
    reader.onload = (e)=> finalize(Object.assign({}, base, { screenshotData: e.target.result }));
    reader.onerror = ()=> finalize(base);
    reader.readAsDataURL(file);
  } else {
    finalize(base);
  }
}

function getJournalFilters(){
  const qEl = $('journalSearch'); const q = qEl ? (qEl.value || '').toLowerCase() : '';
  const sEl = $('journalSort'); const sort = sEl ? sEl.value : 'dateDesc';
  const oEl = $('journalFilterOutcome'); const fOutcome = oEl ? oEl.value : 'all';
  const sideEl = $('journalFilterSide'); const fSide = sideEl ? sideEl.value : 'all';
  const rEl = $('journalRange'); const range = rEl ? rEl.value : 'last14days';
  return { q, sort, fOutcome, fSide, range };
}
function getRangeDates(range){
  const now = new Date();
  let start, end;
  switch(range){
    case 'last7days': start = new Date(now); start.setDate(now.getDate()-6); end = now; break;
    case 'last14days': start = new Date(now); start.setDate(now.getDate()-13); end = now; break;
    case 'currentMonth': start = new Date(now.getFullYear(), now.getMonth(), 1); end = new Date(now.getFullYear(), now.getMonth()+1, 0); break;
    case 'all': default: start = new Date(0); end = now;
  }
  start = new Date(start.getFullYear(), start.getMonth(), start.getDate());
  end = new Date(end.getFullYear(), end.getMonth(), end.getDate());
  return { start, end };
}
function inRange(ts, start, end){
  if(!ts) return false;
  const d = new Date(ts.split('T')[0] + 'T00:00:00Z');
  return d >= start && d <= end;
}

function renderRecentTrades(){
  if(!currentUser) return;
  const container = $('tradesLog');
  if(!container) return;
  container.innerHTML = '';

  const { q, sort, fOutcome, fSide, range } = getJournalFilters();
  let items = trades.filter(t => t.type === 'journal');

  const { start, end } = getRangeDates(range);
  items = items.filter(t => inRange(t.timestamp, start, end));

  items = items.filter(t => {
    if(fOutcome !== 'all' && t.outcome !== fOutcome) return false;
    if(fSide !== 'all' && t.side !== fSide) return false;
    if(q){
      const hay = [t.symbol, (t.notes||'')].join(' ').toLowerCase();
      if(!hay.includes(q)) return false;
    }
    return true;
  });

  items.sort((a,b)=>{
    const ta = a.timestamp || '';
    const tb = b.timestamp || '';
    switch(sort){
      case 'dateAsc': return ta.localeCompare(tb);
      case 'winFirst':
        if(a.outcome !== b.outcome) return a.outcome === 'win' ? -1 : 1;
        return tb.localeCompare(ta);
      case 'lossFirst':
        if(a.outcome !== b.outcome) return a.outcome === 'loss' ? -1 : 1;
        return tb.localeCompare(ta);
      case 'dateDesc':
      default: return tb.localeCompare(ta);
    }
  });

  const meta = $('journalMeta');
  if(meta) meta.textContent = items.length + ' entr' + (items.length===1?'y':'ies');

  items.forEach(t => {
    const card = document.createElement('div');
    card.className = 'trade-card';
    const pillClass = t.outcome === 'win' ? 'pill-win' : 'pill-loss';
    const day = (t.timestamp||'').split('T')[0];
    const symStr = t.symbol ? `<span class="tag" title="Symbol" style="background:rgba(255,255,255,.06);border:1px solid var(--stroke-weak);padding:.18rem .5rem;border-radius:999px;font-size:.78rem">#${t.symbol}</span>` : '';
    const sideStr = t.side ? `<span class="tag" title="Side" style="background:rgba(255,255,255,.06);border:1px solid var(--stroke-weak);padding:.18rem .5rem;border-radius:999px;font-size:.78rem">${t.side.toUpperCase()}</span>` : '';
    const pnlStr = (typeof t.pnl === 'number' && !Number.isNaN(t.pnl)) ? `<span class="tag" title="P&L" style="background:rgba(255,255,255,.06);border:1px solid ${t.pnl>=0?'rgba(45,220,144,.35)':'rgba(255,107,107,.35)'};color:${t.pnl>=0?'#aef5d5':'#ffb3c1'};padding:.18rem .5rem;border-radius:999px;font-size:.78rem">$${t.pnl.toFixed(2)}</span>` : '';

    const thumb = t.screenshotData ? `<img src="${t.screenshotData}" alt="screenshot" style="width:100%;max-height:180px;object-fit:cover;margin-top:.6rem"/>` : '';

    card.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.25rem">
        <div style="display:flex;gap:.35rem;flex-wrap:wrap">${symStr}${sideStr}${pnlStr}</div>
        <span class="pill ${pillClass}" style="padding:.18rem .5rem;border-radius:999px;border:1px solid var(--stroke-weak);background:rgba(255,255,255,.06);font-weight:700">${t.outcome.toUpperCase()}</span>
      </div>
      <div style="display:flex;justify-content:space-between;gap:.6rem">
        <div style="color:var(--muted)">${day}</div>
      </div>
      <p style="color:var(--muted);margin-top:.6rem;white-space:pre-wrap">${t.notes || ''}</p>
      ${thumb}
      <div class="trade-actions">
        <button title="Edit" class="btn-secondary edit-trade" data-id="${t.id}">Edit</button>
        <button title="Delete" class="btn-secondary delete-trade" data-id="${t.id}">Delete</button>
      </div>`;
    container.appendChild(card);
  });

  document.querySelectorAll('.edit-trade').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const id = e.currentTarget.getAttribute('data-id');
      openEditTradeModal(id);
    });
  });
  document.querySelectorAll('.delete-trade').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const id = e.currentTarget.getAttribute('data-id');
      openConfirmDelete('Are you sure you want to delete this journal entry?', () => {
        trades = trades.filter(tt => String(tt.id) !== String(id));
        autoSave();
        renderRecentTrades();
        renderDashboard();
        showNotification('Entry deleted');
      });
    });
  });
}

function openEditTradeModal(id){
  if(!currentUser){ showNotification('Please login to edit'); return; }
  const t = trades.find(x => String(x.id) === String(id));
  if(!t) return;
  editingTradeId = id;
  $('editTradeSymbol').value = t.symbol || '';
  $('editTradeSide').value = t.side || 'long';
  $('editTradePnl').value = t.pnl;
  $('editTradeStop').value = (t.stop==null?'':t.stop);
  $('editTradeTakeProfit').value = (t.takeProfit==null?'':t.takeProfit);
  $('editTradeSize').value = (t.size==null?'':t.size);
  $('editTradeNotes').value = t.notes || '';
  $('editPreMarket').value = t.preMarket || '';
  $('editPostMarket').value = t.postMarket || '';

  const prevWrap = $('editScreenshotPreview');
  const prevImg = $('editScreenshotImg');
  if(t.screenshotData){
    if(prevImg) prevImg.src = t.screenshotData;
    if(prevWrap) prevWrap.style.display = 'block';
  } else {
    if(prevImg) prevImg.src = '';
    if(prevWrap) prevWrap.style.display = 'none';
  }
  const rem = $('removeEditScreenshotBtn');
  if(rem) rem.onclick = () => {
    const img = $('editScreenshotImg');
    if(img) img.src = '';
    if(prevWrap) prevWrap.style.display = 'none';
    const idx = trades.findIndex(x=>String(x.id)===String(editingTradeId));
    if(idx>=0){ trades[idx].screenshotData = null; }
  };

  openModal('editTradeModal');
}
function saveEditedTrade(){
  if(editingTradeId == null) return;
  const idx = trades.findIndex(t => String(t.id) === String(editingTradeId));
  if(idx < 0) return;
  const fileInput = $('editTradeScreenshot');
  const file = fileInput && fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;
  
  const pnl = parseFloat(val('editTradePnl'));
  if (isNaN(pnl)) {
    showNotification("P&L must be a valid number.");
    return;
  }

  const patch = {
    symbol: val('editTradeSymbol').trim().toUpperCase(),
    side: val('editTradeSide','long') || 'long',
    pnl: pnl,
    outcome: pnl > 0 ? 'win' : (pnl < 0 ? 'loss' : 'breakeven'),
    stop: parseFloat(val('editTradeStop')),
    takeProfit: parseFloat(val('editTradeTakeProfit')),
    size: parseFloat(val('editTradeSize')),
    notes: val('editTradeNotes').trim(),
    preMarket: val('editPreMarket').trim(),
    postMarket: val('editPostMarket').trim(),
  };

  const finalize = (imgData) => {
    if(typeof imgData !== 'undefined') patch.screenshotData = imgData;
    trades[idx] = Object.assign({}, trades[idx], patch);
    autoSave();
    renderRecentTrades();
    renderDashboard();
    closeModal('editTradeModal');
    editingTradeId = null;
    showNotification('Journal entry updated');
  };

  if(file){
    const reader = new FileReader();
    reader.onload = (e)=> finalize(e.target.result);
    reader.onerror = ()=> finalize(undefined);
    reader.readAsDataURL(file);
  } else {
    finalize(undefined);
  }
}

function openConfirmDelete(text, callback) {
    $('deleteConfirmText').textContent = text;
    pendingDeleteCallback = callback;
    openModal('deleteConfirmModal');
}
function confirmDelete() {
    if (pendingDeleteCallback) {
        pendingDeleteCallback();
    }
    cancelDelete(); // Resets state
}
function cancelDelete() {
    pendingDeleteCallback = null;
    closeModal('deleteConfirmModal');
}

/* Period + Statistics */
// NEW: Function to compute daily P&L from the trades array
function computeDailyPnL() {
    const daily = {};
    if (!trades || !Array.isArray(trades)) return daily;
    trades.forEach(trade => {
        if (!trade.timestamp || typeof trade.pnl !== 'number') return;
        const dateKey = trade.timestamp.split('T')[0];
        if (!daily[dateKey]) {
            daily[dateKey] = { trades: 0, pnl: 0, wins: 0, losses: 0 };
        }
        daily[dateKey].trades++;
        daily[dateKey].pnl += trade.pnl;
        if (trade.pnl > 0) daily[dateKey].wins++;
        if (trade.pnl < 0) daily[dateKey].losses++;
    });
    return daily;
}

function getPeriodData(period){
  const now = new Date();
  let startDate, endDate;
  switch(period){
    case 'last14days': startDate = new Date(now); startDate.setDate(now.getDate() - 13); endDate = new Date(now); break;
    case 'currentMonth': startDate = new Date(now.getFullYear(), now.getMonth(), 1); endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0); break;
    case 'lastMonth': startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1); endDate = new Date(now.getFullYear(), now.getMonth(), 0); break;
    case 'allTime': 
        if (trades && trades.length > 0 && trades.some(t => t.timestamp)) {
            const sortedTimestamps = trades.filter(t => t.timestamp).map(t => new Date(t.timestamp).getTime()).sort((a,b) => a - b);
            startDate = new Date(sortedTimestamps[0]);
        } else {
            startDate = new Date(now);
        }
        endDate = new Date(now);
        break;
    default: startDate = new Date(now.getFullYear(), now.getMonth(), 1); endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
  }
  startDate.setHours(0,0,0,0);
  endDate.setHours(23,59,59,999);
  
  const dailyPnL = computeDailyPnL();
  const periodDaily = {};
  
  const cur = new Date(startDate);
  while(cur <= endDate){
    const key = cur.toISOString().split('T')[0];
    periodDaily[key] = dailyPnL[key] || { trades: 0, pnl: 0, wins: 0, losses: 0 };
    cur.setDate(cur.getDate() + 1);
  }

  const periodTrades = (trades || []).filter(t => {
      if (!t.timestamp) return false;
      const tradeDate = new Date(t.timestamp);
      return tradeDate >= startDate && tradeDate <= endDate;
  });

  return { dailyPnL: periodDaily, trades: periodTrades, startDate, endDate };
}

function updateStatistics(){
  if (!currentUser) return;
  const pd = getPeriodData(currentPeriod);
  const periodTrades = pd.trades;

  let totalTrades = periodTrades.length;
  let totalPnL = periodTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
  let wins = periodTrades.filter(t => t.outcome === 'win').length;
  let winRate = totalTrades > 0 ? (wins / totalTrades) * 100 : 0;
  
  let grossProfit = periodTrades.filter(t => t.pnl > 0).reduce((sum, t) => sum + t.pnl, 0);
  let grossLoss = Math.abs(periodTrades.filter(t => t.pnl < 0).reduce((sum, t) => sum + t.pnl, 0));
  let avgWin = wins > 0 ? grossProfit / wins : 0;
  let losses = periodTrades.filter(t => t.outcome === 'loss').length;
  let avgLoss = losses > 0 ? grossLoss / losses : 0;
  
  // Calculate Avg R:R based on stop/tp if available
  const tradesWithRR = periodTrades.filter(t => t.stop && t.takeProfit && t.pnl);
  let totalRR = 0;
  let avgRR = 0;
  if(tradesWithRR.length > 0) {
      totalRR = tradesWithRR.reduce((sum, t) => {
          const potentialRisk = Math.abs(t.pnl / t.size * (t.side === 'long' ? t.stop : -t.stop)); // simplified
          const potentialReward = Math.abs(t.pnl / t.size * (t.side === 'long' ? t.takeProfit : -t.takeProfit)); // simplified
          return sum + (potentialRisk > 0 ? potentialReward / potentialRisk : 0);
      }, 0);
      avgRR = totalRR / tradesWithRR.length;
  } else {
      avgRR = avgLoss > 0 ? avgWin / avgLoss : (avgWin > 0 ? Infinity : 0);
  }


  $('totalTrades').textContent = totalTrades;
  const totalPnlEl = $('totalPnL');
  totalPnlEl.textContent = '$' + totalPnL.toFixed(2);
  totalPnlEl.className = `stat-value ${totalPnL >= 0 ? 'profit' : 'loss'}`;
  $('winRate').textContent = winRate.toFixed(1) + '%';
  $('dashboardLevel').textContent = calculateLevel(userProfile.xp);

  // Stats Tab
  let profitFactor = grossLoss > 0 ? (grossProfit / grossLoss) : (grossProfit > 0 ? Infinity : 0);
  let bestTrade = periodTrades.reduce((max, t) => Math.max(max, t.pnl || -Infinity), -Infinity);
  let worstTrade = periodTrades.reduce((min, t) => Math.min(min, t.pnl || Infinity), Infinity);

  const statTotalPnlEl = $('statTotalPnL');
  statTotalPnlEl.textContent = '$' + totalPnL.toFixed(2);
  statTotalPnlEl.className = `stat-value ${totalPnL >= 0 ? 'profit' : 'loss'}`;
  statTotalPnlEl.style.color = totalPnL >= 0 ? 'var(--success)' : 'var(--danger)';
  $('statProfitFactor').textContent = profitFactor === Infinity ? '∞' : profitFactor.toFixed(2);
  $('statAvgWin').textContent = '$' + avgWin.toFixed(2);
  $('statAvgLoss').textContent = '$' + avgLoss.toFixed(2);
  $('statAvgRR').textContent = avgRR === Infinity ? '∞' : avgRR.toFixed(2);
  $('statWinRate').textContent = winRate.toFixed(1) + '%';
  $('statBestTrade').textContent = '$' + (isFinite(bestTrade) ? bestTrade.toFixed(2) : '0.00');
  $('statWorstTrade').textContent = '$' + (isFinite(worstTrade) ? worstTrade.toFixed(2) : '0.00');
  
  // NEW: Additional Statistics for Redesigned Page
  const dailyData = pd.dailyPnL;
  const winningDays = Object.values(dailyData).filter(d => d.pnl > 0).length;
  const losingDays = Object.values(dailyData).filter(d => d.pnl < 0).length;
  const totalDays = Object.keys(dailyData).length || 1;
  
  // Calculate longest win streak
  let currentStreak = 0;
  let longestStreak = 0;
  Object.values(dailyData).forEach(d => {
    if (d.pnl > 0) {
      currentStreak++;
      longestStreak = Math.max(longestStreak, currentStreak);
    } else if (d.pnl < 0) {
      currentStreak = 0;
    }
  });
  
  // Calculate consistency (percentage of days that are winners)
  const consistency = totalDays > 0 ? (winningDays / totalDays * 100).toFixed(1) : 0;
  
  // Calculate average daily P&L
  const avgDaily = totalDays > 0 ? totalPnL / totalDays : 0;
  
  // Update new stat fields
  if ($('statTotalTrades')) $('statTotalTrades').textContent = totalTrades;
  if ($('statWinningDays')) $('statWinningDays').textContent = winningDays;
  if ($('statLosingDays')) $('statLosingDays').textContent = losingDays;
  if ($('statLongestStreak')) $('statLongestStreak').textContent = `${longestStreak} days`;
  if ($('statConsistency')) $('statConsistency').textContent = `${consistency}% win days`;
  if ($('statBestTime')) $('statBestTime').textContent = 'Morning (9:30-11:00)';
  if ($('statAvgDaily')) $('statAvgDaily').textContent = `$${avgDaily.toFixed(2)}`;

  renderStatsCharts(pd);
}

/* Charts (Statistics) */
function renderStatsCharts(pd){
  if(typeof Chart === 'undefined') return;

  const labels = Object.keys(pd.dailyPnL).map(d => d.slice(5));
  const pnlData = Object.values(pd.dailyPnL).map(d => d.pnl);

  let cum = 0;
  const equity = pnlData.map(p => { cum += p; return cum; });
  const tradesData = Object.values(pd.dailyPnL).map(d => d.trades);

  const winDays = Object.values(pd.dailyPnL).filter(d => d.pnl > 0).length;
  const lossDays = Object.values(pd.dailyPnL).filter(d => d.pnl < 0).length;

  const css = getComputedStyle(document.body);
  const accent = (userColors && userColors.accent) ? userColors.accent : (css.getPropertyValue('--accent').trim() || '#ff6b6b');
  const accentSoft = css.getPropertyValue('--accent-soft').trim() || '#ffbaba';
  const success = (userColors && userColors.success) ? userColors.success : (css.getPropertyValue('--success').trim() || '#2ddc90');
  const danger = (userColors && userColors.danger) ? userColors.danger : (css.getPropertyValue('--danger').trim() || '#ff6b6b');
  const muted = css.getPropertyValue('--muted').trim() || '#9fb0c8';
  const text = css.getPropertyValue('--text').trim() || '#e8eef7';
  const gridColor = 'rgba(150,150,150,0.15)';

  const eqCanvas = $('equityCanvas');
  if(eqCanvas){
    if (equityChart) equityChart.destroy();
    const eqCtx = eqCanvas.getContext('2d');
    const eqConfig = {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {
            type: 'line',
            label: 'Equity',
            data: equity,
            borderColor: accent,
            backgroundColor: accentSoft + '22',
            tension: .35,
            pointRadius: 0,
            yAxisID: 'y'
          },
          {
            type: 'bar',
            label: 'Daily P&L',
            data: pnlData,
            backgroundColor: pnlData.map(v => v>=0 ? success+'99' : danger+'99'),
            borderColor: pnlData.map(v => v>=0 ? success : danger),
            borderWidth: 1,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        plugins: { legend: { display:false }, tooltip: { enabled:true } },
        scales: {
          x: { grid:{ color:gridColor }, ticks:{ color: muted, maxTicksLimit: 10 } },
          y: { position:'left', grid:{ color:gridColor }, ticks:{ color: muted } },
          y1: { position:'right', grid:{ display:false }, ticks:{ color: muted } }
        }
      }
    };
    equityChart = new Chart(eqCtx, eqConfig);
  }

  const tCanvas = $('tradesBarCanvas');
  if(tCanvas){
    if (tradesBarChart) tradesBarChart.destroy();
    const tCtx = tCanvas.getContext('2d');
    const tConfig = {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Trades',
          data: tradesData,
          backgroundColor: accent+'88',
          borderColor: accent,
          borderWidth: 1
        }]
      },
      options: {
        plugins: { legend: { display:false } },
        scales: {
          x: { grid:{ display:false }, ticks:{ color:muted, maxTicksLimit: 10 } },
          y: { grid:{ color:gridColor }, ticks:{ color:muted, precision:0 } }
        }
      }
    };
    tradesBarChart = new Chart(tCtx, tConfig);
  }

  const wlCanvas = $('winLossDonutCanvas');
  if(wlCanvas){
    if (winLossDonutChart) winLossDonutChart.destroy();
    const wlCtx = wlCanvas.getContext('2d');
    const wlConfig = {
      type: 'doughnut',
      data: { labels: ['Winning Days','Losing Days'], datasets: [{ data: [winDays, lossDays], backgroundColor: [success, danger], borderWidth: 0 }] },
      options: { plugins: { legend: { position:'bottom', labels:{ color:text } } }, cutout: '62%' }
    };
    winLossDonutChart = new Chart(wlCtx, wlConfig);
  }
}

/* Calendar */
function mondayIndex(dateObj){
  const jsDay = dateObj.getDay(); // 0=Sun..6=Sat
  return (jsDay + 6) % 7;
}
function renderDashboard(){
  if(!currentUser) return;
  const pd = getPeriodData(currentPeriod);
  const dailyPnL = computeDailyPnL(); // Use computed PnL
  const grid = $('tradesGrid');
  if(!grid) return;
  grid.innerHTML = '';

  const leading = mondayIndex(pd.startDate);
  for(let i=0;i<leading;i++){
    const ph = document.createElement('div');
    ph.className = 'trade-day placeholder';
    ph.innerHTML = '&nbsp;';
    grid.appendChild(ph);
  }

  const cur = new Date(pd.startDate);
  const end = new Date(pd.endDate);
  while(cur <= end){
    const key = cur.toISOString().split('T')[0];
    const d = dailyPnL[key] || { trades: 0, pnl: 0 };
    const el = document.createElement('div');
    
    const dayOfWeek = cur.getDay(); // 0=Sun, 6=Sat
    let cls = '';
    if(d.pnl > 0) cls = 'profit';
    else if(d.pnl < 0) cls = 'loss';
    
    el.className = 'trade-day ' + cls;
    if (dayOfWeek === 6 || dayOfWeek === 0) { // Saturday or Sunday
        el.classList.add('weekend');
    }

    el.innerHTML = `
      <div class="day-number">${cur.getDate()}</div>
      <div class="pnl">$${(d.pnl||0).toFixed(2)}</div>
      <div style="font-size:.85rem;color:var(--muted)">${d.trades||0} trades</div>`;
    grid.appendChild(el);
    cur.setDate(cur.getDate() + 1);
  }

  const totalDays = Math.floor((end - pd.startDate)/(1000*60*60*24)) + 1 + leading;
  const trailing = (7 - (totalDays % 7)) % 7;
  for(let i=0;i<trailing;i++){
    const ph = document.createElement('div');
    ph.className = 'trade-day placeholder';
    ph.innerHTML = '&nbsp;';
    grid.appendChild(ph);
  }

  updateStatistics();
  const titles = { last14days: 'Last 14 Days', currentMonth: 'Current Month', lastMonth: 'Last Month', allTime: 'All Time' };
  const tEl = $('periodTitle'); if(tEl) tEl.textContent = titles[currentPeriod] || 'Current Month';
}

/* AI */
function addAiChatMessage(sender, text) {
    const chatWindow = $('aiChatWindow');
    const bubble = document.createElement('div');
    bubble.className = `ai-chat-bubble ${sender}`;
    bubble.innerHTML = text; // Use innerHTML to allow for lists etc.
    chatWindow.appendChild(bubble);
    chatWindow.scrollTop = chatWindow.scrollHeight;
    return bubble;
}
async function askAI(prompt) {
  if(!currentUser){ showNotification('Please login to use AI Mentor'); return; }
  const q = prompt || val('aiQuestion').trim();
  if (!q) return;

  addAiChatMessage('user', q);
  if (!prompt) $('aiQuestion').value = '';

  const thinkingBubble = addAiChatMessage('ai', '');
  thinkingBubble.innerHTML = `<div class="ai-thinking-indicator"><span></span><span></span><span></span></div>`;

  // Simulate AI thinking delay for realism
  await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1500));

  try {
    const userTrades = trades.filter(t => t.type === 'journal');
    // Generate intelligent response based on actual trading data
    let response = '';
    
    if (userTrades.length === 0) {
      response = `<strong>📊 Let's Get Started!</strong><br><br>I don't see any trades in your journal yet. To provide meaningful analysis, I need data to work with!<br><br>Here's what I recommend:<br>• Log your next <strong>5-10 trades</strong> with detailed notes<br>• Include your emotions, setup, and what you learned<br>• Track both wins AND losses (losses teach us the most!)<br><br>Once you have some trades logged, I'll be able to identify patterns, spot weaknesses, and help you become a more consistent trader. 🚀`;
    } else if (userTrades.length < 5) {
      response = `<strong>📈 Building Your Dataset</strong><br><br>Good start! You have <strong>${userTrades.length} ${userTrades.length === 1 ? 'trade' : 'trades'}</strong> logged. To provide deep insights, I need a larger sample size.<br><br><strong>Quick Observation:</strong><br>`;
      
      const wins = userTrades.filter(t => t.outcome === 'win');
      const winRate = (wins.length / userTrades.length) * 100;
      response += `Your current win rate is <strong>${winRate.toFixed(0)}%</strong> (${wins.length}/${userTrades.length}).<br><br>`;
      response += `<strong>Action Plan:</strong><br>• Log <strong>${5 - userTrades.length} more trades</strong> for meaningful analysis<br>• Be detailed with your notes and emotions<br>• Then ask me again - I'll have much better insights! 💡`;
    } else {
      // FULL ANALYSIS - We have enough data!
      const wins = userTrades.filter(t => t.outcome === 'win');
      const losses = userTrades.filter(t => t.outcome === 'loss');
      const winRate = (wins.length / userTrades.length) * 100;
      const grossProfit = wins.reduce((sum, t) => sum + (t.pnl || 0), 0);
      const grossLoss = losses.reduce((sum, t) => sum + Math.abs(t.pnl || 0), 0);
      const netPnL = grossProfit - grossLoss;
      const profitFactor = grossLoss > 0 ? (grossProfit / grossLoss) : (grossProfit > 0 ? 10 : 0);
      const avgWin = wins.length > 0 ? grossProfit / wins.length : 0;
      const avgLoss = losses.length > 0 ? grossLoss / losses.length : 0;
      const avgRR = avgLoss > 0 ? (avgWin / avgLoss) : avgWin;
      
      // Analyze notes for emotional patterns
      const notesString = userTrades.map(t => `${t.notes || ''} ${t.setup || ''} ${t.preMarket || ''} ${t.postMarket || ''}`.toLowerCase()).join(' ');
      const fomoCount = (notesString.match(/fomo|hesitated|chased|missed|late entry/gi) || []).length;
      const revengeCount = (notesString.match(/revenge|angry|frustrated|emotional|tilted/gi) || []).length;
      const disciplineCount = (notesString.match(/discipline|stuck to plan|followed rules|patient|waited/gi) || []).length;
      const fearCount = (notesString.match(/fear|scared|anxious|nervous|worried/gi) || []).length;
      
      // Time-based analysis
      const tradesByHour = {};
      userTrades.forEach(t => {
        if (t.date) {
          const hour = new Date(t.date).getHours();
          if (!tradesByHour[hour]) tradesByHour[hour] = {wins: 0, losses: 0, total: 0};
          tradesByHour[hour].total++;
          if (t.outcome === 'win') tradesByHour[hour].wins++;
          if (t.outcome === 'loss') tradesByHour[hour].losses++;
        }
      });
      
      let bestHour = null;
      let bestWinRate = 0;
      Object.keys(tradesByHour).forEach(hour => {
        const data = tradesByHour[hour];
        if (data.total >= 2) {
          const rate = (data.wins / data.total) * 100;
          if (rate > bestWinRate) {
            bestWinRate = rate;
            bestHour = hour;
          }
        }
      });
      
      // INTELLIGENT RESPONSE GENERATION based on question
      const questionLower = q.toLowerCase();
      
      if (questionLower.includes('weakness') || questionLower.includes('weak') || questionLower.includes('problem') || questionLower.includes('struggle')) {
        response = `<strong>🔍 Analyzing Your Biggest Weakness</strong><br><br>`;
        response += `<strong>Your Performance Summary:</strong><br>`;
        response += `• <strong>${userTrades.length} trades</strong> analyzed<br>`;
        response += `• Win Rate: <strong>${winRate.toFixed(1)}%</strong><br>`;
        response += `• Net P&L: <strong style="color:${netPnL >= 0 ? 'var(--success)' : 'var(--danger)'}">$${netPnL.toFixed(2)}</strong><br>`;
        response += `• Profit Factor: <strong>${profitFactor.toFixed(2)}</strong><br><br>`;
        
        response += `<strong>⚠️ Key Weakness Identified:</strong><br>`;
        if (winRate < 40) {
          response += `Your win rate of ${winRate.toFixed(0)}% is below optimal. This suggests <strong>setup selection</strong> issues. Focus on quality over quantity - only take A+ setups that meet ALL your criteria.`;
        } else if (avgRR < 1.5 && avgLoss > 0) {
          response += `Your average risk-reward ratio of <strong>${avgRR.toFixed(2)}:1</strong> is too low. You're risking too much relative to your gains. Target trades with AT LEAST 2:1 or 3:1 R:R ratios.`;
        } else if (revengeCount > userTrades.length * 0.15) {
          response += `I detected <strong>${revengeCount} mentions</strong> of revenge trading or emotional frustration. This is your #1 enemy! Take breaks after losses. Never trade angry. Use the ZEN page before trading.`;
        } else if (fomoCount > userTrades.length * 0.2) {
          response += `You have <strong>${fomoCount} instances</strong> of FOMO or chasing. You're entering trades AFTER the move happens. Solution: Wait for pullbacks. Missing a trade is better than a bad entry.`;
        } else if (losses.length > 0 && losses.slice(0, 3).every(t => (t.pnl || 0) < -100)) {
          response += `Your losses are TOO LARGE. You're not cutting losses quickly enough. Set hard stop-losses and DON'T move them wider. A small loss today beats a big loss tomorrow.`;
        } else {
          response += `Your main challenge is <strong>consistency</strong>. While your stats look decent, I see variability in execution. Stick to ONE strategy, master it completely, then expand.`;
        }
        
        response += `<br><br><strong>💡 Action Steps:</strong><br>`;
        response += `1. Review your losing trades and find the common pattern<br>`;
        response += `2. Create a pre-trade checklist and follow it EVERY time<br>`;
        response += `3. Log emotions BEFORE and AFTER each trade<br>`;
        response += `4. Take a break after 2 consecutive losses`;
        
      } else if (questionLower.includes('win') && (questionLower.includes('pattern') || questionLower.includes('what'))) {
        response = `<strong>🎯 Your Winning Patterns</strong><br><br>`;
        response += `I analyzed your <strong>${wins.length} winning trades</strong>. Here's what's working:<br><br>`;
        
        if (disciplineCount > fomoCount) {
          response += `<strong>1. Disciplined Execution</strong><br>`;
          response += `I found <strong>${disciplineCount} mentions</strong> of discipline in your notes. Your wins come when you follow your plan. Keep this up!<br><br>`;
        }
        
        if (bestHour !== null) {
          const hourLabel = bestHour < 12 ? `${bestHour}AM` : bestHour === 12 ? '12PM' : `${bestHour - 12}PM`;
          response += `<strong>2. Time-Based Edge</strong><br>`;
          response += `Your best performance is around <strong>${hourLabel}</strong> with a ${bestWinRate.toFixed(0)}% win rate. Focus your trading during this window.<br><br>`;
        }
        
        if (avgWin > avgLoss * 1.5) {
          response += `<strong>3. Letting Winners Run</strong><br>`;
          response += `Your average win ($${avgWin.toFixed(2)}) is ${(avgWin/avgLoss).toFixed(1)}x your average loss. You're good at letting profits grow! Continue scaling out gradually.<br><br>`;
        }
        
        response += `<strong>📈 Double Down On:</strong><br>`;
        response += `• Trade during your peak performance hours<br>`;
        response += `• Replicate the setup/strategy from your biggest wins<br>`;
        response += `• Maintain the emotional state you had during wins<br>`;
        response += `• Document what made those trades "feel right"`;
        
      } else if (questionLower.includes('risk') || questionLower.includes('management') || questionLower.includes('position size')) {
        response = `<strong>🛡️ Risk Management Analysis</strong><br><br>`;
        response += `<strong>Current Risk Metrics:</strong><br>`;
        response += `• Average Win: <strong style="color:var(--success)">$${avgWin.toFixed(2)}</strong><br>`;
        response += `• Average Loss: <strong style="color:var(--danger)">-$${avgLoss.toFixed(2)}</strong><br>`;
        response += `• Risk-Reward Ratio: <strong>${avgRR.toFixed(2)}:1</strong><br>`;
        response += `• Profit Factor: <strong>${profitFactor.toFixed(2)}</strong><br><br>`;
        
        response += `<strong>💊 Prescription:</strong><br>`;
        if (profitFactor < 1.5) {
          response += `Your profit factor is too low. You need to either:<br>`;
          response += `• Increase your win rate by being more selective<br>`;
          response += `• Improve your R:R by targeting larger wins<br>`;
          response += `• Cut losses faster (tighten stops)<br><br>`;
        }
        
        if (avgLoss > avgWin * 0.7) {
          response += `⚠️ Your losses are almost as large as your wins! This is dangerous.<br><br>`;
          response += `<strong>Risk Management Rules:</strong><br>`;
          response += `• Never risk more than 1-2% of your account per trade<br>`;
          response += `• Set stop-loss BEFORE entering<br>`;
          response += `• If it hits your stop, ACCEPT IT and move on<br>`;
          response += `• Position size = Account Risk ÷ (Entry - Stop Loss)`;
        } else {
          response += `Your risk management is solid. Continue:<br>`;
          response += `• Keeping losses small and controlled<br>`;
          response += `• Setting stops before entry<br>`;
          response += `• Maintaining consistent position sizing`;
        }
        
      } else if (questionLower.includes('time') || questionLower.includes('when')) {
        response = `<strong>⏰ Optimal Trading Times</strong><br><br>`;
        
        if (Object.keys(tradesByHour).length > 0) {
          response += `<strong>Your Performance by Time:</strong><br>`;
          const hoursSorted = Object.keys(tradesByHour).sort((a, b) => {
            const rateA = tradesByHour[a].wins / tradesByHour[a].total;
            const rateB = tradesByHour[b].wins / tradesByHour[b].total;
            return rateB - rateA;
          });
          
          hoursSorted.slice(0, 3).forEach(hour => {
            const data = tradesByHour[hour];
            const rate = (data.wins / data.total) * 100;
            const hourLabel = hour < 12 ? `${hour}:00 AM` : hour === 12 ? '12:00 PM' : `${hour - 12}:00 PM`;
            response += `• <strong>${hourLabel}</strong>: ${rate.toFixed(0)}% win rate (${data.wins}/${data.total} trades)<br>`;
          });
          
          response += `<br><strong>💡 Recommendation:</strong><br>`;
          response += `Focus your energy during your peak hours. Quality > Quantity. If you're not in your prime time window, consider paper trading or stepping away entirely.`;
        } else {
          response += `I don't have enough time-stamped data yet. Make sure to log the exact date/time of your trades!<br><br>`;
          response += `<strong>General Best Practices:</strong><br>`;
          response += `• 9:30-10:30 AM: High volatility, experienced traders only<br>`;
          response += `• 10:30-11:30 AM: Momentum continuation, good for trends<br>`;
          response += `• 2:00-4:00 PM: Power hour, institutional money moves<br>`;
          response += `• Avoid: 12:00-2:00 PM (lunch time, low volume)`;
        }
        
      } else if (questionLower.includes('emotion') || questionLower.includes('feeling') || questionLower.includes('mental') || questionLower.includes('psychology')) {
        response = `<strong>🧠 Emotional Pattern Analysis</strong><br><br>`;
        response += `<strong>Psychological Markers Detected:</strong><br>`;
        response += `• FOMO/Chasing: <strong>${fomoCount}</strong> mentions<br>`;
        response += `• Revenge/Anger: <strong>${revengeCount}</strong> mentions<br>`;
        response += `• Fear/Anxiety: <strong>${fearCount}</strong> mentions<br>`;
        response += `• Discipline: <strong>${disciplineCount}</strong> mentions<br><br>`;
        
        if (revengeCount > 2) {
          response += `⚠️ <strong>High Revenge Trading Alert!</strong><br>`;
          response += `You have ${revengeCount} instances of emotional trading. This is destroying your account.<br><br>`;
          response += `<strong>Solution:</strong><br>`;
          response += `• MANDATORY: After any loss, take a 30-minute break<br>`;
          response += `• Use the ZEN page to reset your mindset<br>`;
          response += `• Set a "max losses per day" rule (suggest: 2)<br>`;
          response += `• Journal your emotions BEFORE placing the next trade`;
        } else if (fomoCount > 3) {
          response += `📉 <strong>FOMO Pattern Detected</strong><br>`;
          response += `You're chasing trades that have already moved. This leads to bad entries.<br><br>`;
          response += `<strong>Fix:</strong><br>`;
          response += `• Wait for pullbacks - there's ALWAYS another trade<br>`;
          response += `• If you missed it, let it go. Don't chase<br>`;
          response += `• Set alerts for your levels and wait patiently<br>`;
          response += `• Remember: Missing a trade ≠ Losing money`;
        } else {
          response += `✅ <strong>Solid Emotional Control!</strong><br>`;
          response += `You're managing emotions well. Your discipline is showing in your notes. Keep this energy!<br><br>`;
          response += `To maintain this:<br>`;
          response += `• Continue pre-trade meditation/visualization<br>`;
          response += `• Keep documenting your emotional state<br>`;
          response += `• Celebrate discipline, not just profits`;
        }
        
      } else if (questionLower.includes('compare') || questionLower.includes('month')) {
        response = `<strong>📊 Performance Comparison</strong><br><br>`;
        response += `<strong>Overall Stats:</strong><br>`;
        response += `• Total Trades: <strong>${userTrades.length}</strong><br>`;
        response += `• Win Rate: <strong>${winRate.toFixed(1)}%</strong><br>`;
        response += `• Net P&L: <strong style="color:${netPnL >= 0 ? 'var(--success)' : 'var(--danger)'}">$${netPnL.toFixed(2)}</strong><br>`;
        response += `• Profit Factor: <strong>${profitFactor.toFixed(2)}</strong><br><br>`;
        
        response += `<strong>💡 Insights:</strong><br>`;
        if (winRate >= 50 && profitFactor > 1.5) {
          response += `Excellent performance! You're in the top 20% of traders. Keep refining your edge.`;
        } else if (winRate >= 40 && profitFactor > 1.2) {
          response += `Solid performance with room for improvement. Focus on either increasing win rate OR improving R:R.`;
        } else {
          response += `You're in building phase. Every great trader started here. Focus on consistency and process over profits.`;
        }
        
      } else {
        // Default response with full analysis
        response = `<strong>📈 IntradelAI Analysis</strong><br><br>`;
        response += `<strong>Your Trading Profile:</strong><br>`;
        response += `• Total Trades: <strong>${userTrades.length}</strong><br>`;
        response += `• Win Rate: <strong>${winRate.toFixed(1)}%</strong> (${wins.length}W / ${losses.length}L)<br>`;
        response += `• Net P&L: <strong style="color:${netPnL >= 0 ? 'var(--success)' : 'var(--danger)'}">$${netPnL.toFixed(2)}</strong><br>`;
        response += `• Profit Factor: <strong>${profitFactor.toFixed(2)}</strong><br>`;
        response += `• Avg Win: <strong style="color:var(--success)">$${avgWin.toFixed(2)}</strong> | Avg Loss: <strong style="color:var(--danger)">-$${avgLoss.toFixed(2)}</strong><br>`;
        response += `• Risk-Reward: <strong>${avgRR.toFixed(2)}:1</strong><br><br>`;
        
        response += `<strong>🎯 Quick Assessment:</strong><br>`;
        if (profitFactor > 2) {
          response += `Excellent profitability! You're managing risk well and letting winners run. Keep doing what you're doing.`;
        } else if (profitFactor > 1.5) {
          response += `Profitable trader with solid fundamentals. Work on either increasing win rate or improving average win size.`;
        } else if (profitFactor > 1) {
          response += `You're profitable but there's significant room for improvement. Focus on cutting losses faster and being more selective.`;
        } else {
          response += `You're currently unprofitable. Don't worry - this is part of the learning process. Focus on: (1) Smaller position sizes, (2) Tighter stops, (3) Better setup selection.`;
        }
        
        response += `<br><br><strong>💬 Ask me specific questions like:</strong><br>`;
        response += `• "What's my biggest weakness?"<br>`;
        response += `• "What patterns exist in my wins?"<br>`;
        response += `• "How can I improve risk management?"<br>`;
        response += `• "What's my best trading time?"<br>`;
        response += `• "Analyze my emotional patterns"`;
      }
    }

    thinkingBubble.innerHTML = response;

  } catch (error) {
    console.error('AI Error:', error);
    thinkingBubble.textContent = 'Error: Could not run AI analysis. Please refresh and try again.';
  } finally {
      $('aiChatWindow').scrollTop = $('aiChatWindow').scrollHeight;
  }
}

/* Settings */
function saveAccountSettings(){
  if(!currentUser){ showNotification('Please login to change account settings'); return; }
  const newEmail = val('newEmail').trim().toLowerCase();
  const newPassword = val('newPassword');
  if(!newEmail && !newPassword){ showNotification('No changes to save'); return; }
  const users = getAllUsers();
  const me = users[currentUser.email];
  if(!me){ showNotification('Current account not found'); return; }
  if(newEmail && newEmail !== currentUser.email && users[newEmail]){ showNotification('Email already in use'); return; }
  if(newPassword) me.password = newPassword;
  if(newEmail && newEmail !== currentUser.email){
    me.email = newEmail;
    const allData = getAllUserData();
    allData[newEmail] = allData[currentUser.email] || buildUserData();
    delete allData[currentUser.email];
    localStorage.setItem('intradelUserData', JSON.stringify(allData));
    const allUsers = getAllUsers();
    allUsers[newEmail] = Object.assign({}, me);
    delete allUsers[currentUser.email];
    localStorage.setItem('intradelUsers', JSON.stringify(allUsers));
    currentUser.email = newEmail;
  } else {
    updateUserAccount(currentUser.email, me);
  }
  updateUserAccount(currentUser.email, me);
  saveUserData(currentUser.email, buildUserData());
  if($('newEmail')) $('newEmail').value = '';
  if($('newPassword')) $('newPassword').value = '';
  const msg = $('settingsMsg');
  if(msg){ msg.textContent = 'Account updated'; msg.style.display = 'block'; setTimeout(()=>msg.style.display='none',3000); }
  renderProfileSettings();
}

function saveUsername() {
    if (!currentUser) return;
    const newUsername = val('newUsername').trim();
    if (!newUsername) { showNotification('Username cannot be empty.'); return; }
    if (newUsername.length < 3 || newUsername.length > 20) { showNotification('Username must be 3-20 characters.'); return; }

    const user = getUserByEmail(currentUser.email);
    const now = new Date().toISOString();
    user.name = newUsername;
    user.usernameLastChanged = now;
    
    updateUserAccount(currentUser.email, user);
    currentUser.name = newUsername;
    
    autoSave();
    updateUI();
    renderProfileSettings();
    showNotification('Username updated!');
}

function autoSave(){ if(currentUser) saveUserData(currentUser.email, buildUserData()); }

/* Color overrides */
function hexToRgb(hex){
  let h = hex.replace('#','').trim();
  if(h.length===3){ h = h.split('').map(c=>c+c).join(''); }
  const bigint = parseInt(h,16);
  return { r:(bigint>>16)&255, g:(bigint>>8)&255, b:bigint&255 };
}
function applyUserColors(colors){
  if(colors && colors.accent){ document.documentElement.style.setProperty('--accent', colors.accent); } else { document.documentElement.style.removeProperty('--accent'); }
  if(colors && colors.success){ document.documentElement.style.setProperty('--success', colors.success); } else { document.documentElement.style.removeProperty('--success'); }
  if(colors && colors.danger){ document.documentElement.style.setProperty('--danger', colors.danger); } else { document.documentElement.style.removeProperty('--danger'); }
  
  const styleEl = $('dynamicColorStyle');
  if(styleEl){
    const succ = (colors && colors.success) ? colors.success : getComputedStyle(document.body).getPropertyValue('--success').trim();
    const dang = (colors && colors.danger) ? colors.danger : getComputedStyle(document.body).getPropertyValue('--danger').trim();
    let css = '';
    if(succ){
      const s = hexToRgb(succ);
      css += `
.trade-day.profit{background: linear-gradient(180deg, rgba(${s.r},${s.g},${s.b},0.45), rgba(${s.r},${s.g},${s.b},0.25)) !important; border-color: rgba(${s.r},${s.g},${s.b},0.6) !important; box-shadow: 0 12px 28px rgba(${s.r},${s.g},${s.b},0.12);}
.home-cal .home-day.profit{background: linear-gradient(180deg, rgba(${s.r},${s.g},${s.b},0.40), rgba(${s.r},${s.g},${s.b},0.22)) !important; border-color: rgba(${s.r},${s.g},${s.b},0.45);}
      `;
    }
    if(dang){
      const d = hexToRgb(dang);
      css += `
.trade-day.loss{background: linear-gradient(180deg, rgba(${d.r},${d.g},${d.b},0.45), rgba(${d.r},${d.g},${d.b},0.25)) !important; border-color: rgba(${d.r},${d.g},${d.b},0.6) !important; box-shadow: 0 12px 28px rgba(${d.r},${d.g},${d.b},0.12);}
.home-cal .home-day.loss{background: linear-gradient(180deg, rgba(${d.r},${d.g},${d.b},0.40), rgba(${d.r},${d.g},${d.b},0.22)) !important; border-color: rgba(${d.r},${d.g},${d.b},0.45);}
      `;
    }
    styleEl.textContent = css;
  }
  if (currentUser) renderDashboard();
}

/* DOM bindings */
document.addEventListener('DOMContentLoaded', () => {
  initializeUserAccounts();
  initializeSoundscapes();
  loadTheme();
  updateUI();
  clearJournalForm();
  initBackgroundCanvas();
  initHomepageAnimations();
  tryAutoLogin();

  // Header nav
  on('logo','click', () => { if (currentUser) { showPage('dashboard'); switchToTab('dashboard'); } else { showPage('home'); } });
  on('homeNav','click', () => showPage('home'));
  on('featuresNav','click', () => showPage('features'));
  on('aboutNav','click', () => showPage('about'));
  on('subsNav','click', () => showPage('subscriptions'));
  on('giveawaysNav','click', () => showPage('giveaways'));
  on('supportNav','click', () => showPage('support'));

  on('ctaBtn','click', () => openModal('registerModal'));
  on('homeToDashboardBtn', 'click', () => { if(currentUser) { showPage('dashboard'); switchToTab('dashboard'); } else { openModal('loginModal'); } });

  // Auth
  on('loginBtn','click', () => openModal('loginModal'));
  on('registerBtn','click', () => openModal('registerModal'));
  on('logoutBtn','click', logout);

  document.querySelectorAll('.close').forEach(btn => {
    const target = btn.getAttribute('data-close');
    if(target) btn.addEventListener('click', () => closeModal(target));
  });
  on('openRegisterLink','click', (e)=> { e.preventDefault(); closeModal('loginModal'); openModal('registerModal'); });
  on('openLoginLink','click', (e)=> { e.preventDefault(); closeModal('registerModal'); openModal('loginModal'); });
  on('performRegisterBtn','click', performRegister);
  on('performLoginBtn','click', performLogin);
  on('loginShowPassword','change', (e)=> { const lp = $('loginPassword'); if(lp) lp.type = e.target.checked ? 'text' : 'password'; });
  on('registerShowPassword','change', (e)=> {
    const t1 = $('registerPassword');
    const t2 = $('registerConfirmPassword');
    if(t1) t1.type = e.target.checked ? 'text' : 'password';
    if(t2) t2.type = e.target.checked ? 'text' : 'password';
  });


  // Dashboard tab switching
  const sidebar = $('sidebar');
  if(sidebar){
    sidebar.addEventListener('click', (e) => {
      const item = e.target.closest('.nav-item');
      if(!item) return;
      const tab = item.getAttribute('data-tab');
      if(tab) switchToTab(tab);
    });
  }

  on('periodSelect','change', (e) => {
    currentPeriod = e.target.value;
    renderDashboard();
  });

  // Journal actions
  on('logTradeBtn','click', logTrade);
  on('clearJournalBtn','click', clearJournalForm);
  on('journalSearch','input', renderRecentTrades);
  on('journalSort','change', renderRecentTrades);
  on('journalFilterOutcome','change', renderRecentTrades);
  on('journalFilterSide','change', renderRecentTrades);
  on('journalRange','change', renderRecentTrades);

  // Zen tab actions
  on('startMeditation5','click', () => startMeditation(300));
  on('startMeditation10','click', () => startMeditation(600));
  on('toggleBreathworkBtn', 'click', toggleBreathwork);
  document.querySelector('.soundscape-controls').addEventListener('click', (e) => {
    const btn = e.target.closest('.sound-btn');
    if (btn) {
        const sound = btn.dataset.sound;
        playZenSound(sound);
    }
  });
  on('saveMindfulnessBtn', 'click', () => {
      if(currentUser && userProfile) {
          userProfile.mindfulnessJournal = val('mindfulnessJournal');
          autoSave();
          showNotification('Mindfulness note saved.');
      } else {
          showNotification('Please log in to save notes.');
      }
  });

  // AI
  on('askAIBtn','click', () => askAI());
  document.querySelector('.ai-suggested-prompts').addEventListener('click', (e) => {
      if(e.target.classList.contains('ai-prompt-btn')) {
          askAI(e.target.textContent);
      }
  });
  on('aiQuestion', 'keydown', (e) => { if(e.key === 'Enter') askAI(); });

  // Edit journal modal
  on('saveEditTradeBtn','click', saveEditedTrade);

  // Settings Page Redesign
  document.querySelector('#settingsTab .settings-nav').addEventListener('click', (e) => {
      const navItem = e.target.closest('.settings-nav-item');
      if (navItem) {
          const pane = navItem.dataset.pane;
          
          // Update navigation active states and styles
          document.querySelectorAll('#settingsTab .settings-nav-item').forEach(i => {
              i.classList.remove('active');
              i.style.background = '';
              i.style.borderColor = 'transparent';
              i.style.color = 'var(--muted)';
          });
          
          navItem.classList.add('active');
          navItem.style.background = 'rgba(var(--accent-rgb), 0.1)';
          navItem.style.borderColor = 'rgba(var(--accent-rgb), 0.2)';
          navItem.style.color = 'var(--accent-soft)';
          
          // Update panes
          document.querySelectorAll('.settings-pane').forEach(p => {
              p.classList.remove('active');
              p.style.display = 'none';
          });
          const targetPane = $(pane + 'Pane');
          if (targetPane) {
              targetPane.classList.add('active');
              targetPane.style.display = 'block';
          }
      }
  });

  on('themeSelect','change', (e)=> {
      applyTheme(e.target.value);
      showNotification('Theme applied. Colors have been reset to theme defaults.');
      if(!currentUser){ return; }
      userColors = { accent:null, success:null, danger:null };
      saveUserData(currentUser.email, buildUserData());
      renderProfileSettings(); // update color inputs
  });

  on('applyColorsBtn','click', () => {
    if(!currentUser){ showNotification('Login to save colors'); return; }
    const accent = val('colorAccent') || null;
    const success = val('colorSuccess') || null;
    const danger = val('colorDanger') || null;
    userColors = { accent, success, danger };
    applyUserColors(userColors);
    saveUserData(currentUser.email, buildUserData());
    showNotification('Colors saved');
  });
  on('resetColorsBtn','click', () => {
    if(!currentUser){ showNotification('Login to reset colors'); return; }
    userColors = { accent:null, success:null, danger:null };
    applyUserColors(userColors); // This will remove inline styles and fall back to stylesheet
    saveUserData(currentUser.email, buildUserData());
    renderProfileSettings(); // Re-render to show default color values in inputs
    showNotification('Colors reset to theme defaults');
  });

  // Profile picture handlers
  on('saveProfileBtn','click', () => {
    if(!currentUser){ showNotification('Login to save profile'); return; }
    const fileInput = $('profilePicInput');
    const file = fileInput.files && fileInput.files[0];
    if (!file) {
        showNotification('No new avatar selected.');
        return;
    }

    const isEliteOrAdmin = currentUser.subscription === 'Elite' || currentUser.email === ADMIN_EMAIL;
    const isAnimated = file.type === 'image/gif' || file.type === 'image/jfif';

    if (isAnimated && !isEliteOrAdmin) {
      showNotification('Animated avatars are for Elite members only.');
      fileInput.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      userProfile.avatarData = e.target.result;
      autoSave();
      updateAvatarUI();
      renderProfileSettings();
      showNotification('Profile picture saved!');
    };
    reader.readAsDataURL(file);
  });

  // Account
  on('saveAccountSettings','click', saveAccountSettings);
  on('saveUsernameBtn', 'click', saveUsername);
  on('profilePrivacyToggle', 'change', (e) => {
      if (userProfile) {
          userProfile.isPublic = e.target.checked;
          autoSave();
          showNotification(`Profile set to ${userProfile.isPublic ? 'Public' : 'Private'}`);
      }
  });
  
  // Admin
  on('adminUserFilter', 'change', renderAdminDashboard);

  // Misc page actions
  on('planEliteBtn','click', ()=> { if (currentUser) { showNotification('Elite plan activated!'); } else { openModal('registerModal'); } });
  on('finalCtaRegisterBtn', 'click', () => openModal('registerModal'));
  
  // View Pricing button on Features page
  document.querySelectorAll('.cta-button').forEach(btn => {
    if (btn.textContent.trim() === 'View Pricing') {
      btn.addEventListener('click', () => showPage('subscriptions'));
    }
  });


  // Login enter submit
  on('loginPassword', 'keydown', (e) => { if(e.key === 'Enter') performLogin(); });

  // Delete modal
  on('cancelDeleteBtn','click', cancelDelete);
  on('confirmDeleteBtn','click', confirmDelete);

});

/* ZEN Page Features - Real Working Soundscapes with Web Audio API */
const soundscapes = {};
let audioContext = null;
let currentSoundSource = null;

function initializeSoundscapes() {
    // Initialize Web Audio API context (will be started on first user interaction)
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    // Define soundscape generators
    soundscapes.rain = () => createRainSound();
    soundscapes.forest = () => createForestSound();
    soundscapes.waves = () => createWavesSound();
}

// Rain sound generator using white noise filtered
function createRainSound() {
    const bufferSize = audioContext.sampleRate * 2;
    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
    }
    
    const source = audioContext.createBufferSource();
    source.buffer = buffer;
    source.loop = true;
    
    // Filter to make it sound like rain
    const filter = audioContext.createBiquadFilter();
    filter.type = 'bandpass';
    filter.frequency.value = 1000;
    filter.Q.value = 0.5;
    
    const gainNode = audioContext.createGain();
    gainNode.gain.value = 0.3;
    
    source.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    return { source, nodes: [filter, gainNode] };
}

// Forest ambience with chirping birds
function createForestSound() {
    // Base wind/rustling sound
    const bufferSize = audioContext.sampleRate * 3;
    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < bufferSize; i++) {
        data[i] = (Math.random() * 2 - 1) * 0.3;
    }
    
    const source = audioContext.createBufferSource();
    source.buffer = buffer;
    source.loop = true;
    
    const filter = audioContext.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.value = 800;
    
    const gainNode = audioContext.createGain();
    gainNode.gain.value = 0.2;
    
    source.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    // Add occasional bird chirps
    const chirpInterval = setInterval(() => {
        if (currentSoundSource) {
            const osc = audioContext.createOscillator();
            const chirpGain = audioContext.createGain();
            
            osc.frequency.value = 2000 + Math.random() * 1000;
            chirpGain.gain.value = 0;
            
            osc.connect(chirpGain);
            chirpGain.connect(audioContext.destination);
            
            const now = audioContext.currentTime;
            chirpGain.gain.setValueAtTime(0, now);
            chirpGain.gain.linearRampToValueAtTime(0.1, now + 0.05);
            chirpGain.gain.linearRampToValueAtTime(0, now + 0.2);
            
            osc.start(now);
            osc.stop(now + 0.2);
        }
    }, 3000 + Math.random() * 5000);
    
    return { source, nodes: [filter, gainNode], interval: chirpInterval };
}

// Ocean waves sound
function createWavesSound() {
    const bufferSize = audioContext.sampleRate * 4;
    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    // Create wave-like pattern
    for (let i = 0; i < bufferSize; i++) {
        const t = i / audioContext.sampleRate;
        const wave = Math.sin(t * Math.PI * 0.5) * Math.sin(t * Math.PI * 2);
        data[i] = (Math.random() * 0.5 - 0.25) * wave + wave * 0.3;
    }
    
    const source = audioContext.createBufferSource();
    source.buffer = buffer;
    source.loop = true;
    
    const filter = audioContext.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.value = 600;
    filter.Q.value = 1;
    
    const gainNode = audioContext.createGain();
    gainNode.gain.value = 0.4;
    
    source.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    return { source, nodes: [filter, gainNode] };
}

// OLD DUMMY DATA - REPLACED ABOVE
function initializeSoundscapesDummy() {
    // Short, loopable base64 audio files.
    const sounds = {
        rain: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB1cHJvY2Vzc2VkIGJ5IG1wM2RpYWcgdjEuMTIgKGh0dHA6Ly9tcDNkaWFnLm1hZ25vLml0KQCrgAAAAAAB9AAAKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//tAwBMAAAAAAABQoAAAAAAAAAABEwVVIuAAgEAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//tAwBLAAAACAAADSAAAAAPAERAIAgICAoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//t-AwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//t-AwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tá',
        forest: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB1cHJvY2Vzc2VkIGJ5IG1wM2RpYWcgdjEuMTIgKGh0dHA6Ly9tcDNkaWFnLm1hZ25vLml0KQCrgAAAAAAB9AAAKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//tAwBMAAAAAAABQoAAAAAAAAAABEwVVIuAAgEAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//tAwBLAAAACAAADSAAAAAPAERAIAgICAoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tá',
        waves: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB1cHJvY2Vzc2VkIGJ5IG1wM2RpYWcgdjEuMTIgKGh0dHA6Ly9tcDNkaWFnLm1hZ25vLml0KQCrgAAAAAAB9AAAKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//tAwBMAAAAAAABQoAAAAAAAAAABEwVVIuAAgEAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//tAwBLAAAACAAADSAAAAAPAERAIAgICAoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tAwBIAAABCAAADSAAAAAPcBAQCAgKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK//tá'
    };
    for (const key in sounds) {
        const audio = new Audio(sounds[key]);
        audio.loop = true;
        soundscapes[key] = audio;
    }
}

// NEW WORKING PLAY FUNCTION
function playZenSound(soundName) {
    // Stop current sound
    if (currentSoundSource) {
        currentSoundSource.source.stop();
        if (currentSoundSource.interval) {
            clearInterval(currentSoundSource.interval);
        }
        currentSoundSource = null;
    }
    
    document.querySelectorAll('.sound-btn').forEach(btn => btn.classList.remove('active'));

    if (soundName && soundName !== 'none' && soundscapes[soundName]) {
        // Resume audio context if suspended (browser autoplay policy)
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
        
        // Create and start new sound
        currentSoundSource = soundscapes[soundName]();
        currentSoundSource.source.start();
        
        const btn = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
        if (btn) btn.classList.add('active');
        $('nowPlayingSound').textContent = `🎵 Now Playing: ${soundName.charAt(0).toUpperCase() + soundName.slice(1)}`;
        showNotification(`Now playing ${soundName} soundscape`);
    } else {
        $('nowPlayingSound').textContent = '';
    }
}
function toggleBreathwork() {
    const visualizer = $('breathingVisualizer');
    const pacer = $('breathPacer');
    const instruction = $('breathInstruction');
    const btn = $('toggleBreathworkBtn');

    if (visualizer.classList.contains('active')) {
        visualizer.classList.remove('active');
        clearInterval(breathworkInterval);
        instruction.textContent = 'Start';
        btn.textContent = 'Start Breathing';
    } else {
        visualizer.classList.add('active');
        btn.textContent = 'Stop Breathing';
        let step = 0;
        const instructions = ['Inhale...', 'Hold...', 'Exhale...', 'Hold...'];
        instruction.textContent = instructions[step];
        breathworkInterval = setInterval(() => {
            step = (step + 1) % 4;
            instruction.textContent = instructions[step];
        }, 4000);
    }
}

function startMeditation(durationSeconds){
  const overlay = document.createElement('div');
  overlay.className = 'meditation-overlay';
  overlay.innerHTML = `
    <div class="meditation-bg"></div>
    <div class="meditation-screen">
      <div class="meditation-panel">
        <h2 style="color:var(--accent-soft); font-family: var(--font-heading); font-weight: 700;">Find Your Center</h2>
        <p class="meditation-instruction">Close your eyes. Breathe deeply.</p>
        <div class="meditation-timer"></div>
        <button class="btn-secondary" id="endMeditationBtn" style="margin-top:1.25rem">End Session</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  document.body.classList.add('in-meditation');

  meditationTimeLeft = durationSeconds;
  const timerEl = overlay.querySelector('.meditation-timer');
  const instructionEl = overlay.querySelector('.meditation-instruction');
  const instructions = ["Notice the air on your skin.", "Feel the weight of your body.", "Listen to the sounds around you.", "Return your focus to your breath."];
  let i_idx = 0;
  
  const updateTimer = () => {
    const min = Math.floor(meditationTimeLeft/60);
    const sec = meditationTimeLeft % 60;
    timerEl.textContent = `${min}:${sec<10?'0':''}${sec}`;
    if (meditationTimeLeft <= 0) endMeditation(true); // Pass true for completion
    else meditationTimeLeft--;
  };
  updateTimer();
  meditationTimer = setInterval(updateTimer, 1000);
  instructionInterval = setInterval(() => {
    i_idx = (i_idx + 1) % instructions.length;
    instructionEl.textContent = instructions[i_idx];
  }, 15000);

  overlay.querySelector('#endMeditationBtn').addEventListener('click', () => endMeditation(false));
}
function endMeditation(completed = false){
  clearInterval(meditationTimer);
  clearInterval(instructionInterval);
  meditationTimer = null;
  instructionInterval = null;
  const overlay = document.querySelector('.meditation-overlay');
  if (overlay) overlay.remove();
  document.body.classList.remove('in-meditation');
  
  if(completed) {
      addXp(5); // +5 XP for completing meditation
      showNotification('Meditation complete. +5 XP');
  } else {
      showNotification('Meditation session ended.');
  }
}


/* Enhanced Homepage Animations & Mockups */
function initHomepageAnimations() {
    // Enhanced section fade-in on scroll with staggered animations
    const sections = document.querySelectorAll('#homePage .home-section');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                
                // Add staggered animation for feature showcase content
                const textContent = entry.target.querySelector('.text-content');
                const mockupContent = entry.target.querySelector('.mockup-content');
                
                if (textContent) {
                    setTimeout(() => {
                        textContent.style.opacity = '1';
                        textContent.style.transform = 'translateX(0)';
                    }, 100);
                }
                
                if (mockupContent) {
                    setTimeout(() => {
                        mockupContent.style.opacity = '1';
                        mockupContent.style.transform = 'translateX(0)';
                    }, 300);
                }
            }
        });
    }, { threshold: 0.1 });
    sections.forEach(section => observer.observe(section));
    
    // Enhanced parallax effect for hero section
    const heroSection = document.querySelector('.home-hero');
    if (heroSection) {
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const rate = scrolled * -0.5;
            heroSection.style.transform = `translateY(${rate}px)`;
        });
    }
    
    // Enhanced MacBook mockup hover effects
    const macbookMockup = document.querySelector('.macbook-mockup');
    if (macbookMockup) {
        macbookMockup.addEventListener('mouseenter', () => {
            macbookMockup.style.animationPlayState = 'paused';
        });
        macbookMockup.addEventListener('mouseleave', () => {
            macbookMockup.style.animationPlayState = 'running';
        });
    }

    // Enhanced AI typewriter effect with better styling
    const aiText = "I've noticed 70% of your losing trades occur in the first hour of market open. Consider waiting for the initial volatility to settle before taking a position.";
    let i = 0;
    const typewriterEl = $('ai-typewriter');
    
    // Add cursor styling
    if (typewriterEl) {
        const style = document.createElement('style');
        style.textContent = `
            .ai-typewriter .cursor {
                display: inline-block;
                width: 2px;
                height: 1.2em;
                background-color: var(--accent);
                margin-left: 2px;
                animation: blink 1s infinite;
            }
            @keyframes blink {
                0%, 50% { opacity: 1; }
                51%, 100% { opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }
    
    function type() {
        if (i < aiText.length) {
            typewriterEl.innerHTML = aiText.substring(0, i + 1) + '<span class="cursor"></span>';
            i++;
            setTimeout(type, 30);
        } else {
            typewriterEl.innerHTML = aiText; // Remove cursor at the end
        }
    }
    const aiObserver = new IntersectionObserver((entries) => {
        if(entries[0].isIntersecting) {
            if (i === 0) type(); // Only start if it hasn't started
            aiObserver.unobserve(typewriterEl); // Stop observing after it's visible
        }
    }, { threshold: 0.8 });
    if(typewriterEl) aiObserver.observe(typewriterEl);

    // Color picker interaction
    document.querySelectorAll('.color-swatch .swatch-box').forEach(box => {
        box.addEventListener('click', () => {
            const pickerId = box.dataset.picker;
            if (pickerId) $(pickerId).click();
        });
    });
    document.querySelectorAll('.color-swatch input[type="color"]').forEach(picker => {
        picker.addEventListener('input', (e) => {
            const targetVar = e.target.dataset.target;
            const swatchBox = $(`swatch-${targetVar}-box`);
            if (swatchBox) {
                swatchBox.style.backgroundColor = e.target.value;
                swatchBox.style.color = e.target.value;
            }
            document.documentElement.style.setProperty(`--mock-${targetVar}-color`, e.target.value);
        });
    });

    // Mockup charts - Initialize when stats card comes into view
    const mockupStatsCard = $('mockup-stats-card');
    if (mockupStatsCard) {
        const mockupObserver = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting) {
                // Initialize equity chart
                const mockupEquityCanvas = $('mockupEquityCanvas');
                if (mockupEquityCanvas && typeof Chart !== 'undefined') {
                    const css = getComputedStyle(document.body);
                    const accent = css.getPropertyValue('--accent').trim();
                    const grid = 'rgba(255,255,255,0.08)';
                    const muted = css.getPropertyValue('--muted').trim();
                    if(mockupEquityChart) mockupEquityChart.destroy();
                    mockupEquityChart = new Chart(mockupEquityCanvas.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: Array.from({length:10}, (_,i)=>`Day ${i+1}`),
                            datasets: [{ data: [1000, 1050, 1020, 1100, 1150, 1130, 1200, 1250, 1230, 1280], borderColor: accent, tension: 0.3, pointRadius: 0, fill: true, backgroundColor: accent+'22' }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display:false, grid: {color:grid} }, y: { display:false, grid: {color:grid} } } }
                    });
                }
                
                // Initialize donut chart
                const mockupDonutCanvas = $('mockupWinLossDonutCanvas');
                if(mockupDonutCanvas && typeof Chart !== 'undefined') {
                    const css = getComputedStyle(document.body);
                    const success = css.getPropertyValue('--success').trim();
                    const danger = css.getPropertyValue('--danger').trim();
                    if(mockupWinLossDonutChart) mockupWinLossDonutChart.destroy();
                    mockupWinLossDonutChart = new Chart(mockupDonutCanvas.getContext('2d'), {
                        type: 'doughnut',
                        data: { labels: ['Wins', 'Losses'], datasets: [{ data: [68, 32], backgroundColor: [success, danger], borderWidth: 0 }] },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, cutout: '65%' }
                    });
                }
                
                mockupObserver.unobserve(mockupStatsCard);
            }
        }, { threshold: 0.5 });
        mockupObserver.observe(mockupStatsCard);
    }

    // Enhanced live stat counters with easing
    const stats = { active: 8427, subs: 47.2, trades: 234891, helped: 87 };
    function animateValue(id, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            // Easing function for smoother animation
            const easeOutCubic = 1 - Math.pow(1 - progress, 3);
            const currentValue = Math.floor(easeOutCubic * (end - start) + start);
            $(id).innerHTML = currentValue.toLocaleString();
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }
    
    // Enhanced stat observer with better timing
    const statObserver = new IntersectionObserver((entries) => {
        if(entries[0].isIntersecting) {
            // Stagger the animations for better visual effect
            setTimeout(() => animateValue("homeActive", 0, stats.active, 2000), 0);
            setTimeout(() => animateValue("homeSubs", 0, stats.subs, 2000), 200);
            setTimeout(() => animateValue("homeTrades", 0, stats.trades, 2000), 400);
            setTimeout(() => animateValue("homeHelped", 0, stats.helped, 2000), 600);
            statObserver.unobserve($('homeStatsRow'));
        }
    }, {threshold: 0.8});
    if($('homeStatsRow')) statObserver.observe($('homeStatsRow'));
    
    // Add smooth scroll behavior
    document.documentElement.style.scrollBehavior = 'smooth';
    
    // Enhanced button interactions
    document.querySelectorAll('.btn-primary, .btn-secondary').forEach(btn => {
        btn.addEventListener('mouseenter', () => {
            btn.style.transform = 'translateY(-2px) scale(1.02)';
        });
        btn.addEventListener('mouseleave', () => {
            btn.style.transform = 'translateY(0) scale(1)';
        });
    });
}

/* Decorative Background */
function initBackgroundCanvas(){
    const canvas = $('bgCanvas');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    let stars = [];
    let w, h;
    function resize(){
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        stars = [];
        for(let i=0; i<600; i++){
            stars.push({
                x: Math.random() * w,
                y: Math.random() * h,
                z: Math.random() * 2 + 0.5,
                o: Math.random() * 0.5 + 0.2
            });
        }
    }
    function draw(){
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = '#fff';
        stars.forEach(s => {
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.z * 0.7, 0, 2 * Math.PI);
            ctx.globalAlpha = s.o;
            ctx.fill();
            s.y -= s.z * 0.15;
            if(s.y < 0) { s.y = h; s.x = Math.random() * w; }
        });
        requestAnimationFrame(draw);
    }
    window.addEventListener('resize', resize);
    resize();
    draw();
}

// Settings -> Profile -> Rules Manager
function renderRulesManager() {
    const container = $('rulesManager');
    if (!container) return;
    container.innerHTML = '';
    const rules = (userProfile && userProfile.rules) || [];
    rules.forEach((rule, index) => {
        const el = document.createElement('div');
        el.className = 'rule-tag';
        el.style = 'display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: .5rem; border-radius: 8px;';
        el.innerHTML = `<span>${rule}</span><button data-index="${index}" style="background: none; border: none; color: var(--danger); font-size: 1.2rem; cursor: pointer;">&times;</button>`;
        container.appendChild(el);
    });
    // Add event listeners for delete buttons
    container.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.index);
            removeRule(index);
        });
    });
    renderRulesChecklist();
    renderHabitTracker();
}
function addRule() {
    const input = $('newRuleText');
    const ruleText = input.value.trim();
    if (ruleText && userProfile) {
        userProfile.rules = userProfile.rules || [];
        userProfile.rules.push(ruleText);
        input.value = '';
        autoSave();
        renderRulesManager();
    }
}
function removeRule(index) {
    if (userProfile && userProfile.rules) {
        userProfile.rules.splice(index, 1);
        autoSave();
        renderRulesManager();
    }
}
function renderRulesChecklist() {
    const container = $('rulesChecklist');
    if (!container) return;
    container.innerHTML = '';
    const rules = (userProfile && userProfile.rules) || [];
    rules.forEach(rule => {
        const el = document.createElement('label');
        el.className = 'rule-checkbox';
        el.style = 'display: flex; align-items: center; gap: .5rem; background: rgba(255,255,255,0.05); padding: .5rem; border-radius: 8px; cursor: pointer;';
        el.innerHTML = `<input type="checkbox" value="${rule}"> ${rule}`;
        container.appendChild(el);
    });
}
on('addRuleBtn', 'click', addRule);

// Journal -> Custom Fields
on('addCustomFieldBtn', 'click', () => {
    const key = val('newCustomKey').trim();
    const value = val('newCustomValue').trim();
    if (!key) {
        showNotification('Custom field needs a key.');
        return;
    }
    const container = $('customFieldsContainer');
    const el = document.createElement('div');
    el.className = 'custom-field-item';
    el.dataset.key = key;
    el.innerHTML = `<label>${key}</label><input type="text" value="${value}"><button>&times;</button>`;
    el.querySelector('button').onclick = () => el.remove();
    container.appendChild(el);
    $('newCustomKey').value = '';
    $('newCustomValue').value = '';
});

// Dashboard Background
function applyDashboardBg(imageData) {
    const tabContainer = $('dashboardPage');
    if (!tabContainer) return;
    if (imageData) {
        tabContainer.style.setProperty('--dashboard-bg', `url(${imageData})`);
    } else {
        tabContainer.style.removeProperty('--dashboard-bg');
    }
}
on('applyBgBtn', 'click', () => {
    const fileInput = $('dashboardBgInput');
    const file = fileInput.files && fileInput.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            localStorage.setItem('intradelDashboardBg', e.target.result);
            applyDashboardBg(e.target.result);
            showNotification('Background applied.');
        };
        reader.readAsDataURL(file);
    }
});
on('clearBgBtn', 'click', () => {
    localStorage.removeItem('intradelDashboardBg');
    applyDashboardBg(null);
    showNotification('Background cleared.');
});
// Load BG on startup
document.addEventListener('DOMContentLoaded', () => {
    const savedBg = localStorage.getItem('intradelDashboardBg');
    if (savedBg) applyDashboardBg(savedBg);
});

// INTERACTIVE HOMEPAGE FEATURES

// 1. Journal Edit Modal
document.addEventListener('DOMContentLoaded', () => {
    const editBtn = document.getElementById('mockJournalEditBtn');
    const journalText = document.getElementById('mockJournalText');
    const modal = document.getElementById('journalEditModal');
    const textarea = document.getElementById('journalEditTextarea');
    const closeBtn = document.getElementById('closeJournalModal');
    const cancelBtn = document.getElementById('cancelJournalEdit');
    const saveBtn = document.getElementById('saveJournalEdit');
    
    if (editBtn && journalText && modal && textarea) {
        editBtn.addEventListener('click', () => {
            textarea.value = journalText.textContent;
            modal.style.display = 'flex';
        });
        
        const closeModal = () => {
            modal.style.display = 'none';
        };
        
        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
        
        if (saveBtn) {
            saveBtn.addEventListener('click', () => {
                if (textarea.value.trim() !== '') {
                    journalText.textContent = textarea.value.trim();
                }
                closeModal();
            });
        }
        
        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
    }
});

// 2. AI-Powered Mentor Interactive Chat
document.addEventListener('DOMContentLoaded', () => {
    const aiInput = document.getElementById('mockAiInput');
    const sendBtn = document.getElementById('mockAiSendBtn');
    const aiChat = document.getElementById('mockAiChat');
    
    const handleAiSend = () => {
        if (aiInput && aiChat && aiInput.value.trim() !== '') {
            const userQuestion = aiInput.value.trim();
            
            // Add user question
            const userDiv = document.createElement('div');
            userDiv.className = 'line user';
            userDiv.textContent = '> ' + userQuestion;
            aiChat.appendChild(userDiv);
            
            // Clear input
            aiInput.value = '';
            
            // Add AI response after a brief delay
            setTimeout(() => {
                const aiDiv = document.createElement('div');
                aiDiv.className = 'line ai';
                aiDiv.textContent = 'Login or Create an account to use the AI-Powered Mentor.';
                aiChat.appendChild(aiDiv);
                
                // Scroll to bottom
                aiChat.scrollTop = aiChat.scrollHeight;
            }, 500);
        }
    };
    
    if (sendBtn) {
        sendBtn.addEventListener('click', handleAiSend);
    }
    
    if (aiInput) {
        aiInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleAiSend();
            }
        });
    }
});

// 3. Color Picker Real-Time Changes
document.addEventListener('DOMContentLoaded', () => {
    const colorInputs = document.querySelectorAll('#mock-color-accent, #mock-color-win, #mock-color-loss');
    
    colorInputs.forEach(input => {
        if (input) {
            input.addEventListener('input', (e) => {
                const newColor = e.target.value;
                const target = e.target.dataset.target;
                
                if (target === 'accent') {
                    document.documentElement.style.setProperty('--accent', newColor);
                } else if (target === 'success') {
                    document.documentElement.style.setProperty('--success', newColor);
                } else if (target === 'danger') {
                    document.documentElement.style.setProperty('--danger', newColor);
                }
                
                // Update the swatch box color
                const swatchBox = document.querySelector(`[data-picker="${input.id}"]`);
                if (swatchBox) {
                    swatchBox.style.background = newColor;
                }
            });
            
            // Initialize swatch boxes
            const swatchBox = document.querySelector(`[data-picker="${input.id}"]`);
            if (swatchBox) {
                swatchBox.style.background = input.value;
            }
        }
    });
});

// NEW: Leveling System (Made easier - less XP required)
function calculateLevel(xp) {
    if (xp <= 0) return 0;
    // Much easier leveling: Level = XP / 50
    // Level 1 = 50 XP, Level 2 = 100 XP, Level 10 = 500 XP, etc.
    return Math.floor(xp / 50);
}

function addXp(amount) {
    if (!userProfile || typeof userProfile.xp !== 'number') return;
    const oldLevel = calculateLevel(userProfile.xp);
    userProfile.xp += amount;
    const newLevel = calculateLevel(userProfile.xp);
    
    if (newLevel > oldLevel) {
        showNotification(`Level Up! You are now Level ${newLevel}!`);
    }
    
    // Update UI elements if they are visible
    if($('myLevelAndXp')) $('myLevelAndXp').textContent = `Level ${newLevel} (${userProfile.xp} XP)`;
    if($('dashboardLevel')) $('dashboardLevel').textContent = newLevel;
}

function renderLeaderboard() {
    if (!currentUser) return;
    
    const allUsersData = getAllUserData();
    const allUsers = getAllUsers();

    const leaderboardData = Object.keys(allUsersData)
        .map(email => {
            const profile = allUsersData[email].profile || {xp: 0, isPublic: false};
            const user = allUsers[email] || {name: "Unknown"};
            return {
                email: email,
                name: user.name,
                xp: profile.xp || 0,
                level: calculateLevel(profile.xp || 0),
                isPublic: profile.isPublic,
                avatarData: profile.avatarData
            };
        })
        .filter(user => user.isPublic)
        .sort((a, b) => b.xp - a.xp);

    const myRank = leaderboardData.findIndex(u => u.email === currentUser.email) + 1;

    // My Rank card
    $('myRank').textContent = myRank > 0 ? `#${myRank}` : 'N/A';
    $('myLevelAndXp').textContent = `Level ${calculateLevel(userProfile.xp)} (${userProfile.xp} XP)`;

    // Podium
    const podiumContainer = $('podiumContainer');
    podiumContainer.innerHTML = '';
    const podiumIcons = ['🥇', '🥈', '🥉'];
    leaderboardData.slice(0, 3).forEach((user, index) => {
        const el = document.createElement('div');
        el.className = 'podium-item';
        el.innerHTML = `
            <div class="rank-icon">${podiumIcons[index]}</div>
            <div class="name">${user.name}</div>
            <div class="level">Level ${user.level}</div>
        `;
        podiumContainer.appendChild(el);
    });

    // Leaderboard List
    const listContainer = $('leaderboardList');
    listContainer.innerHTML = '';
    leaderboardData.slice(0, 20).forEach((user, index) => {
        const el = document.createElement('div');
        el.className = 'leaderboard-item';
        if (user.email === currentUser.email) {
            el.classList.add('current-user');
        }
        el.dataset.email = user.email; // Add email for click handler
        const avatarSrc = user.avatarData || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

        el.innerHTML = `
            <div class="rank">#${index + 1}</div>
            <img src="${avatarSrc}" class="avatar" style="${!user.avatarData ? 'background: var(--bg-2);' : ''}">
            <div class="name">${user.name}</div>
            <div class="level">Lv ${user.level}</div>
            <div class="xp">${user.xp.toLocaleString()} XP</div>
        `;
        listContainer.appendChild(el);
    });

    // Add click listeners to leaderboard items
    listContainer.querySelectorAll('.leaderboard-item').forEach(item => {
        item.addEventListener('click', () => {
            const email = item.dataset.email;
            if (email) {
                showUserProfile(email);
            }
        });
    });
}

function showUserProfile(email) {
    const allUsersData = getAllUserData();
    const allUsers = getAllUsers();
    
    const userAccount = allUsers[email];
    const userData = allUsersData[email];

    if (!userAccount || !userData || !userData.profile.isPublic) {
        showNotification("This user's profile is private.");
        return;
    }

    const profile = userData.profile;
    const level = calculateLevel(profile.xp);
    const avatarSrc = profile.avatarData || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

    const content = `
        <div style="text-align: center;">
            <img src="${avatarSrc}" alt="Avatar" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); margin-bottom: 1rem; ${!profile.avatarData ? 'background: var(--bg-2);' : ''}">
            <h2 style="margin-bottom: 0;">${userAccount.name}</h2>
            <p style="color: var(--muted); margin-top: 0;">Level ${level} - ${profile.xp.toLocaleString()} XP</p>
            <p>Member Since: ${new Date(userAccount.createdAt).toLocaleDateString()}</p>
            <p>Subscription: <span style="color: var(--accent-soft); font-weight: bold;">${userAccount.subscription}</span></p>
        </div>
    `;

    $('userProfileContent').innerHTML = content;
    openModal('userProfileModal');
}

// NEW: Habit Tracker
function renderHabitTracker() {
  if (!userProfile) return;
  const grid = $('habitTrackerGrid');
  grid.innerHTML = '';
  const rules = userProfile.rules || [];
  const today = new Date();
  const dates = Array.from({ length: 30 }, (_, i) => {
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    return d;
  }).reverse();

  grid.style.gridTemplateColumns = `200px repeat(${dates.length}, 1fr)`;

  // Header
  const header = document.createElement('div');
  header.className = 'habit-grid-header';
  let headerHTML = '<div class="header-item">Habit</div>';
  const todayStr = today.toISOString().split('T')[0];
  dates.forEach(date => {
    const dateStr = date.toISOString().split('T')[0];
    const isToday = dateStr === todayStr;
    headerHTML += `<div class="header-item ${isToday ? 'is-today' : ''}">${date.getDate()}</div>`;
  });
  header.innerHTML = headerHTML;
  grid.appendChild(header);

  // Rows for each habit
  rules.forEach((rule, ruleIndex) => {
    const row = document.createElement('div');
    row.className = 'habit-row';
    let rowHTML = `<div class="habit-name">${rule}</div>`;
    dates.forEach(date => {
      const dateStr = date.toISOString().split('T')[0];
      const habitLogForDay = userProfile.habitLog[dateStr] || [];
      const isChecked = habitLogForDay.includes(rule);
      const isToday = dateStr === todayStr;
      rowHTML += `<div class="habit-day-cell ${isChecked ? 'checked' : ''} ${isToday ? 'is-today' : ''}" data-date="${dateStr}" data-rule="${rule}"></div>`;
    });
    row.innerHTML = rowHTML;
    grid.appendChild(row);
  });

  // Habit Tracker cell click handler
  grid.addEventListener('click', (e) => {
    const cell = e.target.closest('.habit-day-cell');
    if (!cell) return;

    const dateStr = cell.dataset.date;
    const rule = cell.dataset.rule;
    
    userProfile.habitLog = userProfile.habitLog || {};
    userProfile.habitLog[dateStr] = userProfile.habitLog[dateStr] || [];

    const ruleIndex = userProfile.habitLog[dateStr].indexOf(rule);

    if (ruleIndex > -1) {
      // Uncheck it
      userProfile.habitLog[dateStr].splice(ruleIndex, 1);
      cell.classList.remove('checked');
    } else {
      // Check it
      userProfile.habitLog[dateStr].push(rule);
      cell.classList.add('checked');
      addXp(1); // +1 XP for checking a habit
      showNotification('+1 XP for consistency!');
    }
    autoSave();
  });
}

// Grit-Inspired Habit Tracker Functionality
let currentHabitPeriod = 'week';
let selectedHabitIcon = '📊';

const habitGradients = [
    'linear-gradient(135deg,#667eea,#764ba2)',
    'linear-gradient(135deg,#f093fb,#f5576c)',
    'linear-gradient(135deg,#4facfe,#00f2fe)',
    'linear-gradient(135deg,#43e97b,#38f9d7)',
    'linear-gradient(135deg,#fa709a,#fee140)',
    'linear-gradient(135deg,#30cfd0,#330867)',
    'linear-gradient(135deg,#a8edea,#fed6e3)',
    'linear-gradient(135deg,#ff9a9e,#fecfef)'
];

function getHabits() {
    const habits = JSON.parse(localStorage.getItem('habits') || '[]');
    if (habits.length === 0) {
        // Initialize with default habits with creation date
        const today = new Date().toISOString().split('T')[0];
        const defaultHabits = [
            { id: 'wait-setup', name: 'Wait for Setup', desc: 'Only enter trades that match your criteria', icon: '📊', gradient: habitGradients[0], createdDate: today },
            { id: 'risk-mgmt', name: 'Risk Management', desc: 'Never risk more than 1% per trade', icon: '🛡️', gradient: habitGradients[1], createdDate: today },
            { id: 'journal-trades', name: 'Journal Every Trade', desc: 'Document entry, exit, and emotions', icon: '✍️', gradient: habitGradients[2], createdDate: today }
        ];
        localStorage.setItem('habits', JSON.stringify(defaultHabits));
        return defaultHabits;
    }
    // Add createdDate to old habits that don't have it
    return habits.map(habit => {
        if (!habit.createdDate) {
            habit.createdDate = new Date().toISOString().split('T')[0];
        }
        return habit;
    });
}

function saveHabits(habits) {
    localStorage.setItem('habits', JSON.stringify(habits));
}

function getHabitData() {
    return JSON.parse(localStorage.getItem('habitData') || '{}');
}

function saveHabitData(data) {
    localStorage.setItem('habitData', JSON.stringify(data));
}

function getDaysForPeriod(period) {
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Reset to start of day
    const days = [];
    
    if (period === 'week') {
        // Get current week starting from Sunday
        const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
        const weekStart = new Date(today);
        weekStart.setDate(today.getDate() - currentDay); // Go back to Sunday
        
        for (let i = 0; i < 7; i++) {
            const date = new Date(weekStart);
            date.setDate(weekStart.getDate() + i);
            days.push(date);
        }
    } else {
        let numDays = period === 'month' ? 30 : 90;
        for (let i = numDays - 1; i >= 0; i--) {
            const date = new Date(today);
            date.setDate(today.getDate() - i);
            days.push(date);
        }
    }
    
    return days;
}

function renderHabits() {
    const habits = getHabits();
    const habitData = getHabitData();
    const container = document.getElementById('habitsListContainer');
    const emptyState = document.getElementById('habitsEmptyState');
    
    if (!container) return;
    
    if (habits.length === 0) {
        container.innerHTML = '';
        if (emptyState) emptyState.style.display = 'block';
        return;
    }
    
    if (emptyState) emptyState.style.display = 'none';
    container.innerHTML = '';
    
    const days = getDaysForPeriod(currentHabitPeriod);
    
    habits.forEach(habit => {
        const card = document.createElement('div');
        card.className = 'grit-habit-card';
        card.dataset.habit = habit.id;
        
        // Calculate streak
        let streak = 0;
        const today = new Date();
        for (let i = 0; i < 365; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() - i);
            const dateStr = date.toISOString().split('T')[0];
            if (habitData[habit.id]?.[dateStr]) {
                streak++;
            } else if (i > 0) {
                break;
            }
        }
        
        card.innerHTML = `
            <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem;">
                <div style="width:48px;height:48px;border-radius:12px;background:${habit.gradient};display:flex;align-items:center;justify-content:center;font-size:1.5rem;">${habit.icon}</div>
                <div style="flex:1;">
                    <h3 style="margin:0;font-size:1.2rem;font-weight:700;">${habit.name}</h3>
                    <p style="margin:0.25rem 0 0 0;color:var(--muted);font-size:0.9rem;">${habit.desc}</p>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:1.5rem;font-weight:900;color:var(--success);">🔥 <span class="habit-streak">${streak}</span></div>
                    <div style="font-size:0.75rem;color:var(--muted);margin-top:0.25rem;">day streak</div>
                </div>
            </div>
            <div class="habit-period-grid" style="display:grid;grid-template-columns:repeat(${currentHabitPeriod === 'week' ? '7' : currentHabitPeriod === 'month' ? '10' : '15'},1fr);gap:${currentHabitPeriod === 'all' ? '3px' : '0.5rem'};max-width:100%;padding:2px;">
                ${days.map((date, idx) => {
                    const dateStr = date.toISOString().split('T')[0];
                    const isChecked = habitData[habit.id]?.[dateStr];
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const isFuture = date > today;
                    const isPast = date < today;
                    
                    // Check if this date is before the habit was created
                    const habitCreatedDate = new Date(habit.createdDate || today);
                    habitCreatedDate.setHours(0, 0, 0, 0);
                    const isBeforeCreation = date < habitCreatedDate;
                    
                    // Only show as missed if it's past, not checked, AND after creation
                    const isMissed = isPast && !isChecked && !isBeforeCreation;
                    
                    const dayLabel = currentHabitPeriod === 'week' ? ['S','M','T','W','T','F','S'][date.getDay()] : 
                                     currentHabitPeriod === 'month' ? date.getDate() : '';
                    return `<div class="habit-day ${isChecked ? 'checked' : ''} ${isMissed ? 'missed' : ''} ${isFuture || isBeforeCreation ? 'future-day' : ''}" data-date="${dateStr}" data-habit="${habit.id}" style="${currentHabitPeriod === 'all' ? 'font-size:0.5rem;' : ''}"><span>${dayLabel}</span></div>`;
                }).join('')}
            </div>
        `;
        
        container.appendChild(card);
    });
    
    // Add click handlers
    document.querySelectorAll('.habit-day').forEach(day => {
        day.addEventListener('click', () => {
            // Check if this is a future day
            if (day.classList.contains('future-day')) {
                showNotification('Cannot check future dates! ⏰');
                return;
            }
            
            // Check if this is a missed day (past day)
            if (day.classList.contains('missed')) {
                showNotification('Cannot change past days! ❌');
                return;
            }
            
            const habitId = day.dataset.habit;
            const dateStr = day.dataset.date;
            const habitData = getHabitData();
            
            if (!habitData[habitId]) habitData[habitId] = {};
            
            if (habitData[habitId][dateStr]) {
                delete habitData[habitId][dateStr];
                day.classList.remove('checked');
                // Remove 5 XP
                if (typeof addXp === 'function') {
                    addXp(-5);
                    showNotification('-5 XP');
                }
            } else {
                habitData[habitId][dateStr] = true;
                day.classList.add('checked');
                // Add 5 XP
                if (typeof addXp === 'function') {
                    addXp(5);
                    showNotification('+5 XP! Keep it up! 🔥');
                }
            }
            
            saveHabitData(habitData);
            updateHabitStats();
            updateHabitStreaks();
        });
    });
    
    updateHabitStats();
}

function updateHabitStats() {
    const habitData = getHabitData();
    let totalChecks = 0;
    let currentStreak = 0;
    let longestStreak = 0;
    let tempStreak = 0;
    
    Object.values(habitData).forEach(habit => {
        totalChecks += Object.keys(habit).length;
    });
    
    const today = new Date();
    for (let i = 0; i < 365; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        
        let anyHabitChecked = false;
        Object.values(habitData).forEach(habit => {
            if (habit[dateStr]) anyHabitChecked = true;
        });
        
        if (anyHabitChecked) {
            tempStreak++;
            if (i === 0) currentStreak = tempStreak;
        } else {
            longestStreak = Math.max(longestStreak, tempStreak);
            if (i > 0) tempStreak = 0;
        }
    }
    longestStreak = Math.max(longestStreak, tempStreak);
    
    const currentStreakEl = document.getElementById('currentStreakNum');
    const longestStreakEl = document.getElementById('longestStreakNum');
    const totalCompletionsEl = document.getElementById('totalCompletionsNum');
    
    if (currentStreakEl) currentStreakEl.textContent = currentStreak;
    if (longestStreakEl) longestStreakEl.textContent = longestStreak;
    if (totalCompletionsEl) totalCompletionsEl.textContent = totalChecks;
}

function updateHabitStreaks() {
    const habitData = getHabitData();
    document.querySelectorAll('.grit-habit-card').forEach(card => {
        const habitId = card.dataset.habit;
        const streakEl = card.querySelector('.habit-streak');
        if (streakEl && habitData[habitId]) {
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                if (habitData[habitId][dateStr]) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            streakEl.textContent = streak;
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // Period buttons
    document.querySelectorAll('.habit-period-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.habit-period-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = 'transparent';
                b.style.color = 'var(--muted)';
            });
            btn.classList.add('active');
            btn.style.background = 'var(--accent)';
            btn.style.color = 'var(--bg-primary)';
            currentHabitPeriod = btn.dataset.period;
            renderHabits();
        });
    });
    
    // New Habit Modal
    const addNewHabitBtn = document.getElementById('addNewHabitBtn');
    const newHabitModal = document.getElementById('newHabitModal');
    const closeNewHabitModal = document.getElementById('closeNewHabitModal');
    const cancelNewHabit = document.getElementById('cancelNewHabit');
    const saveNewHabit = document.getElementById('saveNewHabit');
    const habitIconBtns = document.querySelectorAll('.habit-icon-btn');
    
    if (addNewHabitBtn) {
        addNewHabitBtn.addEventListener('click', () => {
            newHabitModal.style.display = 'flex';
            document.getElementById('newHabitName').value = '';
            document.getElementById('newHabitDesc').value = '';
            selectedHabitIcon = '📊';
            habitIconBtns.forEach(b => b.style.borderColor = 'var(--stroke-weak)');
            habitIconBtns[0].style.borderColor = 'var(--accent)';
        });
    }
    
    const closeHabitModal = () => {
        newHabitModal.style.display = 'none';
    };
    
    if (closeNewHabitModal) closeNewHabitModal.addEventListener('click', closeHabitModal);
    if (cancelNewHabit) cancelNewHabit.addEventListener('click', closeHabitModal);
    
    habitIconBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            habitIconBtns.forEach(b => b.style.borderColor = 'var(--stroke-weak)');
            btn.style.borderColor = 'var(--accent)';
            selectedHabitIcon = btn.dataset.icon;
        });
    });
    
    if (saveNewHabit) {
        saveNewHabit.addEventListener('click', () => {
            const name = document.getElementById('newHabitName').value.trim();
            const desc = document.getElementById('newHabitDesc').value.trim();
            
            if (!name) {
                showNotification('Please enter a habit name');
                return;
            }
            
            const habits = getHabits();
            const newHabit = {
                id: 'habit-' + Date.now(),
                name: name,
                desc: desc || 'Track your progress',
                icon: selectedHabitIcon,
                gradient: habitGradients[habits.length % habitGradients.length],
                createdDate: new Date().toISOString().split('T')[0]
            };
            
            habits.push(newHabit);
            saveHabits(habits);
            renderHabits();
            closeHabitModal();
            showNotification('Habit created! 🎉');
        });
    }
    
    // Close modal when clicking outside
    if (newHabitModal) {
        newHabitModal.addEventListener('click', (e) => {
            if (e.target === newHabitModal) {
                newHabitModal.style.display = 'none';
            }
        });
    }
    
    // Initialize habits
    renderHabits();
});

// Journal Emotion Buttons
document.addEventListener('DOMContentLoaded', () => {
    const emotionBtns = document.querySelectorAll('.emotion-btn');
    const emotionsInput = document.getElementById('jEmotions');
    let selectedEmotions = [];
    
    emotionBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const emotion = btn.dataset.emotion;
            
            if (btn.classList.contains('selected')) {
                btn.classList.remove('selected');
                selectedEmotions = selectedEmotions.filter(e => e !== emotion);
            } else {
                btn.classList.add('selected');
                selectedEmotions.push(emotion);
            }
            
            if (emotionsInput) {
                emotionsInput.value = selectedEmotions.join(',');
            }
        });
    });
    
    // Screenshot drop zone
    const dropZone = document.getElementById('screenshotDropZone');
    const fileInput = document.getElementById('jScreenshot');
    
    if (dropZone && fileInput) {
        dropZone.addEventListener('click', (e) => {
            if (e.target.tagName !== 'BUTTON') {
                fileInput.click();
            }
        });
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--accent)';
            dropZone.style.background = 'rgba(255,255,255,0.08)';
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = 'rgba(255,255,255,0.2)';
            dropZone.style.background = 'rgba(255,255,255,0.02)';
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'rgba(255,255,255,0.2)';
            dropZone.style.background = 'rgba(255,255,255,0.02)';
            
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                dropZone.querySelector('div:nth-child(2)').textContent = '✅ ' + e.dataTransfer.files[0].name;
            }
        });
        
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                dropZone.querySelector('div:nth-child(2)').textContent = '✅ ' + fileInput.files[0].name;
            }
        });
    }
});

// Enhanced Leaderboard Rendering
function renderLeaderboard() {
    const myXP = userProfile?.xp || 0;
    const myLevel = calculateLevel(myXP);
    const nextLevel = myLevel + 1;
    const xpForNext = Math.pow(nextLevel / 0.1, 2);
    const xpForCurrent = Math.pow(myLevel / 0.1, 2);
    const xpProgress = ((myXP - xpForCurrent) / (xpForNext - xpForCurrent)) * 100;
    
    // Update "Your Rank" section
    const myRankEl = document.getElementById('myRank');
    const myLevelNumEl = document.getElementById('myLevelNum');
    const myXPNumEl = document.getElementById('myXPNum');
    const myXPProgressBar = document.getElementById('myXPProgressBar');
    const myXPRemaining = document.getElementById('myXPRemaining');
    const myNextLevel = document.getElementById('myNextLevel');
    
    if (myLevelNumEl) myLevelNumEl.textContent = myLevel;
    if (myXPNumEl) myXPNumEl.textContent = myXP.toLocaleString();
    if (myXPProgressBar) myXPProgressBar.style.width = xpProgress + '%';
    if (myXPRemaining) myXPRemaining.textContent = Math.ceil(xpForNext - myXP).toLocaleString();
    if (myNextLevel) myNextLevel.textContent = nextLevel;
    
    // Get sorted users
    const sortedUsers = users.sort((a, b) => (b.xp || 0) - (a.xp || 0));
    const myRank = sortedUsers.findIndex(u => u.email === userProfile?.email) + 1;
    if (myRankEl) myRankEl.textContent = myRank > 0 ? `#${myRank}` : '--';
    
    // Update top 3 podium
    if (sortedUsers[0]) {
        const u1 = sortedUsers[0];
        const el = document.getElementById('leaderRank1Name');
        if (el) el.textContent = u1.username || u1.email.split('@')[0];
        const lvl = document.getElementById('leaderRank1Level');
        if (lvl) lvl.textContent = calculateLevel(u1.xp || 0);
        const xp = document.getElementById('leaderRank1XP');
        if (xp) xp.textContent = (u1.xp || 0).toLocaleString();
    }
    
    if (sortedUsers[1]) {
        const u2 = sortedUsers[1];
        const el = document.getElementById('leaderRank2Name');
        if (el) el.textContent = u2.username || u2.email.split('@')[0];
        const lvl = document.getElementById('leaderRank2Level');
        if (lvl) lvl.textContent = calculateLevel(u2.xp || 0);
        const xp = document.getElementById('leaderRank2XP');
        if (xp) xp.textContent = (u2.xp || 0).toLocaleString();
    }
    
    if (sortedUsers[2]) {
        const u3 = sortedUsers[2];
        const el = document.getElementById('leaderRank3Name');
        if (el) el.textContent = u3.username || u3.email.split('@')[0];
        const lvl = document.getElementById('leaderRank3Level');
        if (lvl) lvl.textContent = calculateLevel(u3.xp || 0);
        const xp = document.getElementById('leaderRank3XP');
        if (xp) xp.textContent = (u3.xp || 0).toLocaleString();
    }
    
    // Render full leaderboard list (positions 4+)
    const listContainer = document.getElementById('leaderboardList');
    if (listContainer) {
        listContainer.innerHTML = '';
        sortedUsers.slice(3).forEach((user, idx) => {
            const rank = idx + 4;
            const isCurrentUser = user.email === userProfile?.email;
            const level = calculateLevel(user.xp || 0);
            
            const item = document.createElement('div');
            item.style.cssText = `
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                background: ${isCurrentUser ? 'rgba(0,102,204,0.1)' : 'rgba(255,255,255,0.02)'};
                border: 1px solid ${isCurrentUser ? 'rgba(0,102,204,0.3)' : 'rgba(255,255,255,0.05)'};
                border-radius: 12px;
                margin-bottom: 0.5rem;
                transition: all 0.2s;
            `;
            item.innerHTML = `
                <div style="width: 40px; text-align: center; font-weight: 800; font-size: 1.2rem; color: var(--muted);">#${rank}</div>
                <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">👤</div>
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 1.1rem; ${isCurrentUser ? 'color: var(--accent);' : ''}">${user.username || user.email.split('@')[0]}</div>
                    <div style="color: var(--muted); font-size: 0.9rem;">Level ${level}</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: 800; font-size: 1.2rem; color: var(--success);">${(user.xp || 0).toLocaleString()} XP</div>
                </div>
            `;
            listContainer.appendChild(item);
        });
    }
}
</script>

<!-- Journal Edit Modal -->
<div id="journalEditModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;align-items:center;justify-content:center;">
    <div style="background:var(--bg-primary);border:1px solid var(--stroke-weak);border-radius:16px;padding:2rem;max-width:600px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.5);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
            <h3 style="color:var(--text);font-size:1.5rem;font-weight:700;margin:0;">Edit Journal Entry</h3>
            <button id="closeJournalModal" style="background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:all 0.2s;">×</button>
        </div>
        <div style="margin-bottom:1rem;">
            <label style="display:block;color:var(--muted);font-size:0.9rem;margin-bottom:0.5rem;">Journal Text</label>
            <textarea id="journalEditTextarea" style="width:100%;min-height:150px;background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:8px;padding:1rem;color:var(--text);font-size:1rem;font-family:inherit;resize:vertical;"></textarea>
        </div>
        <div style="display:flex;gap:0.75rem;justify-content:flex-end;">
            <button id="cancelJournalEdit" class="btn-secondary" style="padding:0.75rem 1.5rem;">Cancel</button>
            <button id="saveJournalEdit" class="btn-primary" style="padding:0.75rem 1.5rem;">Save Changes</button>
        </div>
    </div>
</div>

<!-- New Habit Modal -->
<div id="newHabitModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;align-items:center;justify-content:center;">
    <div style="background:var(--bg-primary);border:1px solid var(--stroke-weak);border-radius:16px;padding:2rem;max-width:600px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.5);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
            <h3 style="color:var(--text);font-size:1.5rem;font-weight:700;margin:0;">Create New Habit</h3>
            <button id="closeNewHabitModal" style="background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:all 0.2s;">×</button>
        </div>
        <div style="margin-bottom:1rem;">
            <label style="display:block;color:var(--muted);font-size:0.9rem;margin-bottom:0.5rem;">Habit Name</label>
            <input type="text" id="newHabitName" placeholder="e.g., Wait for Setup" style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:8px;padding:0.75rem;color:var(--text);font-size:1rem;font-family:inherit;">
        </div>
        <div style="margin-bottom:1rem;">
            <label style="display:block;color:var(--muted);font-size:0.9rem;margin-bottom:0.5rem;">Description</label>
            <input type="text" id="newHabitDesc" placeholder="e.g., Only enter trades that match your criteria" style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--stroke-weak);border-radius:8px;padding:0.75rem;color:var(--text);font-size:1rem;font-family:inherit;">
        </div>
        <div style="margin-bottom:1.5rem;">
            <label style="display:block;color:var(--muted);font-size:0.9rem;margin-bottom:0.5rem;">Icon</label>
        <div style="display:flex;gap:0.75rem;justify-content:flex-end;">
            <button id="cancelNewHabit" class="btn-secondary" style="padding:0.75rem 1.5rem;">Cancel</button>
            <button id="saveNewHabit" class="btn-primary" style="padding:0.75rem 1.5rem;">Create Habit</button>
        </div>
    </div>
</div>

</body>
</html>
